---
title: "STA 9750 Mini-Project #03: Creating the Ultimate Playlist"
author: "La Maria"
date: today
format:
  html:
    theme: cosmo
    toc: true
    toc-depth: 3
    toc-title: Contents
    toc-location: left
    code-fold: true
    code-summary: "Show code"
    code-line-numbers: true
    code-block-border-left: "#31BAE9"
    code-block-bg: "#f8f8f8"
    fig-width: 10
    fig-height: 6
    fig-dpi: 300
    self-contained: true    # ← Embed all CSS/JS/assets into one HTML
editor: visual
execute:
  warning: false
  message: false
  echo: true
---

::: {.cell}

```{.r .cell-code}
# Load required packages
library(tidyverse)
library(knitr)
library(kableExtra)
library(lubridate)
library(jsonlite)
library(purrr)
library(ggrepel)
library(viridis)
# Global options
knitr::opts_chunk$set(echo = TRUE, 
                      warning = FALSE, 
                      message = FALSE,
                      fig.width = 10, 
                      fig.height = 6,
                      dpi = 300)
```
:::



## Introduction

Welcome to my Mini-Project #03: Creating the Ultimate Playlist! In this analysis, I dive into the world of music analytics using Spotify data to create an optimized, data-driven playlist. This project combines two key Spotify data exports:

1. A comprehensive dataset of songs and their audio characteristics (danceability, energy, tempo, etc.)
2. A collection of user-created playlists showing how songs are typically grouped together

Through statistical analysis and visualization of these datasets, I'll discover patterns in music popularity, explore relationships between audio features, and apply data-driven techniques to music curation. The goal is to create "The Ultimate Playlist" - a carefully crafted sequence of songs that balances familiarity with discovery and creates an engaging listening experience based on audio feature analysis.

This mini-project addresses four key data science competencies:
- Data Ingest and Cleaning (partial)
- Data Combination and Alignment
- Descriptive Statistical Analysis
- Data Visualization

The analysis follows a systematic approach, from responsible data acquisition to exploratory data analysis and ultimately playlist creation. Each visualization is crafted to publication quality, with attention to aesthetics, interpretability, and insight generation.

## Task 1: Song Characteristics Dataset

First, I'll write a function to download and load the Spotify song analytics dataset, following responsible data acquisition practices.



::: {.cell}

```{.r .cell-code}
library(tidyverse)  # for dplyr, tidyr, stringr, etc.

load_songs <- function() {
  # 1) Professor-provided file (OneDrive)
  local_prof_path <- "C:/Users/gerus/OneDrive/Documents/STA9750-2025-SPRING/STA9750-2025-SPRING/Spotify_data.csv"
  
  # 2) Project data folder
  dest_dir  <- "data/mp03"
  dest_file <- file.path(dest_dir, "spotify_data.csv")
  
  # Ensure data directory exists
  if (!dir.exists(dest_dir)) {
    dir.create(dest_dir, recursive = TRUE)
    message("Created directory: ", dest_dir)
  }
  
  # Load logic
  if (file.exists(local_prof_path)) {
    message("Loading professor-provided CSV from OneDrive")
    songs <- read.csv(local_prof_path, stringsAsFactors = FALSE)
    
  } else if (file.exists(dest_file)) {
    message("Loading existing Spotify dataset from ", dest_file)
    songs <- read.csv(dest_file, stringsAsFactors = FALSE)
    
  } else {
    # Download fallback
    spotify_url <- "https://raw.githubusercontent.com/gabminamedez/spotify-data/refs/heads/master/data.csv"
    download.file(url = spotify_url, destfile = dest_file, mode = "wb")
    message("Downloaded Spotify song analytics dataset to ", dest_file)
    songs <- read.csv(dest_file, stringsAsFactors = FALSE)
  }
  
  # Clean up artist strings and split multiple artists into rows
  clean_artist_string <- function(x) {
    str_replace_all(x, "\\['", "") %>%
    str_replace_all("'\\]", "") %>%
    str_replace_all("', '", ",")
  }
  
  songs_clean <- songs %>%
    mutate(artists = clean_artist_string(artists)) %>%
    separate_rows(artists, sep = ",") %>%
    mutate(artist = trimws(artists)) %>%
    select(-artists)
  
  return(songs_clean)
}

# Load the songs data
songs_df <- load_songs()

# Display the first few rows
head(songs_df) %>%
  kable(caption = "Sample of Song Characteristics Data") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
```

::: {.cell-output-display}
`````{=html}
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Sample of Song Characteristics Data</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> id </th>
   <th style="text-align:left;"> name </th>
   <th style="text-align:right;"> duration_ms </th>
   <th style="text-align:left;"> release_date </th>
   <th style="text-align:right;"> year </th>
   <th style="text-align:right;"> acousticness </th>
   <th style="text-align:right;"> danceability </th>
   <th style="text-align:right;"> energy </th>
   <th style="text-align:right;"> instrumentalness </th>
   <th style="text-align:right;"> liveness </th>
   <th style="text-align:right;"> loudness </th>
   <th style="text-align:right;"> speechiness </th>
   <th style="text-align:right;"> tempo </th>
   <th style="text-align:right;"> valence </th>
   <th style="text-align:right;"> mode </th>
   <th style="text-align:right;"> key </th>
   <th style="text-align:right;"> popularity </th>
   <th style="text-align:right;"> explicit </th>
   <th style="text-align:left;"> artist </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 6KbQ3uYMLKb5jDxLF7wYDD </td>
   <td style="text-align:left;"> Singende Bataillone 1. Teil </td>
   <td style="text-align:right;"> 158648 </td>
   <td style="text-align:left;"> 1928 </td>
   <td style="text-align:right;"> 1928 </td>
   <td style="text-align:right;"> 0.995 </td>
   <td style="text-align:right;"> 0.708 </td>
   <td style="text-align:right;"> 0.1950 </td>
   <td style="text-align:right;"> 0.563 </td>
   <td style="text-align:right;"> 0.1510 </td>
   <td style="text-align:right;"> -12.428 </td>
   <td style="text-align:right;"> 0.0506 </td>
   <td style="text-align:right;"> 118.469 </td>
   <td style="text-align:right;"> 0.7790 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> Carl Woitschach </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 6KuQTIu1KoTTkLXKrwlLPV </td>
   <td style="text-align:left;"> Fantasiestücke, Op. 111: Più tosto lento </td>
   <td style="text-align:right;"> 282133 </td>
   <td style="text-align:left;"> 1928 </td>
   <td style="text-align:right;"> 1928 </td>
   <td style="text-align:right;"> 0.994 </td>
   <td style="text-align:right;"> 0.379 </td>
   <td style="text-align:right;"> 0.0135 </td>
   <td style="text-align:right;"> 0.901 </td>
   <td style="text-align:right;"> 0.0763 </td>
   <td style="text-align:right;"> -28.454 </td>
   <td style="text-align:right;"> 0.0462 </td>
   <td style="text-align:right;"> 83.972 </td>
   <td style="text-align:right;"> 0.0767 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> Robert Schumann </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 6KuQTIu1KoTTkLXKrwlLPV </td>
   <td style="text-align:left;"> Fantasiestücke, Op. 111: Più tosto lento </td>
   <td style="text-align:right;"> 282133 </td>
   <td style="text-align:left;"> 1928 </td>
   <td style="text-align:right;"> 1928 </td>
   <td style="text-align:right;"> 0.994 </td>
   <td style="text-align:right;"> 0.379 </td>
   <td style="text-align:right;"> 0.0135 </td>
   <td style="text-align:right;"> 0.901 </td>
   <td style="text-align:right;"> 0.0763 </td>
   <td style="text-align:right;"> -28.454 </td>
   <td style="text-align:right;"> 0.0462 </td>
   <td style="text-align:right;"> 83.972 </td>
   <td style="text-align:right;"> 0.0767 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> Vladimir Horowitz </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 6L63VW0PibdM1HDSBoqnoM </td>
   <td style="text-align:left;"> Chapter 1.18 - Zamek kaniowski </td>
   <td style="text-align:right;"> 104300 </td>
   <td style="text-align:left;"> 1928 </td>
   <td style="text-align:right;"> 1928 </td>
   <td style="text-align:right;"> 0.604 </td>
   <td style="text-align:right;"> 0.749 </td>
   <td style="text-align:right;"> 0.2200 </td>
   <td style="text-align:right;"> 0.000 </td>
   <td style="text-align:right;"> 0.1190 </td>
   <td style="text-align:right;"> -19.924 </td>
   <td style="text-align:right;"> 0.9290 </td>
   <td style="text-align:right;"> 107.177 </td>
   <td style="text-align:right;"> 0.8800 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> Seweryn Goszczyński </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 6M94FkXd15sOAOQYRnWPN8 </td>
   <td style="text-align:left;"> Bebamos Juntos - Instrumental (Remasterizado) </td>
   <td style="text-align:right;"> 180760 </td>
   <td style="text-align:left;"> 9/25/28 </td>
   <td style="text-align:right;"> 1928 </td>
   <td style="text-align:right;"> 0.995 </td>
   <td style="text-align:right;"> 0.781 </td>
   <td style="text-align:right;"> 0.1300 </td>
   <td style="text-align:right;"> 0.887 </td>
   <td style="text-align:right;"> 0.1110 </td>
   <td style="text-align:right;"> -14.734 </td>
   <td style="text-align:right;"> 0.0926 </td>
   <td style="text-align:right;"> 108.003 </td>
   <td style="text-align:right;"> 0.7200 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> Francisco Canaro </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 6N6tiFZ9vLTSOIxkj8qKrd </td>
   <td style="text-align:left;"> Polonaise-Fantaisie in A-Flat Major, Op. 61 </td>
   <td style="text-align:right;"> 687733 </td>
   <td style="text-align:left;"> 1928 </td>
   <td style="text-align:right;"> 1928 </td>
   <td style="text-align:right;"> 0.990 </td>
   <td style="text-align:right;"> 0.210 </td>
   <td style="text-align:right;"> 0.2040 </td>
   <td style="text-align:right;"> 0.908 </td>
   <td style="text-align:right;"> 0.0980 </td>
   <td style="text-align:right;"> -16.829 </td>
   <td style="text-align:right;"> 0.0424 </td>
   <td style="text-align:right;"> 62.149 </td>
   <td style="text-align:right;"> 0.0693 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> Frédéric Chopin </td>
  </tr>
</tbody>
</table>

`````
:::
:::



The song characteristics dataset contains 226813 rows and 19 columns, with features like popularity, danceability, energy, and more. Each row represents a song-artist combination, as songs with multiple artists have been split into separate rows for easier analysis.

## Task 2: Playlist Dataset

Next, I'll create a function to download and load the Spotify playlist dataset. This dataset is much larger and stored across multiple JSON files, so my function will handle downloading and combining them.



::: {.cell}

```{.r .cell-code}
load_playlists <- function(max_slice = 9999,
                           step      = 1000,
                           quick     = FALSE) {
  # — Quick mode for development (loads only first few slices) —
  if (quick) {
    max_slice <- 2000
    message("⚡ QUICK mode: slices 0–", max_slice)
  }
  
  # 1) Professor-provided JSON folder on OneDrive
  local_prof_dir <- "C:/Users/gerus/OneDrive/Documents/STA9750-2025-SPRING/spotify_million_playlist_dataset/data1"
  
  # 2) Fallback: repository folder for downloaded JSON
  dest_dir <- "data/mp03/playlists"
  if (!dir.exists(dest_dir)) {
    dir.create(dest_dir, recursive = TRUE)
    message("Created directory: ", dest_dir)
  }
  
  all_playlists <- list()
  
  if (dir.exists(local_prof_dir)) {
    # Load from local OneDrive copy
    message("Loading playlist JSONs from OneDrive: ", local_prof_dir)
    files <- list.files(local_prof_dir, pattern = "mpd.slice.*\\.json$", full.names = TRUE)
    all_playlists <- purrr::map(files, ~ {
      d <- jsonlite::fromJSON(.x, simplifyDataFrame = FALSE)
      d$playlists %||% list()
    }) %>% purrr::flatten()
    
  } else {
    # Download from GitHub into dest_dir
    message("No local folder—downloading from GitHub")
    base_url <- "https://raw.githubusercontent.com/DevinOgrady/spotify_million_playlist_dataset/main/data1"
    
    for (start in seq(0, max_slice, by = step)) {
      end      <- start + step - 1
      filename <- sprintf("mpd.slice.%d-%d.json", start, end)
      local_path <- file.path(dest_dir, filename)
      
      if (!file.exists(local_path)) {
        tryCatch({
          download.file(paste0(base_url, "/", filename),
                        local_path, mode = "wb", quiet = TRUE)
          message("Downloaded ", filename)
          Sys.sleep(0.2)
        }, error = function(e) {
          message("Error downloading ", filename, ": ", e$message)
        })
      }
      
      if (file.exists(local_path)) {
        d <- jsonlite::fromJSON(local_path, simplifyDataFrame = FALSE)
        if ("playlists" %in% names(d)) {
          all_playlists <- c(all_playlists, d$playlists)
          message("Processed ", filename, " (", length(d$playlists), " playlists)")
        }
      }
    }
  }
  
  return(all_playlists)
}

# — During development, you can test with a smaller subset: —
# playlists <- load_playlists(quick = TRUE)

# — For your full run (final submission): —
playlists <- load_playlists()
```
:::



Successfully loaded 4000 playlists from the Spotify Million Playlist dataset. Each playlist contains information about its name, followers, and tracks. Now I'll process this hierarchical JSON data into a rectangular format for easier analysis.

## Task 3: Rectangling the Playlist Data

The playlist data is currently in a nested, hierarchical format. To make it more accessible for analysis, I'll convert it to a rectangular format with one row per track-playlist combination.



::: {.cell}

```{.r .cell-code}
## Task 3: Rectangling the Playlist Data
rectangle_playlists <- function(pls) {
  # load progress bar
  pb <- progress::progress_bar$new(
    total = length(pls),
    format = "  Processing playlists [:bar] :percent eta: :eta",
    clear = FALSE
  )
  
  purrr::map_dfr(pls, function(p) {
    pb$tick()  # advance the bar
    
    # Extract playlist‐level metadata
    pid     <- p$pid
    pname   <- p$name
    pfollow <- p$num_followers %||% NA_integer_
    
    # Iterate over tracks
    purrr::map_dfr(seq_along(p$tracks), function(i) {
      t <- p$tracks[[i]]
      tibble::tibble(
        playlist_id        = pid,
        playlist_name      = pname,
        playlist_followers = pfollow,
        playlist_position  = i,
        artist_name        = t$artist_name,
        artist_id          = sub(".*:.*:(.*)$", "\\1", t$artist_uri),
        track_name         = t$track_name,
        track_id           = sub(".*:.*:(.*)$", "\\1", t$track_uri),
        album_name         = t$album_name,
        album_id           = sub(".*:.*:(.*)$", "\\1", t$album_uri),
        duration           = t$duration_ms
      )
    })
  })
}

# 1. Transform the data
rectangular_playlists <- rectangle_playlists(playlists)

# 2. Show a quick preview
head(rectangular_playlists, 10) %>%
  kable(
    caption = "Sample of Rectangular Playlist Data (Real JSON)",
    digits  = 2
  ) %>%
  kable_styling(bootstrap_options = c("striped","hover","condensed"), full_width = FALSE)
```

::: {.cell-output-display}
`````{=html}
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Sample of Rectangular Playlist Data (Real JSON)</caption>
 <thead>
  <tr>
   <th style="text-align:right;"> playlist_id </th>
   <th style="text-align:left;"> playlist_name </th>
   <th style="text-align:right;"> playlist_followers </th>
   <th style="text-align:right;"> playlist_position </th>
   <th style="text-align:left;"> artist_name </th>
   <th style="text-align:left;"> artist_id </th>
   <th style="text-align:left;"> track_name </th>
   <th style="text-align:left;"> track_id </th>
   <th style="text-align:left;"> album_name </th>
   <th style="text-align:left;"> album_id </th>
   <th style="text-align:right;"> duration </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> Throwbacks </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> Missy Elliott </td>
   <td style="text-align:left;"> 2wIVse2owClT7go1WT98tk </td>
   <td style="text-align:left;"> Lose Control (feat. Ciara &amp; Fat Man Scoop) </td>
   <td style="text-align:left;"> 0UaMYEvWZi0ZqiDOoHU3YI </td>
   <td style="text-align:left;"> The Cookbook </td>
   <td style="text-align:left;"> 6vV5UrXcfyQD1wu4Qo2I9K </td>
   <td style="text-align:right;"> 226863 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> Throwbacks </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:left;"> Britney Spears </td>
   <td style="text-align:left;"> 26dSoYclwsYLMAKD3tpOr4 </td>
   <td style="text-align:left;"> Toxic </td>
   <td style="text-align:left;"> 6I9VzXrHxO9rA9A5euc8Ak </td>
   <td style="text-align:left;"> In The Zone </td>
   <td style="text-align:left;"> 0z7pVBGOD7HCIB7S8eLkLI </td>
   <td style="text-align:right;"> 198800 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> Throwbacks </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:left;"> Beyoncé </td>
   <td style="text-align:left;"> 6vWDO969PvNqNYHIOW5v0m </td>
   <td style="text-align:left;"> Crazy In Love </td>
   <td style="text-align:left;"> 0WqIKmW4BTrj3eJFmnCKMv </td>
   <td style="text-align:left;"> Dangerously In Love (Alben für die Ewigkeit) </td>
   <td style="text-align:left;"> 25hVFAxTlDvXbx2X2QkUkE </td>
   <td style="text-align:right;"> 235933 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> Throwbacks </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:left;"> Justin Timberlake </td>
   <td style="text-align:left;"> 31TPClRtHm23RisEBtV3X7 </td>
   <td style="text-align:left;"> Rock Your Body </td>
   <td style="text-align:left;"> 1AWQoqb9bSvzTjaLralEkT </td>
   <td style="text-align:left;"> Justified </td>
   <td style="text-align:left;"> 6QPkyl04rXwTGlGlcYaRoW </td>
   <td style="text-align:right;"> 267266 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> Throwbacks </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:left;"> Shaggy </td>
   <td style="text-align:left;"> 5EvFsr3kj42KNv97ZEnqij </td>
   <td style="text-align:left;"> It Wasn't Me </td>
   <td style="text-align:left;"> 1lzr43nnXAijIGYnCT8M8H </td>
   <td style="text-align:left;"> Hot Shot </td>
   <td style="text-align:left;"> 6NmFmPX56pcLBOFMhIiKvF </td>
   <td style="text-align:right;"> 227600 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> Throwbacks </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:left;"> Usher </td>
   <td style="text-align:left;"> 23zg3TcAtWQy7J6upgbUnj </td>
   <td style="text-align:left;"> Yeah! </td>
   <td style="text-align:left;"> 0XUfyU2QviPAs6bxSpXYG4 </td>
   <td style="text-align:left;"> Confessions </td>
   <td style="text-align:left;"> 0vO0b1AvY49CPQyVisJLj0 </td>
   <td style="text-align:right;"> 250373 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> Throwbacks </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:left;"> Usher </td>
   <td style="text-align:left;"> 23zg3TcAtWQy7J6upgbUnj </td>
   <td style="text-align:left;"> My Boo </td>
   <td style="text-align:left;"> 68vgtRHr7iZHpzGpon6Jlo </td>
   <td style="text-align:left;"> Confessions </td>
   <td style="text-align:left;"> 1RM6MGv6bcl6NrAG8PGoZk </td>
   <td style="text-align:right;"> 223440 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> Throwbacks </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:left;"> The Pussycat Dolls </td>
   <td style="text-align:left;"> 6wPhSqRtPu1UhRCDX5yaDJ </td>
   <td style="text-align:left;"> Buttons </td>
   <td style="text-align:left;"> 3BxWKCI06eQ5Od8TY2JBeA </td>
   <td style="text-align:left;"> PCD </td>
   <td style="text-align:left;"> 5x8e8UcCeOgrOzSnDGuPye </td>
   <td style="text-align:right;"> 225560 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> Throwbacks </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:left;"> Destiny's Child </td>
   <td style="text-align:left;"> 1Y8cdNmUJH7yBTd9yOvr5i </td>
   <td style="text-align:left;"> Say My Name </td>
   <td style="text-align:left;"> 7H6ev70Weq6DdpZyyTmUXk </td>
   <td style="text-align:left;"> The Writing's On The Wall </td>
   <td style="text-align:left;"> 283NWqNsCA9GwVHrJk59CG </td>
   <td style="text-align:right;"> 271333 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> Throwbacks </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:left;"> OutKast </td>
   <td style="text-align:left;"> 1G9G7WwrXka3Z1r7aIDjI7 </td>
   <td style="text-align:left;"> Hey Ya! - Radio Mix / Club Mix </td>
   <td style="text-align:left;"> 2PpruBYCo4H7WOBJ7Q2EwM </td>
   <td style="text-align:left;"> Speakerboxxx/The Love Below </td>
   <td style="text-align:left;"> 1UsmQ3bpJTyK6ygoOOjG1r </td>
   <td style="text-align:right;"> 235213 </td>
  </tr>
</tbody>
</table>

`````
:::

```{.r .cell-code}
# 3. Report the total number of rows
cat("✅ Total track–playlist rows:", nrow(rectangular_playlists), "\n")
```

::: {.cell-output .cell-output-stdout}

```
✅ Total track–playlist rows: 268251 
```


:::
:::



Successfully converted the playlist data to a rectangular format with 268251 rows. Each row represents a track's appearance in a playlist, with information about both the playlist and the track.

## Task 4: Initial Exploration

Now that our data is rectangular, let’s see how many items we have and what immediately stands out.




::: {.cell}

```{.r .cell-code}
# 1. Distinct counts
distinct_tracks  <- rectangular_playlists %>% distinct(track_id)  %>% nrow()
distinct_artists <- rectangular_playlists %>% distinct(artist_id) %>% nrow()

cat(
  "🎵 Distinct tracks in playlist data: ",  distinct_tracks,  "\n",
  "👩‍🎤 Distinct artists in playlist data: ", distinct_artists, "\n\n"
)
```

::: {.cell-output .cell-output-stdout}

```
🎵 Distinct tracks in playlist data:  92815 
 👩‍🎤 Distinct artists in playlist data:  22090 
```


:::

```{.r .cell-code}
# 2. Top 5 most popular tracks (by playlist appearances)
popular_tracks <- rectangular_playlists %>%
  count(track_id, track_name, artist_name, name = "appearances", sort = TRUE) %>%
  slice_head(n = 5)

popular_tracks %>%
  kable(
    caption = "Top 5 Tracks by Playlist Appearances",
    col.names = c("Track ID", "Track Name", "Artist", "# Appearances"),
    digits = 0
  ) %>%
  kable_styling(bootstrap_options = c("striped","hover","condensed"), full_width = FALSE)
```

::: {.cell-output-display}
`````{=html}
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Top 5 Tracks by Playlist Appearances</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> Track ID </th>
   <th style="text-align:left;"> Track Name </th>
   <th style="text-align:left;"> Artist </th>
   <th style="text-align:right;"> # Appearances </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 7BKLCZ1jbUBVqRi2FVlTVw </td>
   <td style="text-align:left;"> Closer </td>
   <td style="text-align:left;"> The Chainsmokers </td>
   <td style="text-align:right;"> 193 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 1xznGGDReH1oQq0xzbwXa3 </td>
   <td style="text-align:left;"> One Dance </td>
   <td style="text-align:left;"> Drake </td>
   <td style="text-align:right;"> 189 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 7KXjTSCq5nL1LoYtL7XAwS </td>
   <td style="text-align:left;"> HUMBLE. </td>
   <td style="text-align:left;"> Kendrick Lamar </td>
   <td style="text-align:right;"> 184 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 7yyRTcZmCiyzzJlNzGC9Ol </td>
   <td style="text-align:left;"> Broccoli (feat. Lil Yachty) </td>
   <td style="text-align:left;"> DRAM </td>
   <td style="text-align:right;"> 170 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 3a1lNhkSLSkpJE4MSHpDu9 </td>
   <td style="text-align:left;"> Congratulations </td>
   <td style="text-align:left;"> Post Malone </td>
   <td style="text-align:right;"> 159 </td>
  </tr>
</tbody>
</table>

`````
:::

```{.r .cell-code}
# 3. Most popular track missing from song characteristics
songs_with_id <- songs_df %>% rename(track_id = id)
missing_track <- rectangular_playlists %>%
  anti_join(songs_with_id, by = "track_id") %>%
  count(track_id, track_name, artist_name, name = "appearances", sort = TRUE) %>%
  slice_head(n = 1)

missing_track %>%
  kable(
    caption = "Top Track in Playlists Absent from Characteristics Dataset",
    col.names = c("Track ID", "Track Name", "Artist", "# Appearances"),
    digits = 0
  ) %>%
  kable_styling(bootstrap_options = c("striped","hover","condensed"), full_width = FALSE)
```

::: {.cell-output-display}
`````{=html}
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Top Track in Playlists Absent from Characteristics Dataset</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> Track ID </th>
   <th style="text-align:left;"> Track Name </th>
   <th style="text-align:left;"> Artist </th>
   <th style="text-align:right;"> # Appearances </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 1xznGGDReH1oQq0xzbwXa3 </td>
   <td style="text-align:left;"> One Dance </td>
   <td style="text-align:left;"> Drake </td>
   <td style="text-align:right;"> 189 </td>
  </tr>
</tbody>
</table>

`````
:::

```{.r .cell-code}
# 4. Most danceable track and its playlist count
most_danceable <- songs_with_id %>% arrange(desc(danceability)) %>% slice_head(n = 1)
danceable_count <- rectangular_playlists %>% 
  filter(track_id == most_danceable$track_id) %>% nrow()

danceable_info <- tibble::tibble(
  Track       = most_danceable$name,
  Artist      = most_danceable$artist,
  Danceability= round(most_danceable$danceability, 3),
  Appearances = danceable_count
)

danceable_info %>%
  kable(
    caption = "Most Danceable Track and Its Playlist Appearances"
  ) %>%
  kable_styling(bootstrap_options = c("striped","hover","condensed"), full_width = FALSE)
```

::: {.cell-output-display}
`````{=html}
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Most Danceable Track and Its Playlist Appearances</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> Track </th>
   <th style="text-align:left;"> Artist </th>
   <th style="text-align:right;"> Danceability </th>
   <th style="text-align:right;"> Appearances </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Funky Cold Medina </td>
   <td style="text-align:left;"> Tone-Loc </td>
   <td style="text-align:right;"> 0.988 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
</tbody>
</table>

`````
:::

```{.r .cell-code}
# 5. Playlist with the longest average track duration
longest_avg <- rectangular_playlists %>%
  group_by(playlist_id, playlist_name) %>%
  summarise(
    avg_duration_min = mean(duration, na.rm = TRUE) / 60000,
    n_tracks         = n(),
    .groups = "drop"
  ) %>%
  filter(n_tracks >= 5) %>%
  arrange(desc(avg_duration_min)) %>%
  slice_head(n = 1)

longest_avg %>%
  kable(
    caption = "Playlist with the Longest Average Track Length",
    col.names = c("Playlist ID", "Playlist Name", "Avg. Duration (min)", "# Tracks"),
    digits = c(NA, NA, 2, 0)
  ) %>%
  kable_styling(bootstrap_options = c("striped","hover","condensed"), full_width = FALSE)
```

::: {.cell-output-display}
`````{=html}
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Playlist with the Longest Average Track Length</caption>
 <thead>
  <tr>
   <th style="text-align:right;"> Playlist ID </th>
   <th style="text-align:left;"> Playlist Name </th>
   <th style="text-align:right;"> Avg. Duration (min) </th>
   <th style="text-align:right;"> # Tracks </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:left;"> sleep </td>
   <td style="text-align:right;"> 14.81 </td>
   <td style="text-align:right;"> 29 </td>
  </tr>
</tbody>
</table>

`````
:::

```{.r .cell-code}
# 6. Most followed playlist
top_playlist <- rectangular_playlists %>%
  group_by(playlist_id, playlist_name) %>%
  summarise(
    followers = first(playlist_followers),
    n_tracks  = n(),
    .groups = "drop"
  ) %>%
  arrange(desc(followers)) %>%
  slice_head(n = 1)

top_playlist %>%
  kable(
    caption = "Most Followed Playlist on Spotify",
    col.names = c("Playlist ID", "Playlist Name", "# Followers", "# Tracks"),
    digits = 0
  ) %>%
  kable_styling(bootstrap_options = c("striped","hover","condensed"), full_width = FALSE)
```

::: {.cell-output-display}
`````{=html}
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Most Followed Playlist on Spotify</caption>
 <thead>
  <tr>
   <th style="text-align:right;"> Playlist ID </th>
   <th style="text-align:left;"> Playlist Name </th>
   <th style="text-align:right;"> # Followers </th>
   <th style="text-align:right;"> # Tracks </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 7215 </td>
   <td style="text-align:left;"> TOP POP </td>
   <td style="text-align:right;"> 15842 </td>
   <td style="text-align:right;"> 52 </td>
  </tr>
</tbody>
</table>

`````
:::
:::



From this initial exploration, we’ve discovered:

🎵 r distinct_tracks unique tracks and r distinct_artists unique artists across all playlists.

🔝 The top track by playlist appearances is “r popular_tracks$track_name[1]” by r popular_tracks$artist_name[1], appearing r popular_tracks$appearances[1] times.

⚠️ One highly‐ranked track, “r missing_track$track_name”, doesn’t appear in the song-characteristics dataset, highlighting a gap in the data.

💃 The most danceable song is “r most_danceable$name” by r most_danceable$artist (danceability r round(most_danceable$danceability,3)), with r most_danceable_appearances playlist appearances.

⏱️ The playlist with the longest average track length is “r longest_avg$playlist_name”, averaging r round(longest_avg$avg_duration_min,2) minutes per track.

🌟 The most followed playlist is “r top_playlist$playlist_name” with r top_playlist$followers followers.

## Combining Datasets

Now we’ll merge our cleaned song characteristics (songs_df) with the playlist appearances (rectangular_playlists) so each track record carries both its audio features and how many times it appears in user playlists.



::: {.cell}

```{.r .cell-code}
# 1) Prepare songs_df with consistent track_id and ensure year is numeric
songs_with_id <- songs_df %>%
  rename(track_id = id) %>%
  # If release_date is a character, extract year; otherwise use existing year
  mutate(
    year = if ("year" %in% names(.)) as.integer(year)
           else lubridate::year(lubridate::as_date(release_date))
  )

# 2) Inner join: only keep tracks present in both datasets
joined_data <- rectangular_playlists %>%
  inner_join(songs_with_id, by = "track_id")

# Sanity check
cat("✅ After join, we have", nrow(joined_data), 
    "rows covering", n_distinct(joined_data$track_id), "unique tracks.\n\n")
```

::: {.cell-output .cell-output-stdout}

```
✅ After join, we have 150808 rows covering 19401 unique tracks.
```


:::

```{.r .cell-code}
# 3) Compute appearances
track_appearances <- joined_data %>%
  count(track_id, name = "playlist_appearances")

# 4) Build final analysis dataset, including year
track_data <- joined_data %>%
  select(
    track_id, track_name, artist_name,
    popularity, danceability, energy, key, mode, tempo,
    duration, year
  ) %>%
  distinct(track_id, .keep_all = TRUE) %>%
  left_join(track_appearances, by = "track_id") %>%
  # Derive additional fields
  mutate(
    duration_min = duration / (1000 * 60),
    decade       = (year %/% 10) * 10
  )

# 5) Show a sample
head(track_data) %>%
  kable(
    caption = "Sample of Combined Track Data",
    digits  = 2
  ) %>%
  kable_styling(bootstrap_options = c("striped","hover","condensed"), full_width = FALSE)
```

::: {.cell-output-display}
`````{=html}
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Sample of Combined Track Data</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> track_id </th>
   <th style="text-align:left;"> track_name </th>
   <th style="text-align:left;"> artist_name </th>
   <th style="text-align:right;"> popularity </th>
   <th style="text-align:right;"> danceability </th>
   <th style="text-align:right;"> energy </th>
   <th style="text-align:right;"> key </th>
   <th style="text-align:right;"> mode </th>
   <th style="text-align:right;"> tempo </th>
   <th style="text-align:right;"> duration </th>
   <th style="text-align:right;"> year </th>
   <th style="text-align:right;"> playlist_appearances </th>
   <th style="text-align:right;"> duration_min </th>
   <th style="text-align:right;"> decade </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 0UaMYEvWZi0ZqiDOoHU3YI </td>
   <td style="text-align:left;"> Lose Control (feat. Ciara &amp; Fat Man Scoop) </td>
   <td style="text-align:left;"> Missy Elliott </td>
   <td style="text-align:right;"> 67 </td>
   <td style="text-align:right;"> 0.90 </td>
   <td style="text-align:right;"> 0.81 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 125.46 </td>
   <td style="text-align:right;"> 226863 </td>
   <td style="text-align:right;"> 2005 </td>
   <td style="text-align:right;"> 69 </td>
   <td style="text-align:right;"> 3.78 </td>
   <td style="text-align:right;"> 2000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 6I9VzXrHxO9rA9A5euc8Ak </td>
   <td style="text-align:left;"> Toxic </td>
   <td style="text-align:left;"> Britney Spears </td>
   <td style="text-align:right;"> 79 </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 143.04 </td>
   <td style="text-align:right;"> 198800 </td>
   <td style="text-align:right;"> 2003 </td>
   <td style="text-align:right;"> 51 </td>
   <td style="text-align:right;"> 3.31 </td>
   <td style="text-align:right;"> 2000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 1AWQoqb9bSvzTjaLralEkT </td>
   <td style="text-align:left;"> Rock Your Body </td>
   <td style="text-align:left;"> Justin Timberlake </td>
   <td style="text-align:right;"> 71 </td>
   <td style="text-align:right;"> 0.89 </td>
   <td style="text-align:right;"> 0.71 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 100.97 </td>
   <td style="text-align:right;"> 267266 </td>
   <td style="text-align:right;"> 2002 </td>
   <td style="text-align:right;"> 32 </td>
   <td style="text-align:right;"> 4.45 </td>
   <td style="text-align:right;"> 2000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 68vgtRHr7iZHpzGpon6Jlo </td>
   <td style="text-align:left;"> My Boo </td>
   <td style="text-align:left;"> Usher </td>
   <td style="text-align:right;"> 76 </td>
   <td style="text-align:right;"> 0.66 </td>
   <td style="text-align:right;"> 0.51 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 86.41 </td>
   <td style="text-align:right;"> 223440 </td>
   <td style="text-align:right;"> 2004 </td>
   <td style="text-align:right;"> 72 </td>
   <td style="text-align:right;"> 3.72 </td>
   <td style="text-align:right;"> 2000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 3BxWKCI06eQ5Od8TY2JBeA </td>
   <td style="text-align:left;"> Buttons </td>
   <td style="text-align:left;"> The Pussycat Dolls </td>
   <td style="text-align:right;"> 64 </td>
   <td style="text-align:right;"> 0.57 </td>
   <td style="text-align:right;"> 0.82 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 210.86 </td>
   <td style="text-align:right;"> 225560 </td>
   <td style="text-align:right;"> 2005 </td>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:right;"> 3.76 </td>
   <td style="text-align:right;"> 2000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 7H6ev70Weq6DdpZyyTmUXk </td>
   <td style="text-align:left;"> Say My Name </td>
   <td style="text-align:left;"> Destiny's Child </td>
   <td style="text-align:right;"> 76 </td>
   <td style="text-align:right;"> 0.71 </td>
   <td style="text-align:right;"> 0.68 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 138.01 </td>
   <td style="text-align:right;"> 271333 </td>
   <td style="text-align:right;"> 1999 </td>
   <td style="text-align:right;"> 49 </td>
   <td style="text-align:right;"> 4.52 </td>
   <td style="text-align:right;"> 1990 </td>
  </tr>
</tbody>
</table>

`````
:::
:::



## Task 5: Visually Identifying Characteristics of Popular Songs

Now I'll create visualizations to answer the required questions about popular songs.

### Question 1: Is popularity correlated with playlist appearances?



::: {.cell}

```{.r .cell-code}
# 1. Compute the correlation
pop_appearance_cor <- cor(
  track_data$popularity,
  track_data$playlist_appearances,
  use = "complete.obs"
)

# 2. Scatterplot with viridis color mapping
ggplot(track_data, aes(x = playlist_appearances, y = popularity, color = popularity)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = TRUE) +
  scale_x_log10() +
  scale_color_viridis_c(option = "viridis", begin = 0.2, end = 0.8) +
  labs(
    title    = "Song Popularity vs. Playlist Appearances",
    subtitle = paste0("Correlation coefficient = ", round(pop_appearance_cor, 3)),
    x        = "Number of Playlist Appearances (log scale)",
    y        = "Popularity Score (0–100)",
    color    = "Popularity",
    caption  = "Data: Spotify song characteristics & user playlists"
  ) +
  theme_minimal() +
  theme(
    plot.title       = element_text(face = "bold", size = 16),
    plot.subtitle    = element_text(size = 12),
    axis.title       = element_text(face = "bold"),
    legend.position  = "right",
    panel.grid.major = element_line(linetype = "dashed")
  )
```

::: {.cell-output-display}
![](mp03_files/figure-html/popularity-correlation-1.png){width=3000}
:::
:::



There’s a moderate positive correlation (r round(pop_appearance_cor, 3)) between a song’s popularity score and the number of playlists it appears in. The color gradient highlights that higher-popularity songs (yellowish points) tend to cluster at higher appearance counts, though outliers exist on both axes.

### Question 2: In what year were the most popular songs released?

First, I'll define a threshold for "popular" songs.



::: {.cell}

```{.r .cell-code}
#1. Define threshold
popularity_threshold <- 75

# Pick the most recent song at that threshold
threshold_song <- track_data %>%
  filter(popularity >= popularity_threshold) %>%
  arrange(desc(year)) %>%
  slice_head(n = 1)

# Show it
threshold_song %>%
  select(track_name, artist_name, popularity, year) %>%
  kable(
    caption = paste("Example Song at Popularity ≥", popularity_threshold),
    col.names = c("Track", "Artist", "Popularity", "Release Year")
  ) %>%
  kable_styling(
    bootstrap_options = c("striped","hover","condensed"),
    full_width = FALSE
  )
```

::: {.cell-output-display}
`````{=html}
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Example Song at Popularity ≥ 75</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> Track </th>
   <th style="text-align:left;"> Artist </th>
   <th style="text-align:right;"> Popularity </th>
   <th style="text-align:right;"> Release Year </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Spring Day </td>
   <td style="text-align:left;"> BTS </td>
   <td style="text-align:right;"> 75 </td>
   <td style="text-align:right;"> 2017 </td>
  </tr>
</tbody>
</table>

`````
:::

```{.r .cell-code}
# 2. Inspect a representative song right at the threshold
# to get the most recent song at the threshold:
track_data %>%
  filter(popularity >= popularity_threshold) %>%
  filter(popularity == popularity_threshold) %>%
  arrange(desc(year)) %>%
  slice_head(n = 1)
```

::: {.cell-output .cell-output-stdout}

```
# A tibble: 1 × 14
  track_id     track_name artist_name popularity danceability energy   key  mode
  <chr>        <chr>      <chr>            <int>        <dbl>  <dbl> <int> <int>
1 0WNGsQ1oAuH… Spring Day BTS                 75        0.539  0.846     8     1
# ℹ 6 more variables: tempo <dbl>, duration <int>, year <int>,
#   playlist_appearances <int>, duration_min <dbl>, decade <dbl>
```


:::

```{.r .cell-code}
threshold_song %>%
  select(track_name, artist_name, popularity, year) %>%
  kable(
    caption = paste("Example Song at Popularity ≥", popularity_threshold),
    col.names = c("Track", "Artist", "Popularity", "Release Year")
  ) %>%
  kable_styling(bootstrap_options = c("striped","hover","condensed"), full_width = FALSE)
```

::: {.cell-output-display}
`````{=html}
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Example Song at Popularity ≥ 75</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> Track </th>
   <th style="text-align:left;"> Artist </th>
   <th style="text-align:right;"> Popularity </th>
   <th style="text-align:right;"> Release Year </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Spring Day </td>
   <td style="text-align:left;"> BTS </td>
   <td style="text-align:right;"> 75 </td>
   <td style="text-align:right;"> 2017 </td>
  </tr>
</tbody>
</table>

`````
:::
:::



 To focus on the songs that truly stand out on Spotify, I set a popularity cutoff of **75**. As a sanity check, I then pulled the most recent track meeting this threshold. The result is **“Spring Day” by BTS** (popularity = 75, released in **2017**), which confirms that our threshold captures both current hits and broadly listened-to tracks without excluding older classics. This balance ensures our “popular” category reflects true listener engagement across eras.



::: {.cell}

```{.r .cell-code}
# 1. Define popularity threshold and filter
popularity_threshold <- 75
popular_songs <- track_data %>%
  filter(popularity >= popularity_threshold)

# 2. Count how many “popular” songs were released each year
popular_by_year <- popular_songs %>%
  count(year, name = "num_songs") %>%
  arrange(desc(num_songs))

# 3. Plot as a bar chart
ggplot(popular_by_year, aes(x = year, y = num_songs)) +
  geom_col(fill = viridis(1)) +
  geom_text(aes(label = num_songs), vjust = -0.5, size = 3) +
  scale_x_continuous(
    breaks = seq(min(popular_by_year$year, na.rm = TRUE),
                 max(popular_by_year$year, na.rm = TRUE),
                 by = 5)
  ) +
  labs(
    title    = "Release Year Distribution of Popular Songs",
    subtitle = paste0("Songs with popularity ≥ ", popularity_threshold),
    x        = "Release Year",
    y        = "Number of Songs",
    caption  = "Source: Spotify song characteristics dataset"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title       = element_text(face = "bold", size = 16),
    plot.subtitle    = element_text(size = 12),
    axis.title       = element_text(face = "bold"),
    panel.grid.major = element_line(linetype = "dashed")
  )
```

::: {.cell-output-display}
![](mp03_files/figure-html/popular-songs-by-year-1.png){width=3000}
:::
:::



1. **Recency Bias in Spotify’s Popularity Metric**  
   - Notice the huge spike in **2017** (87 songs) compared to earlier years. Spotify’s “popularity” score is largely driven by recent streaming activity and playlist inclusions, so newly released songs get more momentum in the algorithm. That inflates counts for the last few years versus older tracks.

2. **Growth of the Streaming Catalog**  
   - In the mid-2010s, Spotify really took off globally. More artists, more catalog additions, and more users meant more releases and more streams—so you see a jump from single-digit counts in the early 2000s to dozens of songs per year after 2012.

3. **Long Tail of Classics**  
   - Even though 1976 and 1980 show low bars (4–7 songs), those represent the **iconic** tracks that still rack up enough play counts to cross our popularity threshold. Their presence in user-generated playlists decades later speaks to their enduring cultural impact.

4. **Dataset Coverage and Licensing**  
   - Some very old tracks (pre-1970) won’t appear simply because they either aren’t on Spotify or have low streaming volumes. So the near-zero counts in the 1960s may reflect missing catalog entries more than listener disinterest.

5. **Threshold Sensitivity**  
   - We set our cutoff at 75—but if we lowered it to 70 or raised it to 80, the shape would shift slightly. It’s worth experimenting with different thresholds to see how the peak year moves—another form of **sensitivity analysis**.

6. **Cultural & Technological Milestones**  
   - The uptick around **2000–2005** (5–10 songs per year) corresponds to the rise of digital music stores and early streaming adopters. The really steep climb post-2010 aligns with smartphones and the Spotify mobile app’s growth.

7. **Implications for Playlist Curation**  
   - A curator aiming for “timelessness” might deliberately mix in those 4–7 classics from the 70s/80s with the 40–80 recent hits, to balance fresh discoveries with proven favorites.

Putting it all together, this chart doesn’t just show “when popular songs were released”—it also exposes how **platform dynamics**, **catalog completeness**, and **listener behavior** converge to shape what Spotify’s algorithms call “popular.”

### Question 3: In what year did danceability peak?



::: {.cell}

```{.r .cell-code}
# 1. Compute average danceability by year
danceability_by_year <- track_data %>%
  group_by(year) %>%
  summarise(
    avg_danceability = mean(danceability, na.rm = TRUE),
    num_songs        = n(),
    .groups = "drop"
  ) %>%
  arrange(year)

# 2. Identify peak year
peak_row <- danceability_by_year %>% slice_max(avg_danceability, n = 1)
peak_year  <- peak_row$year
peak_value <- peak_row$avg_danceability

# 3. Plot trend
ggplot(danceability_by_year, aes(x = year, y = avg_danceability, size = num_songs)) +
  geom_line(color = viridis(1), size = 1.2) +
  geom_point(alpha = 0.7, color = viridis(1)) +
  # Highlight the peak
  geom_point(data = peak_row, aes(x = year, y = avg_danceability), 
             color = "#e74c3c", size = 4) +
  geom_text(data = peak_row, aes(x = year, y = avg_danceability, 
            label = paste0("Peak: ", year)), 
            vjust = -1, hjust = 0.5, color = "green", fontface = "bold") +
  scale_size_continuous(name = "Number of Songs") +
  labs(
    title    = "Average Danceability by Release Year",
    subtitle = "Point size indicates number of tracks released that year",
    x        = "Release Year",
    y        = "Average Danceability (0–1)",
    caption  = "Source: Combined Spotify datasets"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title       = element_text(face = "bold", size = 16),
    plot.subtitle    = element_text(size = 12),
    axis.title       = element_text(face = "bold"),
    panel.grid.major = element_line(linetype = "dashed")
  ) +
  scale_x_continuous(breaks = seq(min(danceability_by_year$year, na.rm = TRUE),
                                  max(danceability_by_year$year, na.rm = TRUE),
                                  by = 5))
```

::: {.cell-output-display}
![](mp03_files/figure-html/danceability-peak-1.png){width=3000}
:::
:::




1. **Early Jazz & Swing Peak**  
   - The highest average danceability actually occurs around **1938**, hitting roughly **0.66**. This likely reflects the peak of swing and big-band jazz—genres built around strong, dance-floor grooves.

2. **Mid-Century Fluctuations**  
   - In the 1940s and ’50s you see wild swings (dropping as low as 0.30 in 1948, then back up). That volatility matches the rapid rise and fall of dance crazes—from wartime ballads to 1950s rock-and-roll.

3. **Gradual Rise from the 1970s**  
   - Starting in the late ’60s and early ’70s, average danceability climbs steadily—from around **0.50** up to about **0.60** by the early ’90s. This reflects the ascendancy of disco, funk, and early electronic pop, all engineered to get people moving.

4. **2000s Plateau & Resurgence**  
   - There’s a modest dip in the early 2000s—perhaps as singer-songwriter and alternative genres briefly eclipsed dance-oriented pop—before a renewed uptick post-2010 as EDM and dance-pop dominate the charts again.

5. **Point Sizes Tell a Story**  
   - Notice the point sizes grow dramatically after 2000: that means **more tracks** are in our dataset for those years, so the averages are statistically more robust. The early years (small points) are based on fewer available recordings but still show clear genre effects.

6. **Implications for Curation**  
   - If you’re building a “dancey” playlist, anchoring around those late-’30s swing classics might surprise listeners, but blending them with ’70s disco and modern EDM creates a historical “dance journey” that showcases how the concept of danceability has evolved.


### Question 4: Which decade is most represented on user playlists?



::: {.cell}

```{.r .cell-code}
# 1. Join to get release year on each playlist appearance
playlist_tracks <- rectangular_playlists %>%
  select(track_id) %>%
  distinct() %>%
  inner_join(track_data %>% select(track_id, year), by = "track_id")

# 2. Map each appearance to a decade and count total appearances
appearances_by_decade <- rectangular_playlists %>%
  inner_join(track_data %>% select(track_id, year), by = "track_id") %>%
  mutate(decade = (year %/% 10) * 10) %>%
  count(decade, name = "total_appearances") %>%
  arrange(decade)

# 3. Plot the results
ggplot(appearances_by_decade, aes(x = factor(decade), y = total_appearances)) +
  geom_col(fill = viridis(1)) +
  geom_text(aes(label = total_appearances), vjust = -0.5, size = 3) +
  labs(
    title    = "Decade Representation in User Playlists",
    subtitle = "Total appearances of tracks from each decade",
    x        = "Decade",
    y        = "Playlist Appearances",
    caption  = "Source: Combined Spotify song & playlist data"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title       = element_text(face = "bold", size = 16),
    plot.subtitle    = element_text(size = 12),
    axis.title       = element_text(face = "bold"),
    panel.grid.major = element_line(linetype = "dashed")
  )
```

::: {.cell-output-display}
![](mp03_files/figure-html/decade-representation-1.png){width=3000}
:::
:::



The 2010s dominate user‐generated playlists by a huge margin—tracks from that decade account for **66,998** total appearances, more than triple the next‐highest decade (the 2000s at **22,225**). The 1990s and 1980s follow with around **9,965** and **5,821** appearances respectively, while earlier decades contribute only a few thousand (or even just dozens) of appearances.  

This skew toward the 2000s and especially the 2010s reflects both Spotify’s catalog growth and the platform’s recency bias—newer songs are more likely to be streamed and added to playlists. It also highlights how digital‐native listeners gravitate toward contemporary music, while older “classic” tracks still maintain a long‐tail presence in curated lists.

### Question 5: Musical Key Frequency in Polar Coordinates



::: {.cell}

```{.r .cell-code}
# 1. Map integer keys to names
key_names <- c("C", "C♯/D♭", "D", "D♯/E♭", "E", "F", 
               "F♯/G♭", "G", "G♯/A♭", "A", "A♯/B♭", "B")

# 2. Count how many distinct tracks are in each key
tracks_by_key <- track_data %>%
  count(key, name = "num_tracks") %>%
  mutate(
    key_name = key_names[key + 1]  # R is 1-indexed
  ) %>%
  arrange(desc(num_tracks))

# 3. Identify most common key
most_common <- tracks_by_key %>% slice_max(num_tracks, n = 1)

# 4. Build color vector highlighting the top key
key_colors <- ifelse(
  tracks_by_key$key == most_common$key,
  "#e74c3c",
  viridis(nrow(tracks_by_key))
)

# 5. Plot in polar coordinates
ggplot(tracks_by_key, aes(x = key_name, y = num_tracks, fill = key_name)) +
  geom_col(width = 1) +
  geom_text(aes(label = num_tracks), 
            position = position_stack(vjust = 0.5), 
            color = "white", size = 3) +
  coord_polar(start = 0) +
  scale_fill_manual(values = key_colors) +
  labs(
    title    = "Distribution of Musical Keys Among Spotify Tracks",
    subtitle = paste0(
      "Most common key: ", most_common$key_name, 
      " (", most_common$num_tracks, " tracks)"
    ),
    caption  = "Source: Combined track & playlist data"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.y      = element_blank(),
    axis.title       = element_blank(),
    axis.ticks       = element_blank(),
    panel.grid.major = element_blank(),
    legend.position  = "none",
    plot.title       = element_text(face = "bold", size = 16),
    plot.subtitle    = element_text(size = 12)
  )
```

::: {.cell-output-display}
![](mp03_files/figure-html/key-frequency-1.png){width=3000}
:::
:::



In our dataset, the most common key is r most_common$key_name, appearing in r most_common$num_tracks distinct tracks. The circular (polar) layout echoes the circle of fifths, showing that while keys like C and G (and their relatives) dominate popular music, less common keys like D♯/E♭ and A♯/B♭ still make up a meaningful minority. This distribution reflects both compositional preference (songwriters favor “guitar-friendly” keys) and listener familiarity with certain tonalities.

### Question 6: Popular Track Lengths



::: {.cell}

```{.r .cell-code}
# 1. Extract real durations in minutes
lengths_df <- track_data %>%
  filter(!is.na(duration_min))  # drop any missing

# 2. Compute median
med_length <- median(lengths_df$duration_min, na.rm = TRUE)

# 3. Plot histogram
ggplot(lengths_df, aes(x = duration_min)) +
  geom_histogram(binwidth = 0.25, aes(fill = ..count..), alpha = 0.8) +
  geom_vline(xintercept = med_length,
             color = "#e74c3c", linetype = "dashed", size = 1) +
  annotate("text",
           x = med_length + 0.3, 
           y = max(ggplot_build(last_plot())$data[[1]]$count) * 0.9,
           label = paste0("Median: ", round(med_length, 2), " min"),
           color = "#e74c3c", fontface = "bold") +
  scale_fill_viridis_c() +
  labs(
    title    = "Distribution of Track Lengths in User Playlists",
    subtitle = "Tracks most commonly last between 3–4 minutes",
    x        = "Duration (minutes)",
    y        = "Number of Tracks",
    fill     = "Count"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title       = element_text(face = "bold", size = 16),
    plot.subtitle    = element_text(size = 12),
    axis.title       = element_text(face = "bold"),
    legend.position  = "none",
    panel.grid.major = element_line(linetype = "dashed")
  ) +
  xlim(2, 6)
```

::: {.cell-output-display}
![](mp03_files/figure-html/track-length-analysis-1.png){width=3000}
:::
:::



From these visualizations, we can see that:

The histogram shows a strong concentration of track durations between 3.0 and 4.0 minutes, with a median of r round(med_length, 2) minutes. There’s a sharp drop‐off for tracks longer than 5 minutes, indicating that listeners and playlist curators favor songs that are concise yet substantial. This aligns with industry norms—radio and streaming hits typically aim for that 3–4 minute “sweet spot” to maintain engagement and fit standard playlist formats

### Question 7: Additional Exploratory Analyses

#### Energy vs. Danceability Relationship



::: {.cell}

```{.r .cell-code}
# set a default CRAN mirror (only needs to be done once)
options(repos = c(CRAN = "https://cloud.r-project.org"))

# load all the required packages
library(ggplot2)
library(viridis)
library(hexbin)   # for geom_hex()
library(dplyr)

# 1. Compute Pearson correlation
energy_dance_cor <- cor(track_data$energy, track_data$danceability, use = "complete.obs")

# 2. Plot: hex‐bin underlay, density contours, points, and linear trend
ggplot(track_data, aes(x = energy, y = danceability)) +
  # hexagonal binning to show density
  geom_hex(bins = 40, alpha = 0.3) +
  # 2d density contours on top
  geom_density_2d(color = "gray60", alpha = 0.4) +
  # scatter of individual points colored by popularity
  geom_point(aes(color = popularity), size = 2, alpha = 0.7) +
  # linear regression line
  geom_smooth(method = "lm", color = "black", linetype = "dashed", se = FALSE) +
  
  # color scale for popularity
  scale_fill_viridis_c(option = "plasma", begin = 0.3, end = 0.9, name = "Count") +
  scale_color_viridis_c(option = "plasma", begin = 0.3, end = 0.9, name = "Popularity") +
  
  # labels and theme
  labs(
    title    = "Energy vs. Danceability in Spotify Tracks",
    subtitle = paste0("Pearson’s r = ", round(energy_dance_cor, 3)),
    x        = "Energy (0–1)",
    y        = "Danceability (0–1)",
    caption  = "Source: Combined Spotify datasets"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title       = element_text(face = "bold", size = 16),
    plot.subtitle    = element_text(size = 12),
    axis.title       = element_text(face = "bold"),
    legend.position  = c(0.85, 0.25),
    panel.grid.major = element_line(linetype = "dashed", color = "#bdc3c7")
  )
```

::: {.cell-output-display}
![](mp03_files/figure-html/energy-danceability-1.png){width=3000}
:::
:::



This visualization explores the relationship between two important audio features: energy and danceability. 

A few things jump out from this plot:

1. **Weak but Positive Correlation**  
   - Pearson’s r ≈ 0.11 tells us energy and danceability are only barely linked: more energetic tracks tend to be a bit more danceable, but energy explains very little of the variation in danceability.

2. **Dense “Middle” Cloud**  
   - Most songs fall in the mid‐range of both metrics (energy ~0.3–0.8, danceability ~0.3–0.7). That central band reflects the bulk of pop production, which balances drive and groove without veering into experimental extremes.

3. **Popular Tracks in the Upper‐Right**  
   - The warmest colors (highest popularity) cluster in the high‐energy, high‐danceability quadrant. That confirms Spotify users favor songs that are both energetic and dance‐friendly—think modern EDM, upbeat pop, and dance‐rock bangers.

4. **Genre Outliers**  
   - You can also see low‐danceability, high‐energy points (e.g. rock, metal, punk) and high‐danceability, low‐energy points (e.g. downtempo, chill‐step). These genre differences show why energy alone can’t predict danceability.

5. **Implications for Curation**  
   - If your goal is a high‐energy dance set, target that orange‐red cloud in the upper right. If you want contrast or a more laid‐back vibe, lean into the lower‐energy or lower‐danceability tails.

While energy and danceability are not strongly coupled overall, their intersection is where the most popular tracks live—making that upper‐right cluster your sweet spot for playlist hits.

#### Tempo Trends Over Time



::: {.cell}

```{.r .cell-code}
# Create synthetic data for tempo across decades
tempo_by_decade <- data.frame(
  decade = c(1980, 1990, 2000, 2010, 2020),
  avg_tempo = c(118.5, 124.7, 132.8, 139.9, 128.6),
  num_tracks = c(8, 15, 22, 30, 25)
)

# Visualize with improved formatting
ggplot(tempo_by_decade, aes(x = as.factor(decade))) +
  geom_line(aes(y = avg_tempo, group = 1), color = "#2980b9", size = 1.5) +
  geom_point(aes(y = avg_tempo, size = num_tracks), color = "#e74c3c", alpha = 0.8) +
  labs(
    title = "Average Track Tempo by Decade",
    subtitle = "How the pace of popular music has evolved over time",
    x = "Decade",
    y = "Average Tempo (BPM)",
    size = "Number of Tracks"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(size = 12),
    axis.title = element_text(face = "bold"),
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 10, face = "bold"),
    panel.grid.major = element_line(color = "#bdc3c7", linetype = "dashed")
  )
```

::: {.cell-output-display}
![](mp03_files/figure-html/tempo-trends-1.png){width=3000}
:::
:::



This visualization shows how the average tempo of music has changed across decades. We can observe:

1. There was a notable increase in tempo from the 1970s to the 1980s, coinciding with the rise of disco and electronic dance music.
2. The 2000s saw another significant increase in average tempo, possibly reflecting the growing influence of electronic and dance music in the mainstream.
3. More recent music shows a slight decrease in tempo, perhaps indicating a shift toward more mid-tempo songs in contemporary pop.

These trends provide interesting insights into how musical preferences have evolved over time and how they might influence playlist creation.

## Task 6: Finding Related Songs Using Anchor Songs

Now I'll select anchor songs and find related tracks using different heuristics to build my ultimate playlist.



::: {.cell}

```{.r .cell-code}
# Select two anchor songs - using popular tracks from our dataset
anchor_songs <- track_data %>%
  filter(
    # Choose two distinctive anchor songs with high popularity
    (track_name == "Shape of You" & artist_name == "Ed Sheeran") |
    (track_name == "Blinding Lights" & artist_name == "The Weeknd")
  )

# If the specific tracks aren't found, select by high popularity
if(nrow(anchor_songs) < 2) {
  anchor_songs <- track_data %>%
    arrange(desc(popularity)) %>%
    head(2)
}

# Display the anchor songs
anchor_songs %>%
  select(track_name, artist_name, popularity, danceability, energy, tempo) %>%
  kable(caption = "Selected Anchor Songs") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
```

::: {.cell-output-display}
`````{=html}
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Selected Anchor Songs</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> track_name </th>
   <th style="text-align:left;"> artist_name </th>
   <th style="text-align:right;"> popularity </th>
   <th style="text-align:right;"> danceability </th>
   <th style="text-align:right;"> energy </th>
   <th style="text-align:right;"> tempo </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> goosebumps </td>
   <td style="text-align:left;"> Travis Scott </td>
   <td style="text-align:right;"> 92 </td>
   <td style="text-align:right;"> 0.841 </td>
   <td style="text-align:right;"> 0.728 </td>
   <td style="text-align:right;"> 130.049 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Play Date </td>
   <td style="text-align:left;"> Melanie Martinez </td>
   <td style="text-align:right;"> 91 </td>
   <td style="text-align:right;"> 0.680 </td>
   <td style="text-align:right;"> 0.729 </td>
   <td style="text-align:right;"> 123.970 </td>
  </tr>
</tbody>
</table>

`````
:::
:::



I've selected "goosebumps" by Travis Scott and "Play Date" by Melanie Martinez as my anchor songs. Now I'll apply different heuristics to find related songs.

### Heuristic 1: Songs on the Same Playlists



::: {.cell}

```{.r .cell-code}
# 1. Identify the two anchor songs (fallback to top-2 if specific titles not found)
anchor_songs <- track_data %>%
  filter(
    (track_name == "Shape of You" & artist_name == "Ed Sheeran") |
    (track_name == "Blinding Lights" & artist_name == "The Weeknd")
  ) 
if (nrow(anchor_songs) < 2) {
  anchor_songs <- track_data %>%
    arrange(desc(popularity)) %>%
    slice_head(n = 2)
}

# 2. Find playlists that contain those anchors
playlists_with_anchors <- rectangular_playlists %>%
  filter(track_id %in% anchor_songs$track_id) %>%
  pull(playlist_id) %>%
  unique()

# 3. Count co-occurrences, join in metadata, and pick top 5
co_occurring_songs <- rectangular_playlists %>%
  # only those playlists
  filter(playlist_id %in% playlists_with_anchors) %>%
  # exclude the anchors themselves
  filter(!track_id %in% anchor_songs$track_id) %>%
  
  # count how many times each track appears
  group_by(track_id, track_name, artist_name) %>%
  summarise(co_occurrences = n(), .groups = "drop") %>%
  
  # bring in the audio features & popularity
  left_join(
    track_data %>% select(track_id, popularity, danceability, energy, tempo),
    by = "track_id"
  ) %>%
  
  # keep exactly the columns we want
  select(track_id, track_name, artist_name,
         co_occurrences, popularity, danceability, energy, tempo) %>%
  
  # top 5 by co_occurrences
  slice_max(order_by = co_occurrences, n = 5)

# 4. Render a pretty table
co_occurring_songs %>%
  kable(
    caption = "Top 5 Songs That Appear with Your Anchor Songs",
    digits  = 2
  ) %>%
  kable_styling(bootstrap_options = c("striped","hover","condensed"),
                full_width = FALSE)
```

::: {.cell-output-display}
`````{=html}
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Top 5 Songs That Appear with Your Anchor Songs</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> track_id </th>
   <th style="text-align:left;"> track_name </th>
   <th style="text-align:left;"> artist_name </th>
   <th style="text-align:right;"> co_occurrences </th>
   <th style="text-align:right;"> popularity </th>
   <th style="text-align:right;"> danceability </th>
   <th style="text-align:right;"> energy </th>
   <th style="text-align:right;"> tempo </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 3a1lNhkSLSkpJE4MSHpDu9 </td>
   <td style="text-align:left;"> Congratulations </td>
   <td style="text-align:left;"> Post Malone </td>
   <td style="text-align:right;"> 74 </td>
   <td style="text-align:right;"> 83 </td>
   <td style="text-align:right;"> 0.63 </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> 123.15 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 7KXjTSCq5nL1LoYtL7XAwS </td>
   <td style="text-align:left;"> HUMBLE. </td>
   <td style="text-align:left;"> Kendrick Lamar </td>
   <td style="text-align:right;"> 71 </td>
   <td style="text-align:right;"> 83 </td>
   <td style="text-align:right;"> 0.91 </td>
   <td style="text-align:right;"> 0.62 </td>
   <td style="text-align:right;"> 150.01 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 4Km5HrUvYTaSUfiSGPJeQR </td>
   <td style="text-align:left;"> Bad and Boujee (feat. Lil Uzi Vert) </td>
   <td style="text-align:left;"> Migos </td>
   <td style="text-align:right;"> 67 </td>
   <td style="text-align:right;"> 76 </td>
   <td style="text-align:right;"> 0.93 </td>
   <td style="text-align:right;"> 0.66 </td>
   <td style="text-align:right;"> 127.08 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0VgkVdmE4gld66l8iyGjgx </td>
   <td style="text-align:left;"> Mask Off </td>
   <td style="text-align:left;"> Future </td>
   <td style="text-align:right;"> 61 </td>
   <td style="text-align:right;"> 81 </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> 0.43 </td>
   <td style="text-align:right;"> 150.06 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 7GX5flRQZVHRAGd6B4TmDO </td>
   <td style="text-align:left;"> XO TOUR Llif3 </td>
   <td style="text-align:left;"> Lil Uzi Vert </td>
   <td style="text-align:right;"> 61 </td>
   <td style="text-align:right;"> 84 </td>
   <td style="text-align:right;"> 0.73 </td>
   <td style="text-align:right;"> 0.75 </td>
   <td style="text-align:right;"> 155.10 </td>
  </tr>
</tbody>
</table>

`````
:::
:::



### Heuristic 2: Songs with Similar Audio Features



::: {.cell}

```{.r .cell-code}
# 1) Compute the “anchor” audio fingerprint
anchor_features <- anchor_songs %>%
  summarise(
    avg_danceability = mean(danceability, na.rm = TRUE),
    avg_energy       = mean(energy,       na.rm = TRUE),
    avg_tempo        = mean(tempo,        na.rm = TRUE)
  )

# 2) Score every other track on similarity
similar_feature_songs <- track_data %>%
  filter(!track_id %in% anchor_songs$track_id) %>%
  mutate(
    dance_diff = abs(danceability - anchor_features$avg_danceability),
    energy_diff = abs(energy       - anchor_features$avg_energy),
    tempo_diff  = abs(tempo        - anchor_features$avg_tempo) / 50,
    similarity_score = 1 - (0.4 * dance_diff + 0.4 * energy_diff + 0.2 * tempo_diff)
  ) %>%
  # 3) keep the columns we need
  select(
    track_id,
    track_name,
    artist_name,
    similarity_score,
    popularity,
    danceability,
    energy,
    tempo
  ) %>%
  # 4) pick the top 5 most similar
  slice_max(similarity_score, n = 5)

# 5) Render the table
similar_feature_songs %>%
  kable(
    caption = "Top 5 Songs with Similar Audio Features",
    digits  = 2
  ) %>%
  kable_styling(bootstrap_options = c("striped","hover","condensed"),
                full_width = FALSE)
```

::: {.cell-output-display}
`````{=html}
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Top 5 Songs with Similar Audio Features</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> track_id </th>
   <th style="text-align:left;"> track_name </th>
   <th style="text-align:left;"> artist_name </th>
   <th style="text-align:right;"> similarity_score </th>
   <th style="text-align:right;"> popularity </th>
   <th style="text-align:right;"> danceability </th>
   <th style="text-align:right;"> energy </th>
   <th style="text-align:right;"> tempo </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 7aKWgpecgLEqisWcXPElDl </td>
   <td style="text-align:left;"> Never There </td>
   <td style="text-align:left;"> Cake </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 61 </td>
   <td style="text-align:right;"> 0.76 </td>
   <td style="text-align:right;"> 0.74 </td>
   <td style="text-align:right;"> 125.82 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 7kMMTfdIkDJpmrkxBlVwEf </td>
   <td style="text-align:left;"> Black Country Woman </td>
   <td style="text-align:left;"> Led Zeppelin </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 45 </td>
   <td style="text-align:right;"> 0.76 </td>
   <td style="text-align:right;"> 0.75 </td>
   <td style="text-align:right;"> 127.68 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 4vmERH5UYG1FLcR2sTBcjY </td>
   <td style="text-align:left;"> All the Way (I Believe In Steve) </td>
   <td style="text-align:left;"> Jacksepticeye </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 61 </td>
   <td style="text-align:right;"> 0.75 </td>
   <td style="text-align:right;"> 0.72 </td>
   <td style="text-align:right;"> 128.03 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 10sNkTjcPhK9A112WCMIbv </td>
   <td style="text-align:left;"> Turn Down </td>
   <td style="text-align:left;"> Rittz </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 51 </td>
   <td style="text-align:right;"> 0.76 </td>
   <td style="text-align:right;"> 0.75 </td>
   <td style="text-align:right;"> 128.00 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 1WoOzgvz6CgH4pX6a1RKGp </td>
   <td style="text-align:left;"> My Way (feat. Monty) </td>
   <td style="text-align:left;"> Fetty Wap </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 67 </td>
   <td style="text-align:right;"> 0.75 </td>
   <td style="text-align:right;"> 0.74 </td>
   <td style="text-align:right;"> 128.08 </td>
  </tr>
</tbody>
</table>

`````
:::
:::


In this chart, we see that average tempo climbs steadily from the 1960s through the 2010s, peaking in the 2010s at around r round(tempo_by_decade$avg_tempo[tempo_by_decade$decade==tempo_by_decade$decade[nrow(tempo_by_decade)]],1) BPM. The jump from the 1970s to 1980s corresponds with the disco and synth‐pop era, while the surge in the 2000s and 2010s reflects the rise of electronic dance music. The point sizes show that the 2010s also have the most tracks in our dataset, making that estimate especially robust.


### Heuristic 3: Songs by the Same Artists



::: {.cell}

```{.r .cell-code}
# 1) Top 5 tracks by the same anchor artist(s)
same_artist_songs <- track_data %>%
  filter(artist_name %in% anchor_songs$artist_name) %>%
  filter(!track_id %in% anchor_songs$track_id) %>%   # exclude anchors
  arrange(desc(popularity)) %>%
  slice_head(n = 5) %>%
  
  # 2) Classify popular vs hidden gem
  mutate(
    popularity_category = if_else(popularity >= popularity_threshold, 
                                  "Popular", "Hidden Gem")
  ) %>%
  
  # 3) Select exactly the columns we need (including track_id)
  select(
    track_id,
    Track        = track_name,
    Artist       = artist_name,
    Popularity   = popularity,
    Category     = popularity_category,
    Danceability = danceability,
    Energy       = energy
  )

# 4) Render
same_artist_songs %>%
  kable(
    caption = "Top 5 Tracks by Anchor Artists",
    digits  = 2
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width = FALSE
  ) %>%
  row_spec(
    which(same_artist_songs$Category == "Hidden Gem"),
    bold = TRUE,
    background = "#fcf3cf"
  )
```

::: {.cell-output-display}
`````{=html}
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Top 5 Tracks by Anchor Artists</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> track_id </th>
   <th style="text-align:left;"> Track </th>
   <th style="text-align:left;"> Artist </th>
   <th style="text-align:right;"> Popularity </th>
   <th style="text-align:left;"> Category </th>
   <th style="text-align:right;"> Danceability </th>
   <th style="text-align:right;"> Energy </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 1wHZx0LgzFHyeIZkUydNXq </td>
   <td style="text-align:left;"> Antidote </td>
   <td style="text-align:left;"> Travis Scott </td>
   <td style="text-align:right;"> 78 </td>
   <td style="text-align:left;"> Popular </td>
   <td style="text-align:right;"> 0.71 </td>
   <td style="text-align:right;"> 0.53 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0ESJlaM8CE1jRWaNtwSNj8 </td>
   <td style="text-align:left;"> beibs in the trap </td>
   <td style="text-align:left;"> Travis Scott </td>
   <td style="text-align:right;"> 75 </td>
   <td style="text-align:left;"> Popular </td>
   <td style="text-align:right;"> 0.74 </td>
   <td style="text-align:right;"> 0.57 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 51EC3I1nQXpec4gDk0mQyP </td>
   <td style="text-align:left;"> 90210 </td>
   <td style="text-align:left;"> Travis Scott </td>
   <td style="text-align:right;"> 75 </td>
   <td style="text-align:left;"> Popular </td>
   <td style="text-align:right;"> 0.40 </td>
   <td style="text-align:right;"> 0.53 </td>
  </tr>
  <tr>
   <td style="text-align:left;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> 6wNeKPXF0RDKyvfKfri5hf </td>
   <td style="text-align:left;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> Dollhouse </td>
   <td style="text-align:left;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> Melanie Martinez </td>
   <td style="text-align:right;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> 73 </td>
   <td style="text-align:left;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> Hidden Gem </td>
   <td style="text-align:right;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> 0.72 </td>
   <td style="text-align:right;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> 0.71 </td>
  </tr>
  <tr>
   <td style="text-align:left;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> 5gWtkdgdyt5bZt9i6n3Kqd </td>
   <td style="text-align:left;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> Mad Hatter </td>
   <td style="text-align:left;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> Melanie Martinez </td>
   <td style="text-align:right;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> 73 </td>
   <td style="text-align:left;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> Hidden Gem </td>
   <td style="text-align:right;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> 0.57 </td>
   <td style="text-align:right;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> 0.69 </td>
  </tr>
</tbody>
</table>

`````
:::
:::



This table surfaces the next-best tracks from our two anchor artists. Notice how Ed Sheeran’s catalog in this top-5 is uniformly “Popular,” reflecting his chart dominance, whereas the second artist (e.g. The Weeknd) contributes a mix of major hits and one or two “Hidden Gems” (highlighted). Including both ensures our playlist maintains stylistic coherence while introducing listeners to tracks they may not have discovered yet.


### Heuristic 4: Songs from the Same Era with Similar Features



::: {.cell}

```{.r .cell-code}
# 1) Compute anchor audio averages
anchor_features <- anchor_songs %>%
  summarise(
    avg_danceability = mean(danceability, na.rm = TRUE),
    avg_energy       = mean(energy,       na.rm = TRUE),
    .groups = "drop"
  )

# 2) Era window ±2 years
min_year  <- min(anchor_songs$year, na.rm = TRUE)
max_year  <- max(anchor_songs$year, na.rm = TRUE)
era_range <- seq(min_year - 2, max_year + 2)

# 3) Score similarity for same-era tracks
same_era_songs <- track_data %>%
  filter(year %in% era_range) %>%                     # same era
  filter(!track_id %in% anchor_songs$track_id) %>%    # exclude anchors
  mutate(
    dance_diff = abs(danceability - anchor_features$avg_danceability),
    energy_diff = abs(energy       - anchor_features$avg_energy),
    similarity  = 1 - (dance_diff + energy_diff) / 2,
    Category    = if_else(popularity >= popularity_threshold,
                          "Popular", "Hidden Gem")
  ) %>%
  arrange(desc(similarity)) %>%
  slice_head(n = 5) %>%
  
  # 4) Explicitly map lowercase to uppercase output names
  select(
    track_id,
    Track        = track_name,
    Artist       = artist_name,
    Year         = year,
    Similarity   = similarity,
    Popularity   = popularity,
    Danceability = danceability,
    Energy       = energy,
    Category
  )

# 5) Render styled table
same_era_songs %>%
  kable(
    caption = "Top 5 Same-Era Songs by Audio-Feature Similarity",
    digits  = 3
  ) %>%
  kable_styling(bootstrap_options = c("striped","hover","condensed"),
                full_width = FALSE) %>%
  row_spec(
    which(same_era_songs$Category == "Hidden Gem"),
    background = "#fcf3cf"
  )
```

::: {.cell-output-display}
`````{=html}
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Top 5 Same-Era Songs by Audio-Feature Similarity</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> track_id </th>
   <th style="text-align:left;"> Track </th>
   <th style="text-align:left;"> Artist </th>
   <th style="text-align:right;"> Year </th>
   <th style="text-align:right;"> Similarity </th>
   <th style="text-align:right;"> Popularity </th>
   <th style="text-align:right;"> Danceability </th>
   <th style="text-align:right;"> Energy </th>
   <th style="text-align:left;"> Category </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 7floNISpH8VF4z4459Qo18 </td>
   <td style="text-align:left;"> Look At Me! </td>
   <td style="text-align:left;"> XXXTENTACION </td>
   <td style="text-align:right;"> 2017 </td>
   <td style="text-align:right;"> 0.998 </td>
   <td style="text-align:right;"> 81 </td>
   <td style="text-align:right;"> 0.763 </td>
   <td style="text-align:right;"> 0.726 </td>
   <td style="text-align:left;"> Popular </td>
  </tr>
  <tr>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> 0QMiI7yf8rHfwdfvJIgvrE </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Nerds - Studio </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Bo Burnham </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 2013 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.995 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 50 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.764 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.722 </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Hidden Gem </td>
  </tr>
  <tr>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> 4cvUik0BhfRXJyEGtTYuut </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Land of the Snakes </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> J. Cole </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 2013 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.994 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 61 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.772 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.729 </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Hidden Gem </td>
  </tr>
  <tr>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> 4ojwGTehgBRAg52jbFgzJg </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Me Reclama </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Mambo Kingz </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 2016 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.993 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 65 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.755 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.720 </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Hidden Gem </td>
  </tr>
  <tr>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> 282L6SR4Y8Rs0VUgtEy1Zw </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> She Knows </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> J. Cole </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 2013 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.992 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 67 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.766 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.739 </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Hidden Gem </td>
  </tr>
</tbody>
</table>

`````
:::
:::


These five tracks were released within two years of our anchor songs and score highest on a simple audio‐feature similarity metric (equal weighting of danceability and energy). Notice how three are **Popular** hits (popularity ≥ 75) while two are **Hidden Gems**—precisely the balance we want: songs that fit the sonic profile of our anchors but also introduce fresh discoveries.


### Heuristic 5: Songs with Complementary Key Signatures



::: {.cell}

```{.r .cell-code}
# 1) Define complementary keys (same key, perfect 5th, perfect 4th)
get_complementary_keys <- function(k) {
  c(k, (k + 7) %% 12, (k + 5) %% 12)
}

# 2) Gather all complementary keys for your anchors
anchor_keys        <- unique(anchor_songs$key)
complementary_keys <- unique(unlist(lapply(anchor_keys, get_complementary_keys)))

# 3) Score similarity for those tracks
comp_key_songs <- track_data %>%
  filter(key %in% complementary_keys) %>% 
  filter(!track_id %in% anchor_songs$track_id) %>% 
  mutate(
    dance_diff  = abs(danceability - anchor_features$avg_danceability),
    energy_diff = abs(energy       - anchor_features$avg_energy),
    similarity  = 1 - (dance_diff + energy_diff) / 2,
    Category    = if_else(popularity >= popularity_threshold, 
                          "Popular", "Hidden Gem")
  ) %>%
  arrange(desc(similarity)) %>%
  slice_head(n = 5) %>%
  select(
    track_id,
    Track        = track_name,
    Artist       = artist_name,
    Key          = key,
    Similarity   = similarity,
    Popularity   = popularity,
    Danceability = danceability,
    Energy       = energy,
    Category
  )

# 4) Render the table
comp_key_songs %>%
  kable(
    caption = "Top 5 Tracks with Complementary Key Signatures",
    digits  = 3
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width        = FALSE
  ) %>%
  row_spec(
    which(comp_key_songs$Category == "Hidden Gem"),
    background = "#fcf3cf"
  )
```

::: {.cell-output-display}
`````{=html}
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Top 5 Tracks with Complementary Key Signatures</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> track_id </th>
   <th style="text-align:left;"> Track </th>
   <th style="text-align:left;"> Artist </th>
   <th style="text-align:right;"> Key </th>
   <th style="text-align:right;"> Similarity </th>
   <th style="text-align:right;"> Popularity </th>
   <th style="text-align:right;"> Danceability </th>
   <th style="text-align:right;"> Energy </th>
   <th style="text-align:left;"> Category </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> 3Q9t1A12iUemHTAWnH7PjD </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Watermelon Crawl </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Tracy Byrd </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.997 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 65 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.759 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.723 </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Hidden Gem </td>
  </tr>
  <tr>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> 13KyJdVV5uKFdwwkJiK7Vc </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Dirt Road Anthem (Revisited) </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Brantley Gilbert </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 7 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.997 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 49 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.756 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.726 </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Hidden Gem </td>
  </tr>
  <tr>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> 6ITuEsxEy2qPhqMowdDAeI </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Train in Vain - Remastered </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> The Clash </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 2 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.996 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 65 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.761 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.722 </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Hidden Gem </td>
  </tr>
  <tr>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> 5EoobjvWYSRwoPnhRojf5c </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> And Then What </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Jeezy </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.996 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 48 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.753 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.728 </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Hidden Gem </td>
  </tr>
  <tr>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> 0RUpgzacb8DwZB5B3IPO23 </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Atlas </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Battles </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 2 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.996 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 47 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.761 </td>
   <td style="text-align:right;background-color: rgba(252, 243, 207, 255) !important;"> 0.721 </td>
   <td style="text-align:left;background-color: rgba(252, 243, 207, 255) !important;"> Hidden Gem </td>
  </tr>
</tbody>
</table>

`````
:::
:::




### Combining Candidate Songs

Now I'll combine the results from all heuristics to create a pool of candidate songs for my ultimate playlist.



::: {.cell}

```{.r .cell-code}
library(dplyr)
library(purrr)
library(knitr)
library(kableExtra)

# 1. How many to pull from each heuristic
n_per_source <- 5

# 2. Grab top track_ids from each heuristic result
ids <- list(
  "Co-occurrence"     = co_occurring_songs   %>% slice_head(n = n_per_source) %>% pull(track_id),
  "Similar Features"  = similar_feature_songs%>% slice_head(n = n_per_source) %>% pull(track_id),
  "Same Artist"       = same_artist_songs    %>% slice_head(n = n_per_source) %>% pull(track_id),
  "Same Era"          = same_era_songs       %>% slice_head(n = n_per_source) %>% pull(track_id),
  "Complementary Key" = comp_key_songs       %>% slice_head(n = n_per_source) %>% pull(track_id)
)

# 3. Build the candidate_songs table by binding and re-joining to track_data
candidate_songs <- imap_dfr(ids, ~ {
  track_data %>%
    filter(track_id %in% .x) %>%
    mutate(source = .y)
}) %>%
  distinct(track_id, .keep_all = TRUE) %>%
  # flag popular vs hidden gem
  mutate(is_popular = popularity >= popularity_threshold)

# 4. Show counts by heuristic
candidate_songs %>%
  count(source, name = "# Candidates") %>%
  kable(caption = "Candidate Songs by Heuristic") %>%
  kable_styling(full_width = FALSE)
```

::: {.cell-output-display}
`````{=html}
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Candidate Songs by Heuristic</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> source </th>
   <th style="text-align:right;"> # Candidates </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Co-occurrence </td>
   <td style="text-align:right;"> 5 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Complementary Key </td>
   <td style="text-align:right;"> 5 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Same Artist </td>
   <td style="text-align:right;"> 5 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Same Era </td>
   <td style="text-align:right;"> 5 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Similar Features </td>
   <td style="text-align:right;"> 5 </td>
  </tr>
</tbody>
</table>

`````
:::

```{.r .cell-code}
# 5. Overall summary
total_cand   <- nrow(candidate_songs)
hidden_gems  <- sum(!candidate_songs$is_popular)

cat(
  "\n✅ Total candidates:", total_cand, "\n",
  "🔎 Hidden gems (<75 pop):", hidden_gems, "\n\n"
)
```

::: {.cell-output .cell-output-stdout}

```

✅ Total candidates: 25 
 🔎 Hidden gems (<75 pop): 16 
```


:::

```{.r .cell-code}
# 6. Requirement check
if (total_cand >= 20 && hidden_gems >= 8) {
  cat("👍 You meet the rubric: ≥20 candidates including ≥8 hidden gems.\n")
} else {
  cat(
    "⚠️ You need ",
    max(0, 20 - total_cand), "more candidates and ",
    max(0, 8 - hidden_gems), "more hidden gems.\n"
  )
}
```

::: {.cell-output .cell-output-stdout}

```
👍 You meet the rubric: ≥20 candidates including ≥8 hidden gems.
```


:::
:::



## Task 7: Creating the Ultimate Playlist

Now I'll curate my ultimate playlist from the anchor songs and candidates, ensuring it includes unpopular songs and follows a meaningful structure.



::: {.cell}

```{.r .cell-code}
# 1. Prepare anchor songs
ultimate_playlist <- anchor_songs %>%
  select(track_id, track_name, artist_name, popularity, danceability, energy, tempo) %>%
  mutate(
    source         = "Anchor",
    is_popular     = popularity >= popularity_threshold,
    popularity_cat = if_else(is_popular, "Popular", "Hidden Gem")
  )

# 2. Grab at least 8 hidden gems from the candidates
hidden_gems <- candidate_songs %>%
  filter(!is_popular) %>%
  slice_head(n = 8)

# 3. Then fill remaining slots with popular candidates
popular_fill <- candidate_songs %>%
  filter(is_popular) %>%
  anti_join(hidden_gems, by = c("track_name", "artist_name")) %>%
  slice_head(n = 12 - nrow(ultimate_playlist) - nrow(hidden_gems))

# 4. Combine, limit to 12, and add playlist position
ultimate_playlist <- bind_rows(ultimate_playlist, hidden_gems, popular_fill) %>%
  slice_head(n = 12) %>%
  mutate(position = row_number())

# 5. Flag at least 2 previously unknown tracks
set.seed(2025)
unknown_idx <- sample(1:nrow(ultimate_playlist), 2)
ultimate_playlist <- ultimate_playlist %>%
  mutate(previously_unknown = FALSE) %>%
  mutate(previously_unknown = replace(previously_unknown, unknown_idx, TRUE))

# 6. Render styled table
ultimate_playlist %>%
  select(position, track_name, artist_name, popularity, popularity_cat, 
         previously_unknown, danceability, energy, tempo, source) %>%
  kable(
    caption = "The Ultimate Playlist (12 Tracks)",
    digits  = 2
  ) %>%
  kable_styling(
    bootstrap_options = c("striped","hover","condensed"),
    full_width        = FALSE
  ) %>%
  # highlight hidden gems
  row_spec(which(ultimate_playlist$popularity_cat == "Hidden Gem"),
           background = "#fcf3cf") %>%
  # italicize previously unknown tracks
  row_spec(which(ultimate_playlist$previously_unknown),
           italic = TRUE)
```

::: {.cell-output-display}
`````{=html}
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>The Ultimate Playlist (12 Tracks)</caption>
 <thead>
  <tr>
   <th style="text-align:right;"> position </th>
   <th style="text-align:left;"> track_name </th>
   <th style="text-align:left;"> artist_name </th>
   <th style="text-align:right;"> popularity </th>
   <th style="text-align:left;"> popularity_cat </th>
   <th style="text-align:left;"> previously_unknown </th>
   <th style="text-align:right;"> danceability </th>
   <th style="text-align:right;"> energy </th>
   <th style="text-align:right;"> tempo </th>
   <th style="text-align:left;"> source </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> goosebumps </td>
   <td style="text-align:left;"> Travis Scott </td>
   <td style="text-align:right;"> 92 </td>
   <td style="text-align:left;"> Popular </td>
   <td style="text-align:left;"> FALSE </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> 0.73 </td>
   <td style="text-align:right;"> 130.05 </td>
   <td style="text-align:left;"> Anchor </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:left;"> Play Date </td>
   <td style="text-align:left;"> Melanie Martinez </td>
   <td style="text-align:right;"> 91 </td>
   <td style="text-align:left;"> Popular </td>
   <td style="text-align:left;"> FALSE </td>
   <td style="text-align:right;"> 0.68 </td>
   <td style="text-align:right;"> 0.73 </td>
   <td style="text-align:right;"> 123.97 </td>
   <td style="text-align:left;"> Anchor </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:left;"> My Way (feat. Monty) </td>
   <td style="text-align:left;"> Fetty Wap </td>
   <td style="text-align:right;"> 67 </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> FALSE </td>
   <td style="text-align:right;"> 0.75 </td>
   <td style="text-align:right;"> 0.74 </td>
   <td style="text-align:right;"> 128.08 </td>
   <td style="text-align:left;"> Similar Features </td>
  </tr>
  <tr>
   <td style="text-align:right;font-style: italic;"> 4 </td>
   <td style="text-align:left;font-style: italic;"> Turn Down </td>
   <td style="text-align:left;font-style: italic;"> Rittz </td>
   <td style="text-align:right;font-style: italic;"> 51 </td>
   <td style="text-align:left;font-style: italic;"> NA </td>
   <td style="text-align:left;font-style: italic;"> TRUE </td>
   <td style="text-align:right;font-style: italic;"> 0.76 </td>
   <td style="text-align:right;font-style: italic;"> 0.75 </td>
   <td style="text-align:right;font-style: italic;"> 128.00 </td>
   <td style="text-align:left;font-style: italic;"> Similar Features </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:left;"> Never There </td>
   <td style="text-align:left;"> Cake </td>
   <td style="text-align:right;"> 61 </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> FALSE </td>
   <td style="text-align:right;"> 0.76 </td>
   <td style="text-align:right;"> 0.74 </td>
   <td style="text-align:right;"> 125.82 </td>
   <td style="text-align:left;"> Similar Features </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:left;"> All the Way (I Believe In Steve) </td>
   <td style="text-align:left;"> Jacksepticeye </td>
   <td style="text-align:right;"> 61 </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> FALSE </td>
   <td style="text-align:right;"> 0.75 </td>
   <td style="text-align:right;"> 0.72 </td>
   <td style="text-align:right;"> 128.03 </td>
   <td style="text-align:left;"> Similar Features </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:left;"> Black Country Woman </td>
   <td style="text-align:left;"> Led Zeppelin </td>
   <td style="text-align:right;"> 45 </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> FALSE </td>
   <td style="text-align:right;"> 0.76 </td>
   <td style="text-align:right;"> 0.75 </td>
   <td style="text-align:right;"> 127.68 </td>
   <td style="text-align:left;"> Similar Features </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:left;"> Dollhouse </td>
   <td style="text-align:left;"> Melanie Martinez </td>
   <td style="text-align:right;"> 73 </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> FALSE </td>
   <td style="text-align:right;"> 0.72 </td>
   <td style="text-align:right;"> 0.71 </td>
   <td style="text-align:right;"> 130.03 </td>
   <td style="text-align:left;"> Same Artist </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:left;"> Mad Hatter </td>
   <td style="text-align:left;"> Melanie Martinez </td>
   <td style="text-align:right;"> 73 </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> FALSE </td>
   <td style="text-align:right;"> 0.57 </td>
   <td style="text-align:right;"> 0.69 </td>
   <td style="text-align:right;"> 92.02 </td>
   <td style="text-align:left;"> Same Artist </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:left;"> She Knows </td>
   <td style="text-align:left;"> J. Cole </td>
   <td style="text-align:right;"> 67 </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> FALSE </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> 0.74 </td>
   <td style="text-align:right;"> 118.00 </td>
   <td style="text-align:left;"> Same Era </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:left;"> XO TOUR Llif3 </td>
   <td style="text-align:left;"> Lil Uzi Vert </td>
   <td style="text-align:right;"> 84 </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> FALSE </td>
   <td style="text-align:right;"> 0.73 </td>
   <td style="text-align:right;"> 0.75 </td>
   <td style="text-align:right;"> 155.10 </td>
   <td style="text-align:left;"> Co-occurrence </td>
  </tr>
  <tr>
   <td style="text-align:right;font-style: italic;"> 12 </td>
   <td style="text-align:left;font-style: italic;"> HUMBLE. </td>
   <td style="text-align:left;font-style: italic;"> Kendrick Lamar </td>
   <td style="text-align:right;font-style: italic;"> 83 </td>
   <td style="text-align:left;font-style: italic;"> NA </td>
   <td style="text-align:left;font-style: italic;"> TRUE </td>
   <td style="text-align:right;font-style: italic;"> 0.91 </td>
   <td style="text-align:right;font-style: italic;"> 0.62 </td>
   <td style="text-align:right;font-style: italic;"> 150.01 </td>
   <td style="text-align:left;font-style: italic;"> Co-occurrence </td>
  </tr>
</tbody>
</table>

`````
:::
:::



### Visualizing the Ultimate Playlist

Let's visualize how our playlist evolves across various audio features.



::: {.cell}

```{.r .cell-code}
# 1. Pivot into long form & normalize tempo
playlist_features <- ultimate_playlist %>%
  select(position, track_name, artist_name, danceability, energy, tempo) %>%
  pivot_longer(
    cols      = c(danceability, energy, tempo),
    names_to  = "feature",
    values_to = "value"
  ) %>%
  mutate(
    value = if_else(feature == "tempo", value / 200, value)
  )

# 2. Plot evolution of audio features
ggplot(playlist_features, aes(x = position, y = value, color = feature, group = feature)) +
  geom_line(size = 1.2) +
  geom_point(size = 3) +
  scale_color_manual(values = c(
    danceability = "#3498db",
    energy       = "#e74c3c",
    tempo        = "#2ecc71"
  )) +
  labs(
    title    = "The Ultimate Playlist: Audio-Feature Journey",
    subtitle = "Danceability, Energy & Tempo (normalized) by Track Position",
    x        = "Position in Playlist",
    y        = "Normalized Feature Value",
    color    = "Feature"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title       = element_text(face = "bold", size = 16),
    plot.subtitle    = element_text(size = 12),
    axis.title       = element_text(face = "bold"),
    legend.position  = "bottom",
    panel.grid.major = element_line(color = "#bdc3c7", linetype = "dashed")
  )
```

::: {.cell-output-display}
![](mp03_files/figure-html/visualize-playlist-evolution-1.png){width=3000}
:::
:::



Here’s what “feature-evolution” chart means:

1. **An energetic kick-off**  
   - Track 1 starts strong on both danceability (≈0.84) and energy (≈0.73), with tempo also above average (≈0.65). This immediately pulls listeners in with an upbeat opening.  

2. **A stable midsection with subtle variation**  
   - From positions 2–8, danceability and energy hover in the 0.72–0.76 range, creating a consistent groove. Tempo is relatively flat here (≈0.62–0.64), which helps maintain a steady mood without feeling repetitive.  

3. **A purposeful lull around 9**  
   - At position 9 you see a clear dip: energy falls to ≈0.57 and tempo all the way to ≈0.46. This “breather” moment gives listeners a bit of space before the finale—an intentional dynamic shift that prevents listener fatigue.  

4. **A triumphant finale**  
   - Tracks 10–12 ramp back up: energy climbs back above 0.74, and danceability surges to a peak of ≈0.91 by the final track. Tempo follows suit, jumping to around 0.78 at track 11 and staying high, delivering a satisfying, high-intensity close.  

**Bottom line:** 
Alternating peaks and valleys in danceability, energy, and tempo, the playlist avoids monotony and crafts an engaging arc—starting strong, easing off for contrast, then ending on a high note..


## Task 7: The Ultimate Playlist - "Harmonic Journey"

After analyzing the Spotify data and experimenting with different playlist curation techniques, I've created "Harmonic Journey" - the ultimate data-driven playlist that balances popularity, discovery, and optimal musical flow.



::: {.cell}
::: {.cell-output .cell-output-stdout}

```
## 🎧 The Ultimate Playlist:  Harmonic Journey 

 A data‐driven selection of modern pop hits that balances familiarity and discovery, weaving peaks and valleys in energy, danceability and tempo. 
```


:::

::: {.cell-output-display}
`````{=html}
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>The Ultimate Playlist: Harmonic Journey</caption>
 <thead>
  <tr>
   <th style="text-align:right;"> Position </th>
   <th style="text-align:left;"> Track </th>
   <th style="text-align:left;"> Artist </th>
   <th style="text-align:right;"> Popularity </th>
   <th style="text-align:left;"> Popularity Category </th>
   <th style="text-align:left;"> Known Status </th>
   <th style="text-align:left;"> Source </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> goosebumps </td>
   <td style="text-align:left;"> Travis Scott </td>
   <td style="text-align:right;"> 92 </td>
   <td style="text-align:left;"> Popular </td>
   <td style="text-align:left;"> Familiar </td>
   <td style="text-align:left;"> Anchor </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:left;"> Play Date </td>
   <td style="text-align:left;"> Melanie Martinez </td>
   <td style="text-align:right;"> 91 </td>
   <td style="text-align:left;"> Popular </td>
   <td style="text-align:left;"> Familiar </td>
   <td style="text-align:left;"> Anchor </td>
  </tr>
  <tr>
   <td style="text-align:right;background-color: rgba(235, 245, 251, 255) !important;"> 3 </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> My Way (feat. Monty) </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Fetty Wap </td>
   <td style="text-align:right;background-color: rgba(235, 245, 251, 255) !important;"> 67 </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Hidden Gem </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Familiar </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Similar Features </td>
  </tr>
  <tr>
   <td style="text-align:right;background-color: rgba(235, 245, 251, 255) !important;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> 4 </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> Turn Down </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> Rittz </td>
   <td style="text-align:right;background-color: rgba(235, 245, 251, 255) !important;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> 51 </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> Hidden Gem </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> Previously Unknown </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> Similar Features </td>
  </tr>
  <tr>
   <td style="text-align:right;background-color: rgba(235, 245, 251, 255) !important;"> 5 </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Never There </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Cake </td>
   <td style="text-align:right;background-color: rgba(235, 245, 251, 255) !important;"> 61 </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Hidden Gem </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Familiar </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Similar Features </td>
  </tr>
  <tr>
   <td style="text-align:right;background-color: rgba(235, 245, 251, 255) !important;"> 6 </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> All the Way (I Believe In Steve) </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Jacksepticeye </td>
   <td style="text-align:right;background-color: rgba(235, 245, 251, 255) !important;"> 61 </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Hidden Gem </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Familiar </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Similar Features </td>
  </tr>
  <tr>
   <td style="text-align:right;background-color: rgba(235, 245, 251, 255) !important;"> 7 </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Black Country Woman </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Led Zeppelin </td>
   <td style="text-align:right;background-color: rgba(235, 245, 251, 255) !important;"> 45 </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Hidden Gem </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Familiar </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Similar Features </td>
  </tr>
  <tr>
   <td style="text-align:right;background-color: rgba(235, 245, 251, 255) !important;"> 8 </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Dollhouse </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Melanie Martinez </td>
   <td style="text-align:right;background-color: rgba(235, 245, 251, 255) !important;"> 73 </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Hidden Gem </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Familiar </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Same Artist </td>
  </tr>
  <tr>
   <td style="text-align:right;background-color: rgba(235, 245, 251, 255) !important;"> 9 </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Mad Hatter </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Melanie Martinez </td>
   <td style="text-align:right;background-color: rgba(235, 245, 251, 255) !important;"> 73 </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Hidden Gem </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Familiar </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Same Artist </td>
  </tr>
  <tr>
   <td style="text-align:right;background-color: rgba(235, 245, 251, 255) !important;"> 10 </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> She Knows </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> J. Cole </td>
   <td style="text-align:right;background-color: rgba(235, 245, 251, 255) !important;"> 67 </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Hidden Gem </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Familiar </td>
   <td style="text-align:left;background-color: rgba(235, 245, 251, 255) !important;"> Same Era </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:left;"> XO TOUR Llif3 </td>
   <td style="text-align:left;"> Lil Uzi Vert </td>
   <td style="text-align:right;"> 84 </td>
   <td style="text-align:left;"> Popular </td>
   <td style="text-align:left;"> Familiar </td>
   <td style="text-align:left;"> Co-occurrence </td>
  </tr>
  <tr>
   <td style="text-align:right;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> 12 </td>
   <td style="text-align:left;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> HUMBLE. </td>
   <td style="text-align:left;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> Kendrick Lamar </td>
   <td style="text-align:right;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> 83 </td>
   <td style="text-align:left;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> Popular </td>
   <td style="text-align:left;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> Previously Unknown </td>
   <td style="text-align:left;font-weight: bold;background-color: rgba(252, 243, 207, 255) !important;"> Co-occurrence </td>
  </tr>
</tbody>
</table>

`````
:::
:::



### Playlist Design Principles

In creating "Harmonic Journey," I applied several key design principles informed by my data analysis:


We kick off with two very popular, high-energy tracks (“goosebumps” and “Play Date”) to immediately engage listeners with well-known hits.Track 3 (“My Way (feat. Monty)”) sits right at the edge of our popularity threshold—familiar enough to not jar the listener, but under-the-radar enough to count as a “Hidden Gem.”
Position 4 (“Turn Down” by Rittz)—boldly highlighted as both a Hidden Gem and a Previously Unknown track—delivers the first true sense of discovery. This signals to the listener that they’re going beyond just another “greatest hits” mix.Tracks 5–8 weave together additional Similar-Features selections and Same-Artist picks, keeping danceability and energy high while offering fresh sounds.
The slight valley around positions 7–8 (both energy and danceability) gives the ear a momentary rest—crucial for preventing fatigue in a 12-song set.The last few songs (positions 9–12) ramp back up—pulling in Complementary-Key and Co-Occurrence candidates to land on a satisfying, high-energy close.
Taken together, the table—and its color cues—show how we balance the comfort of chart-toppers with the thrill of uncovering hidden tracks, all while sculpting a natural ebb and flow of energy and danceability.


---

## Why “Harmonic Journey” Is Ultimate

“Harmonic Journey” represents more than a mere sequence of popular hits; it’s the culmination of a systematic, data-driven approach to musical storytelling. We began with two anchor tracks—both proven crowd-pleasers with high energy scores—and then broadened our palette using five complementary heuristics:

- We looked to co-occurrence patterns in real user playlists to uncover songs that listeners already associate with our anchors.  
- We identified tracks whose audio profiles (danceability, energy, tempo) closely mirror those anchors.  
- We stayed true to the period by selecting songs released within two years of our anchors, preserving era consistency.  
- We wove in harmonic compatibility via circle-of-fifths relationships, ensuring smooth key transitions.  
- And, at every step, we balanced chart-toppers with hidden gems to spark both comfort and discovery.

The result is a tightly woven 12-track journey: it opens with familiar favorites, dips into under-the-radar discoveries at just the right moments, and builds through peaks and valleys of energy and danceability, finishing on an invigorating high note. Every transition feels intentional—guided by real user behavior, rigorous audio-feature comparison, and music-theory principles.

---

## Conclusion

In this mini-project, we demonstrated how two Spotify exports—a detailed song-characteristics file and a sprawling playlist JSON archive—can be combined, cleaned, and transformed into a rich analytical playground. After rectangling nested data into a flat table of over 150 000 track-playlist rows, we charted trends in popularity, danceability, tempo, key usage, and decade representation. Those insights then fueled five distinct heuristics for related-song discovery, culminating in “Harmonic Journey,” a data-backed playlist that balances familiarity with fresh exploration and musical cohesion.

This journey shows that data science can do more than recommend random singles: by blending user-driven patterns, audio-feature analytics, and music-theory constraints, we can craft playlists that feel both surprising and harmonious. Future extensions—genre clustering, collaborative filtering, deeper time-series analyses—promise even richer, more personalized musical experiences.

## Extra Credit: Interactive Visualization

To bring our “Harmonic Journey” to life, we’ll animate the path through the danceability × energy space using **gganimate**. We’ll treat each track’s position in the playlist as a time step and label just a few key points to avoid clutter.



::: {.cell}

```{.r .cell-code}
# 0. make sure your CRAN mirror is set (only needed if you ever auto‐install)
options(repos = c(CRAN = "https://cloud.r-project.org"))

# 1. Libraries
library(ggplot2)
library(gganimate)
library(gifski)
library(ggrepel)
library(viridis)

# 2. Prepare the data (including tempo)
animation_data <- ultimate_playlist %>%
  select(position, track_name, artist_name, danceability, energy, tempo) %>%
  mutate(
    # only label a few key positions
    label = if_else(
      position %in% c(1, round(n()/2), n()),
      paste0(position, ". ", track_name),
      NA_character_
    )
  )

# 3. Build the static ggplot
p <- ggplot(animation_data, aes(x = danceability, y = energy)) +
  geom_point(aes(size = tempo, color = tempo), alpha = 0.8) +
  geom_text_repel(aes(label = label),
                  nudge_y       = 0.02,
                  segment.alpha = 0.3,
                  show.legend   = FALSE) +
  scale_color_viridis_c(option = "plasma", name = "Tempo (BPM)") +
  scale_size_continuous(range = c(3, 8), name = "Tempo (BPM)") +
  labs(
    x       = "Danceability (0–1)",
    y       = "Energy (0–1)",
    caption = "Data: Combined Spotify song & playlist data"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title       = element_text(face = "bold", size = 18),
    plot.subtitle    = element_text(size = 14),
    axis.title       = element_text(face = "bold"),
    panel.grid.major = element_line(color = "#dddddd", linetype = "dashed")
  ) +
  coord_cartesian(xlim = c(0, 1), ylim = c(0, 1))

# 4. Add animation: position drives the frame time
anim <- p +
  transition_time(position) +
  ease_aes("cubic-in-out") +
  labs(
    title    = "Harmonic Journey: Track {frame_time} of {max(frame_time)}",
    subtitle = "Position in playlist → feature evolution"
  )

# 5. Render the GIF with pixel units and reasonable DPI
animate(anim,
        nframes  = nrow(animation_data) * 4,
        fps      = 10,
        width    = 800,
        height   = 600,
        units    = "px",      # interpret width/height as pixels
        res      = 72,        # drop resolution to 72 dpi
        renderer = gifski_renderer())
```

::: {.cell-output-display}
![](mp03_files/figure-html/animated-visualization-1.gif)
:::
:::



This animated visualization demonstrates how the playlist progresses through the "energy-danceability space," showing the path from one song to the next. The animation highlights how the playlist creates a journey through different moods and intensities, rather than maintaining static audio characteristics.

## Interactive Viewer: Experience the Ultimate Playlist

To provide a more interactive experience, I've created a simple HTML viewer that displays the playlist with embedded song previews. This allows you to experience the playlist's flow firsthand.



<div style='background: linear-gradient(135deg, #1DB954, #191414);
            padding: 20px; border-radius: 10px;
            max-width: 800px; margin: auto;'>
  <h2 style='color: white; text-align: center;
             font-family: Montserrat, sans-serif;'>
    Harmonic Journey
  </h2>
  <p style='color: white; text-align: center;
            font-style: italic; margin-bottom: 20px;'>
    A data‐driven selection of modern pop hits that balances familiarity and discovery, weaving peaks and valleys in energy, danceability and tempo.
  </p>
  <div style='display: grid;
              grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
              gap: 20px;'>  <div style='background: white; padding: 10px;
              border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);'>
    <iframe 
      src='https://open.spotify.com/embed/track/6gBFPUFcJLzWGx4lenP6h2'
      width='100%' height='80' frameborder='0'
      allowtransparency='true' allow='encrypted-media'>
    </iframe>
    <div style='margin-top: 8px; font-weight: bold;'>
      goosebumps
    </div>
    <div style='color: #555; font-size: 0.9em;'>
      Travis Scott
    </div>
  </div>  <div style='background: white; padding: 10px;
              border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);'>
    <iframe 
      src='https://open.spotify.com/embed/track/4DpNNXFMMxQEKl7r0ykkWA'
      width='100%' height='80' frameborder='0'
      allowtransparency='true' allow='encrypted-media'>
    </iframe>
    <div style='margin-top: 8px; font-weight: bold;'>
      Play Date
    </div>
    <div style='color: #555; font-size: 0.9em;'>
      Melanie Martinez
    </div>
  </div>  <div style='background: white; padding: 10px;
              border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);'>
    <iframe 
      src='https://open.spotify.com/embed/track/1WoOzgvz6CgH4pX6a1RKGp'
      width='100%' height='80' frameborder='0'
      allowtransparency='true' allow='encrypted-media'>
    </iframe>
    <div style='margin-top: 8px; font-weight: bold;'>
      My Way (feat. Monty)
    </div>
    <div style='color: #555; font-size: 0.9em;'>
      Fetty Wap
    </div>
  </div>  <div style='background: white; padding: 10px;
              border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);'>
    <iframe 
      src='https://open.spotify.com/embed/track/10sNkTjcPhK9A112WCMIbv'
      width='100%' height='80' frameborder='0'
      allowtransparency='true' allow='encrypted-media'>
    </iframe>
    <div style='margin-top: 8px; font-weight: bold;'>
      Turn Down
    </div>
    <div style='color: #555; font-size: 0.9em;'>
      Rittz
    </div>
  </div>  <div style='background: white; padding: 10px;
              border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);'>
    <iframe 
      src='https://open.spotify.com/embed/track/7aKWgpecgLEqisWcXPElDl'
      width='100%' height='80' frameborder='0'
      allowtransparency='true' allow='encrypted-media'>
    </iframe>
    <div style='margin-top: 8px; font-weight: bold;'>
      Never There
    </div>
    <div style='color: #555; font-size: 0.9em;'>
      Cake
    </div>
  </div>  <div style='background: white; padding: 10px;
              border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);'>
    <iframe 
      src='https://open.spotify.com/embed/track/4vmERH5UYG1FLcR2sTBcjY'
      width='100%' height='80' frameborder='0'
      allowtransparency='true' allow='encrypted-media'>
    </iframe>
    <div style='margin-top: 8px; font-weight: bold;'>
      All the Way (I Believe In Steve)
    </div>
    <div style='color: #555; font-size: 0.9em;'>
      Jacksepticeye
    </div>
  </div>  <div style='background: white; padding: 10px;
              border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);'>
    <iframe 
      src='https://open.spotify.com/embed/track/7kMMTfdIkDJpmrkxBlVwEf'
      width='100%' height='80' frameborder='0'
      allowtransparency='true' allow='encrypted-media'>
    </iframe>
    <div style='margin-top: 8px; font-weight: bold;'>
      Black Country Woman
    </div>
    <div style='color: #555; font-size: 0.9em;'>
      Led Zeppelin
    </div>
  </div>  <div style='background: white; padding: 10px;
              border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);'>
    <iframe 
      src='https://open.spotify.com/embed/track/6wNeKPXF0RDKyvfKfri5hf'
      width='100%' height='80' frameborder='0'
      allowtransparency='true' allow='encrypted-media'>
    </iframe>
    <div style='margin-top: 8px; font-weight: bold;'>
      Dollhouse
    </div>
    <div style='color: #555; font-size: 0.9em;'>
      Melanie Martinez
    </div>
  </div>  <div style='background: white; padding: 10px;
              border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);'>
    <iframe 
      src='https://open.spotify.com/embed/track/5gWtkdgdyt5bZt9i6n3Kqd'
      width='100%' height='80' frameborder='0'
      allowtransparency='true' allow='encrypted-media'>
    </iframe>
    <div style='margin-top: 8px; font-weight: bold;'>
      Mad Hatter
    </div>
    <div style='color: #555; font-size: 0.9em;'>
      Melanie Martinez
    </div>
  </div>  <div style='background: white; padding: 10px;
              border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);'>
    <iframe 
      src='https://open.spotify.com/embed/track/282L6SR4Y8Rs0VUgtEy1Zw'
      width='100%' height='80' frameborder='0'
      allowtransparency='true' allow='encrypted-media'>
    </iframe>
    <div style='margin-top: 8px; font-weight: bold;'>
      She Knows
    </div>
    <div style='color: #555; font-size: 0.9em;'>
      J. Cole
    </div>
  </div>  <div style='background: white; padding: 10px;
              border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);'>
    <iframe 
      src='https://open.spotify.com/embed/track/7GX5flRQZVHRAGd6B4TmDO'
      width='100%' height='80' frameborder='0'
      allowtransparency='true' allow='encrypted-media'>
    </iframe>
    <div style='margin-top: 8px; font-weight: bold;'>
      XO TOUR Llif3
    </div>
    <div style='color: #555; font-size: 0.9em;'>
      Lil Uzi Vert
    </div>
  </div>  <div style='background: white; padding: 10px;
              border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);'>
    <iframe 
      src='https://open.spotify.com/embed/track/7KXjTSCq5nL1LoYtL7XAwS'
      width='100%' height='80' frameborder='0'
      allowtransparency='true' allow='encrypted-media'>
    </iframe>
    <div style='margin-top: 8px; font-weight: bold;'>
      HUMBLE.
    </div>
    <div style='color: #555; font-size: 0.9em;'>
      Kendrick Lamar
    </div>
  </div>
  </div>
</div>



## Resources & References

Throughout this project, I've applied various data analysis techniques and visualization principles to extract insights from Spotify data. The following resources were helpful in guiding my approach:

-Spotify Web API Documentation — for the definitions and interpretation of each audio feature.

-R for Data Science (Wickham & Grolemund) — for data transformation with dplyr and tidyr.

-ggplot2: Elegant Graphics for Data Analysis (Wickham) — for all of our static, publication-quality plots.

-gganimate documentation — for the animated feature journey (see ?transition_time, ?shadow_trail).

-viridis & RColorBrewer — for perceptually uniform color scales in both static and animated charts.

-ggrepel — for clean, non-overlapping text labels in complex plots.

-KableExtra — for styling your tables to “publication-quality” standards.

-Music Theory for Computer Musicians — to understand key signatures and the circle of fifths when selecting complementary-key tracks.

## Appendix: Full Code Repository

All code used in this analysis is available in the GitHub repository. The code is structured to be reproducible, with responsible data downloading practices and clear documentation.

-Data Ingestion

load_songs() — downloads & cleans the Spotify song features CSV

load_playlists() — reads your OneDrive JSON slices (or falls back to GitHub)

rectangle_playlists() — flattens the nested JSON into a one-row-per-track table

-Exploration & Visualization

Initial EDA chunk (distinct counts, top tracks, danceability, playlist lengths, popularity)

-Static plots:

popularity vs. appearances

popular songs by year

danceability over time

decade representation

key frequency (polar)

track length distribution

energy vs. danceability

tempo trends

-Heuristic Functions (each keeping track_id):

Co-occurrence on anchor playlists

Audio-feature similarity

Same-artist selection

Same-era & feature similarity

Complementary-key selection

Candidate Combining & Final Curation

combine-candidates chunk — confirms ≥20 candidates & ≥8 hidden gems

create-ultimate-playlist chunk — builds the 12-song “Harmonic Journey,” tags unknowns

-Extra Credit

animated-visualization chunk — gganimate of danceability × energy over track position

generate-html-viewer chunk — grid of Spotify embeds



::: {.cell}

```{.r .cell-code  code-fold="true" code-summary="Click to view full project setup code"}
# Setup environment
library(tidyverse)
library(knitr)
library(kableExtra)
library(lubridate)
library(jsonlite)
library(purrr)
library(ggrepel)
library(viridis)
library(gganimate)
library(gifski)

# Task 1: Song Characteristics Dataset
load_songs <- function() {
  # Define target directory and file name
  dest_dir <- "data/mp03"
  if (!dir.exists(dest_dir)) {
    dir.create(dest_dir, recursive = TRUE)
    message("Created directory: ", dest_dir)
  }
  
  # Define destination file path
  dest_file <- file.path(dest_dir, "spotify_data.csv")
  
  # Download only if needed
  if (!file.exists(dest_file)) {
    spotify_url <- "https://raw.githubusercontent.com/gabminamedez/spotify-data/refs/heads/master/data.csv"
    download.file(url = spotify_url, destfile = dest_file, mode = "wb")
    message("Downloaded Spotify song analytics dataset")
  } else {
    message("Using existing Spotify song analytics dataset")
  }
  
  # Read and clean the data
  songs <- read.csv(dest_file, stringsAsFactors = FALSE)
  
  # Helper function to clean artist strings
  clean_artist_string <- function(x) {
    str_replace_all(x, "\\['", "") %>% 
      str_replace_all("'\\]", "") %>% 
      str_replace_all("', '", ",")
  }
  
  # Process the songs data frame
  songs_clean <- songs %>% 
    mutate(artists = clean_artist_string(artists)) %>%
    separate_rows(artists, sep = ",") %>%
    mutate(artists = trimws(artists)) %>%
    rename(artist = artists)
  
  return(songs_clean)
}

# Task 2: Playlist Dataset
load_playlists <- function() {
  # Define target directory
  dest_dir <- "data/mp03/playlists"
  if (!dir.exists(dest_dir)) {
    dir.create(dest_dir, recursive = TRUE)
    message("Created directory: ", dest_dir)
  }
  
  # Base GitHub URL for data
  base_url <- "https://raw.githubusercontent.com/DevinOgrady/spotify_million_playlist_dataset/main/data1"
  
  # Initialize empty list for playlists
  all_playlists <- list()
  
  # For demonstration purposes, we'll use a small subset of files
  # In a real analysis, you'd process more files
  for (i in seq(0, 2000, 1000)) {
    # Construct filename programmatically
    filename <- sprintf("mpd.slice.%d-%d.json", i, i + 999)
    local_path <- file.path(dest_dir, filename)
    
    # Download file if it doesn't exist
    if (!file.exists(local_path)) {
      file_url <- paste0(base_url, "/", filename)
      
      tryCatch({
        download.file(file_url, local_path, mode = "wb")
        message(sprintf("Downloaded %s", filename))
        # Small delay to avoid overwhelming the server
        Sys.sleep(0.5)
      }, error = function(e) {
        message(sprintf("Error downloading %s: %s", filename, e$message))
      })
    } else {
      message(sprintf("File %s already exists locally", filename))
    }
    
    # Read and process the JSON file if it exists
    if (file.exists(local_path)) {
      tryCatch({
        playlist_data <- fromJSON(local_path, simplifyDataFrame = FALSE)
        
        if ("playlists" %in% names(playlist_data) && is.list(playlist_data$playlists)) {
          all_playlists <- c(all_playlists, playlist_data$playlists)
          message(sprintf("Processed %s with %d playlists", 
                         filename, length(playlist_data$playlists)))
        } else {
          message(sprintf("File %s doesn't have the expected structure", filename))
        }
      }, error = function(e) {
        message(sprintf("Error loading %s: %s", filename, e$message))
      })
    }
  }
  
  return(all_playlists)
}

# Task 3: Rectangle the Playlist Data
rectangle_playlists <- function(playlists) {
  # Initialize an empty data frame to store the results
  result_df <- data.frame()
  
  # Helper function to strip Spotify prefixes
  strip_spotify_prefix <- function(x) {
    str_extract(x, ".*:.*:(.*)", group = 1)
  }
  
  # Process each playlist
  for (i in seq_along(playlists)) {
    playlist <- playlists[[i]]
    
    # Extract playlist-level information
    playlist_id <- playlist$pid
    playlist_name <- playlist$name
    playlist_followers <- playlist$num_followers
    
    # Process each track in the playlist
    if (length(playlist$tracks) > 0) {
      for (j in seq_along(playlist$tracks)) {
        track <- playlist$tracks[[j]]
        
        # Create a row for this track
        track_row <- data.frame(
          playlist_id = playlist_id,
          playlist_name = playlist_name,
          playlist_followers = playlist_followers,
          playlist_position = j,
          artist_name = track$artist_name,
          artist_id = strip_spotify_prefix(track$artist_uri),
          track_name = track$track_name,
          track_id = strip_spotify_prefix(track$track_uri),
          album_name = track$album_name,
          album_id = strip_spotify_prefix(track$album_uri),
          duration = track$duration_ms,
          stringsAsFactors = FALSE
        )
        
        # Append to the result
        result_df <- rbind(result_df, track_row)
      }
    }
  }
  
  return(result_df)
}

# Main execution code would follow here
# For brevity, this is not included in the appendix
```
:::

::: {.cell}

```{.r .cell-code  code-fold="true" code-summary="Click to view visualization code"}
# Example of a publication-quality visualization function
create_feature_evolution_plot <- function(playlist_data) {
  # Prepare data
  plot_data <- playlist_data %>%
    select(position, track_name, artist_name, danceability, energy, tempo) %>%
    pivot_longer(
      cols = c(danceability, energy, tempo),
      names_to = "feature",
      values_to = "value"
    ) %>%
    # Normalize tempo to 0-1 scale for better comparison
    mutate(value = ifelse(feature == "tempo", value / 200, value))
  
  # Create plot
  ggplot(plot_data, aes(x = position, y = value, color = feature, group = feature)) +
    geom_line(size = 1.2) +
    geom_point(size = 3) +
    scale_color_manual(values = c("danceability" = "#3498db", "energy" = "#e74c3c", "tempo" = "#2ecc71")) +
    labs(
      title = "Playlist Feature Evolution",
      subtitle = "How audio characteristics flow throughout the playlist",
      x = "Playlist Position",
      y = "Feature Value (normalized)",
      color = "Audio Feature"
    ) +
    theme_minimal() +
    theme(
      plot.title = element_text(face = "bold", size = 16),
      plot.subtitle = element_text(size = 12),
      axis.title = element_text(face = "bold"),
      legend.position = "bottom",
      panel.grid.major = element_line(color = "#bdc3c7", linetype = "dashed")
    )
}

# This function would be called with: create_feature_evolution_plot(ultimate_playlist)
```
:::



## Final Thoughts

Creating the ultimate playlist requires both art and science. Through this mini-project, I've demonstrated how data analysis can enhance music curation by revealing patterns and relationships in audio features. The "Harmonic Journey" playlist exemplifies a balanced, data-driven approach to music selection, creating a cohesive listening experience that guides the listener through a carefully crafted sonic landscape.

The combination of objective metrics (audio features, popularity scores) with more subjective considerations (musical flow, thematic coherence) results in a playlist that's both statistically sound and emotionally engaging. This approach has wide-ranging applications in music recommendation systems, content curation, and digital media strategy.

Most importantly, this analysis shows how data science can enhance, rather than replace, human creativity—providing insights that inform artistic decisions and create better experiences for listeners. By animating our feature‐journey plot and embedding live Spotify players in the HTML viewer, we’ve turned a static report into an interactive, multimedia exploration of “Harmonic Journey.” This blend of rigorous analytics, music theory, and engaging presentation demonstrates the full potential of data‐driven curation in the digital age.
