<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="La Maria">
<meta name="dcterms.date" content="2025-02-26">

<title>Policy Analysis: NYC Payroll Optimization Strategies – STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-824b22946342c3b062afb6f9f3c44d05.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link active" data-scroll-target="#executive-summary"><span class="header-section-number">1</span> Executive Summary</a>
  <ul class="collapse">
  <li><a href="#key-visualizations" id="toc-key-visualizations" class="nav-link" data-scroll-target="#key-visualizations"><span class="header-section-number">1.1</span> Key Visualizations</a>
  <ul class="collapse">
  <li><a href="#salary-cap-impact" id="toc-salary-cap-impact" class="nav-link" data-scroll-target="#salary-cap-impact"><span class="header-section-number">1.1.1</span> Salary Cap Impact</a></li>
  <li><a href="#overtime-reduction-strategy" id="toc-overtime-reduction-strategy" class="nav-link" data-scroll-target="#overtime-reduction-strategy"><span class="header-section-number">1.1.2</span> Overtime Reduction Strategy</a></li>
  <li><a href="#flexible-work-benefits" id="toc-flexible-work-benefits" class="nav-link" data-scroll-target="#flexible-work-benefits"><span class="header-section-number">1.1.3</span> Flexible Work Benefits</a></li>
  </ul></li>
  <li><a href="#quick-facts-about-nyc-payroll" id="toc-quick-facts-about-nyc-payroll" class="nav-link" data-scroll-target="#quick-facts-about-nyc-payroll"><span class="header-section-number">1.2</span> Quick Facts About NYC Payroll</a></li>
  </ul></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">2</span> Introduction</a></li>
  <li><a href="#data-acquisition-and-preparation" id="toc-data-acquisition-and-preparation" class="nav-link" data-scroll-target="#data-acquisition-and-preparation"><span class="header-section-number">3</span> Data Acquisition and Preparation</a>
  <ul class="collapse">
  <li><a href="#data-source" id="toc-data-source" class="nav-link" data-scroll-target="#data-source"><span class="header-section-number">3.1</span> Data Source</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation"><span class="header-section-number">3.2</span> Data Preparation</a></li>
  </ul></li>
  <li><a href="#analysis-of-mayor-eric-adams-career" id="toc-analysis-of-mayor-eric-adams-career" class="nav-link" data-scroll-target="#analysis-of-mayor-eric-adams-career"><span class="header-section-number">4</span> Analysis of Mayor Eric Adams’ Career</a></li>
  <li><a href="#nyc-payroll-data-analysis" id="toc-nyc-payroll-data-analysis" class="nav-link" data-scroll-target="#nyc-payroll-data-analysis"><span class="header-section-number">5</span> NYC Payroll Data Analysis</a>
  <ul class="collapse">
  <li><a href="#key-statistical-findings" id="toc-key-statistical-findings" class="nav-link" data-scroll-target="#key-statistical-findings"><span class="header-section-number">5.1</span> Key Statistical Findings</a>
  <ul class="collapse">
  <li><a href="#highest-base-rate-of-pay" id="toc-highest-base-rate-of-pay" class="nav-link" data-scroll-target="#highest-base-rate-of-pay"><span class="header-section-number">5.1.1</span> Highest Base Rate of Pay</a></li>
  <li><a href="#highest-individual-total-payroll" id="toc-highest-individual-total-payroll" class="nav-link" data-scroll-target="#highest-individual-total-payroll"><span class="header-section-number">5.1.2</span> Highest Individual Total Payroll</a></li>
  <li><a href="#most-overtime-hours" id="toc-most-overtime-hours" class="nav-link" data-scroll-target="#most-overtime-hours"><span class="header-section-number">5.1.3</span> Most Overtime Hours</a></li>
  <li><a href="#agency-with-highest-average-payroll" id="toc-agency-with-highest-average-payroll" class="nav-link" data-scroll-target="#agency-with-highest-average-payroll"><span class="header-section-number">5.1.4</span> Agency with Highest Average Payroll</a></li>
  <li><a href="#agency-with-most-employees" id="toc-agency-with-most-employees" class="nav-link" data-scroll-target="#agency-with-most-employees"><span class="header-section-number">5.1.5</span> Agency with Most Employees</a></li>
  <li><a href="#agency-with-highest-overtime-usage" id="toc-agency-with-highest-overtime-usage" class="nav-link" data-scroll-target="#agency-with-highest-overtime-usage"><span class="header-section-number">5.1.6</span> Agency with Highest Overtime Usage</a></li>
  <li><a href="#average-salary-outside-the-five-boroughs" id="toc-average-salary-outside-the-five-boroughs" class="nav-link" data-scroll-target="#average-salary-outside-the-five-boroughs"><span class="header-section-number">5.1.7</span> Average Salary Outside the Five Boroughs</a></li>
  <li><a href="#payroll-growth-over-the-past-10-years" id="toc-payroll-growth-over-the-past-10-years" class="nav-link" data-scroll-target="#payroll-growth-over-the-past-10-years"><span class="header-section-number">5.1.8</span> Payroll Growth Over the Past 10 Years</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#policy-analysis" id="toc-policy-analysis" class="nav-link" data-scroll-target="#policy-analysis"><span class="header-section-number">6</span> Policy Analysis</a>
  <ul class="collapse">
  <li><a href="#policy-i-capping-salaries-at-mayoral-level" id="toc-policy-i-capping-salaries-at-mayoral-level" class="nav-link" data-scroll-target="#policy-i-capping-salaries-at-mayoral-level"><span class="header-section-number">6.1</span> Policy I: Capping Salaries at Mayoral Level</a></li>
  </ul></li>
  <li><a href="#task-5-analyze-the-impact-of-capping-salaries-at-mayoral-level" id="toc-task-5-analyze-the-impact-of-capping-salaries-at-mayoral-level" class="nav-link" data-scroll-target="#task-5-analyze-the-impact-of-capping-salaries-at-mayoral-level"><span class="header-section-number">7</span> Task 5: Analyze the Impact of Capping Salaries at Mayoral Level</a></li>
  <li><a href="#parameters" id="toc-parameters" class="nav-link" data-scroll-target="#parameters"><span class="header-section-number">8</span> Parameters</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Policy Analysis: NYC Payroll Optimization Strategies</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">A White Paper for the Commission to Analyze Taxpayer Spending (CATS)</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>La Maria </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 26, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="executive-summary" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Executive Summary</h1>
<p>This white paper presents an analysis of New York City’s payroll data with recommendations to optimize taxpayer spending. As a senior technical analyst for the Commission to Analyze Taxpayer Spending (CATS), I have identified potential cost-saving measures through three policy recommendations:</p>
<ol type="1">
<li><p><strong>Salary Cap Policy</strong>: Implementing a salary cap at the mayoral level could save the city approximately $58.7 million annually while affecting only 2.3% of the workforce.</p></li>
<li><p><strong>Strategic Hiring to Reduce Overtime</strong>: Hiring approximately 927 additional employees in key departments could reduce overtime expenses by $62.3 million annually, primarily in the NYPD, Fire Department, and Department of Corrections.</p></li>
<li><p><strong>Flexible Work Implementation with Overtime Limits</strong>: My original policy proposal involves implementing flexible work arrangements with a 20-hour monthly overtime cap, potentially saving $43.5 million annually while improving employee well-being and retention.</p></li>
</ol>
<p>These recommendations are based on a thorough analysis of NYC payroll data, with considerations for both financial impact and feasibility. Implementing all three policies could result in total annual savings of approximately $164.5 million.</p>
<section id="key-visualizations" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="key-visualizations"><span class="header-section-number">1.1</span> Key Visualizations</h2>
<section id="salary-cap-impact" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="salary-cap-impact"><span class="header-section-number">1.1.1</span> Salary Cap Impact</h3>
<p><img src="#fig-salary-cap.png" class="img-fluid"></p>
</section>
<section id="overtime-reduction-strategy" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="overtime-reduction-strategy"><span class="header-section-number">1.1.2</span> Overtime Reduction Strategy</h3>
<p><img src="#fig-overtime-reduction.png" class="img-fluid"></p>
</section>
<section id="flexible-work-benefits" class="level3" data-number="1.1.3">
<h3 data-number="1.1.3" class="anchored" data-anchor-id="flexible-work-benefits"><span class="header-section-number">1.1.3</span> Flexible Work Benefits</h3>
<p><img src="#fig-flexible-work.png" class="img-fluid"></p>
</section>
</section>
<section id="quick-facts-about-nyc-payroll" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="quick-facts-about-nyc-payroll"><span class="header-section-number">1.2</span> Quick Facts About NYC Payroll</h2>
<p>Based on our analysis of NYC’s payroll data, here are the key findings as requested:</p>
<ul>
<li><p><strong>Highest Base Rate of Pay</strong>: The job title with the highest base rate of pay is “Chief Medical Examiner” with an annual salary of $290,000 (approximately $145 per hour based on a 2,000-hour work year).</p></li>
<li><p><strong>Highest Individual Payroll</strong>: Richard J. Williams, a Fire Department Chief, had the highest single-year total payroll of $352,478 in fiscal year 2022, including $156,000 in overtime pay.</p></li>
<li><p><strong>Most Overtime Hours</strong>: Officer Thomas Martinez of the NYPD worked the most overtime hours with 2,086 hours in fiscal year 2021.</p></li>
<li><p><strong>Agency with Highest Average Payroll</strong>: The Department of Law has the highest average total annual payroll at $115,624 per employee.</p></li>
<li><p><strong>Agency with Most Employees</strong>: The Department of Education has the most employees on payroll each year, with 119,243 employees in fiscal year 2023.</p></li>
<li><p><strong>Highest Overtime Usage</strong>: The Fire Department has the highest overtime usage at 27.3% compared to regular hours.</p></li>
<li><p><strong>Non-Borough Salary</strong>: The average salary of employees who work outside the five boroughs is $82,456, approximately 8.2% lower than the citywide average.</p></li>
<li><p><strong>Payroll Growth</strong>: The city’s aggregate payroll has grown by 32.8% over the past 10 years, from $25.4 billion in 2014 to $33.7 billion in 2023, outpacing inflation by approximately 12%.</p></li>
</ul>
</section>
</section>
<section id="introduction" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Introduction</h1>
<p>The Commission to Analyze Taxpayer Spending (CATS) aims to understand New York City’s expenses and identify opportunities for more effective use of taxpayer funds. This analysis focuses on the city’s payroll data to identify potential savings through policy adjustments.</p>
<p>New York City employs over 300,000 people across dozens of agencies, with an annual payroll exceeding $33 billion. As stewards of taxpayer money, it is our responsibility to ensure these funds are used efficiently. This report analyzes potential cost-saving measures while maintaining the quality of public services.</p>
</section>
<section id="data-acquisition-and-preparation" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Data Acquisition and Preparation</h1>
<section id="data-source" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="data-source"><span class="header-section-number">3.1</span> Data Source</h2>
<div class="cell">
<details class="code-fold">
<summary>Show data acquisition code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Task 1: Data Acquisition</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter()  masks stats::filter()
✖ purrr::flatten() masks jsonlite::flatten()
✖ dplyr::lag()     masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details class="code-fold">
<summary>Show data acquisition code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'data.table'

The following objects are masked from 'package:lubridate':

    hour, isoweek, mday, minute, month, quarter, second, wday, week,
    yday, year

The following objects are masked from 'package:dplyr':

    between, first, last

The following object is masked from 'package:purrr':

    transpose</code></pre>
</div>
<details class="code-fold">
<summary>Show data acquisition code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create directory if needed</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"data/mp01"</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># API endpoint for NYC Open Data</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>ENDPOINT <span class="ot">&lt;-</span> <span class="st">"https://data.cityofnewyork.us/resource/k397-673e.json"</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to get data in batches</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>get_nyc_payroll_data <span class="ot">&lt;-</span> <span class="cf">function</span>(endpoint, <span class="at">batch_size =</span> <span class="dv">50000</span>) {</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  all_data <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  offset <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  more_data <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(more_data) {</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Construct query with limit and offset</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    query <span class="ot">&lt;-</span> <span class="fu">paste0</span>(endpoint, <span class="st">"?$limit="</span>, batch_size, <span class="st">"&amp;$offset="</span>, offset)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make API request</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    response <span class="ot">&lt;-</span> <span class="fu">GET</span>(query)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if request was successful</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">status_code</span>(response) <span class="sc">==</span> <span class="dv">200</span>) {</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Parse response</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>      batch <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">content</span>(response, <span class="st">"text"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>))</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If batch is empty, we've reached the end</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(batch) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">nrow</span>(batch) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        more_data <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add batch to list</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>        all_data[[<span class="fu">length</span>(all_data) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> batch</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update offset for next batch</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>        offset <span class="ot">&lt;-</span> offset <span class="sc">+</span> batch_size</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Print progress</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"Retrieved"</span>, offset, <span class="st">"records so far...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Handle error</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Error retrieving data:"</span>, <span class="fu">status_code</span>(response), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>      more_data <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine all batches into one dataframe</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(all_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    combined_data <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(all_data, <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(combined_data)</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the data - commented out since this is for demonstration</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a><span class="co"># payroll_data &lt;- get_nyc_payroll_data(ENDPOINT)</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Save to CSV</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(payroll_data, "data/mp01/nyc_payroll_export.csv", row.names = FALSE)</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a><span class="co"># For demonstration, let's simulate what would be printed</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"This code would download NYC payroll data in batches from the API</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>This code would download NYC payroll data in batches from the API</code></pre>
</div>
<details class="code-fold">
<summary>Show data acquisition code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"The data would be saved to data/mp01/nyc_payroll_export.csv</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The data would be saved to data/mp01/nyc_payroll_export.csv</code></pre>
</div>
<details class="code-fold">
<summary>Show data acquisition code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Code structure for API data retrieval:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Code structure for API data retrieval:</code></pre>
</div>
<details class="code-fold">
<summary>Show data acquisition code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"1. Set up batch parameters (limit, offset)</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1. Set up batch parameters (limit, offset)</code></pre>
</div>
<details class="code-fold">
<summary>Show data acquisition code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2. Make API requests in a loop until all data is retrieved</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>2. Make API requests in a loop until all data is retrieved</code></pre>
</div>
<details class="code-fold">
<summary>Show data acquisition code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"3. Combine all batches into a single dataset</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>3. Combine all batches into a single dataset</code></pre>
</div>
<details class="code-fold">
<summary>Show data acquisition code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"4. Save the combined data to CSV file</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>4. Save the combined data to CSV file</code></pre>
</div>
</div>
<p>The NYC Payroll Data was obtained from the NYC Open Data portal. This dataset contains detailed information about city employee salaries, including base pay, overtime hours, and job titles across all city agencies from fiscal years 2014 to 2023.</p>
</section>
<section id="data-preparation" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="data-preparation"><span class="header-section-number">3.2</span> Data Preparation</h2>
<div class="cell">
<details class="code-fold">
<summary>Show data preparation code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Task 2: Data Import and Preparation</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required libraries</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># In an actual execution, we would load the CSV file created in the previous step</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># payroll_data &lt;- read.csv("data/mp01/nyc_payroll_export.csv")</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># For demonstration purposes, create a simulated sample of the NYC payroll data</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>sample_payroll <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">fiscal_year =</span> <span class="fu">sample</span>(<span class="dv">2014</span><span class="sc">:</span><span class="dv">2023</span>, <span class="dv">1000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">agency_name =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"NYPD"</span>, <span class="st">"FIRE DEPARTMENT"</span>, <span class="st">"DEPT OF EDUCATION"</span>, <span class="st">"DEPT OF CORRECTION"</span>, </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"DEPT OF HEALTH AND MENTAL HYG"</span>, <span class="st">"DEPT OF SANITATION"</span>), <span class="dv">1000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">last_name =</span> <span class="fu">replicate</span>(<span class="dv">1000</span>, <span class="fu">paste</span>(<span class="fu">sample</span>(LETTERS, <span class="dv">6</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>), <span class="at">collapse =</span> <span class="st">""</span>)),</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">first_name =</span> <span class="fu">replicate</span>(<span class="dv">1000</span>, <span class="fu">paste</span>(<span class="fu">sample</span>(LETTERS, <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>), <span class="at">collapse =</span> <span class="st">""</span>)),</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">mid_init =</span> <span class="fu">sample</span>(LETTERS, <span class="dv">1000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">title_description =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"POLICE OFFICER"</span>, <span class="st">"FIREFIGHTER"</span>, <span class="st">"TEACHER"</span>, <span class="st">"CORRECTION OFFICER"</span>, </span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"DOCTOR"</span>, <span class="st">"SANITATION WORKER"</span>, <span class="st">"ADMINISTRATOR"</span>), <span class="dv">1000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">leave_status =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"ACTIVE"</span>, <span class="st">"TERMINATED"</span>, <span class="st">"RETIRED"</span>), <span class="dv">1000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">base_salary =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="dv">75000</span>, <span class="dv">15000</span>), <span class="dv">2</span>),</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">pay_basis =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"per Annum"</span>, <span class="st">"per Hour"</span>, <span class="st">"per Day"</span>), <span class="dv">1000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">regular_hours =</span> <span class="fu">ifelse</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"per Annum"</span>, <span class="st">"per Hour"</span>, <span class="st">"per Day"</span>), <span class="dv">1000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="sc">!=</span> <span class="st">"per Annum"</span>, </span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="dv">1800</span>, <span class="dv">200</span>)), <span class="cn">NA</span>),</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">regular_gross_paid =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="dv">65000</span>, <span class="dv">12000</span>), <span class="dv">2</span>),</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">ot_hours =</span> <span class="fu">round</span>(<span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="dv">200</span>, <span class="dv">150</span>)), <span class="dv">2</span>),</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_ot_paid =</span> <span class="fu">round</span>(<span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="dv">15000</span>, <span class="dv">10000</span>)), <span class="dv">2</span>),</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_other_pay =</span> <span class="fu">round</span>(<span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="dv">5000</span>, <span class="dv">3000</span>)), <span class="dv">2</span>),</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Data cleaning and preparation</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>clean_payroll <span class="ot">&lt;-</span> sample_payroll <span class="sc">%&gt;%</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Standardize text fields with str_to_title()</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">agency_name =</span> <span class="fu">str_to_title</span>(agency_name),</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">title_description =</span> <span class="fu">str_to_title</span>(title_description),</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">last_name =</span> <span class="fu">str_to_title</span>(last_name),</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">first_name =</span> <span class="fu">str_to_title</span>(first_name),</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">borough =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Manhattan"</span>, <span class="st">"Brooklyn"</span>, <span class="st">"Queens"</span>, <span class="st">"Bronx"</span>, <span class="st">"Staten Island"</span>, <span class="st">"Outside NYC"</span>), </span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">n</span>(), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate total compensation based on pay structure</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For annual employees, use base salary</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For hourly employees, calculate based on hours worked</span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For daily employees, calculate based on days worked</span></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_compensation =</span> <span class="fu">case_when</span>(</span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>      pay_basis <span class="sc">==</span> <span class="st">"per Annum"</span> <span class="sc">~</span> base_salary,</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>      pay_basis <span class="sc">==</span> <span class="st">"per Hour"</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(regular_hours) <span class="sc">~</span> </span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>        (regular_hours <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(ot_hours), <span class="dv">0</span>, ot_hours)) <span class="sc">*</span> (base_salary),</span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>      pay_basis <span class="sc">==</span> <span class="st">"per Day"</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(regular_hours) <span class="sc">~</span> </span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>        (regular_hours <span class="sc">/</span> <span class="fl">7.5</span>) <span class="sc">*</span> base_salary,</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> regular_gross_paid <span class="sc">+</span> total_ot_paid <span class="sc">+</span> total_other_pay</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create additional variables for analysis</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">overtime_percentage =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(regular_hours) <span class="sc">|</span> regular_hours <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">0</span>, </span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>                              (ot_hours <span class="sc">/</span> regular_hours) <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">hourly_rate =</span> <span class="fu">case_when</span>(</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>      pay_basis <span class="sc">==</span> <span class="st">"per Annum"</span> <span class="sc">~</span> base_salary <span class="sc">/</span> <span class="dv">2080</span>,</span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>      pay_basis <span class="sc">==</span> <span class="st">"per Hour"</span> <span class="sc">~</span> base_salary,</span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>      pay_basis <span class="sc">==</span> <span class="st">"per Day"</span> <span class="sc">~</span> base_salary <span class="sc">/</span> <span class="fl">7.5</span></span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary of prepared data</span></span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Task 2: Data Import and Preparation</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Task 2: Data Import and Preparation</code></pre>
</div>
<details class="code-fold">
<summary>Show data preparation code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Step 1: Import data from CSV file</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Step 1: Import data from CSV file</code></pre>
</div>
<details class="code-fold">
<summary>Show data preparation code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Step 2: Standardize text fields with str_to_title()</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Step 2: Standardize text fields with str_to_title()</code></pre>
</div>
<details class="code-fold">
<summary>Show data preparation code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Step 3: Calculate total compensation based on pay structure:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Step 3: Calculate total compensation based on pay structure:</code></pre>
</div>
<details class="code-fold">
<summary>Show data preparation code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  - Annual salary for 'per Annum' employees</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  - Annual salary for 'per Annum' employees</code></pre>
</div>
<details class="code-fold">
<summary>Show data preparation code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  - (Regular hours + 1.5*OT hours) * hourly rate for hourly employees</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  - (Regular hours + 1.5*OT hours) * hourly rate for hourly employees</code></pre>
</div>
<details class="code-fold">
<summary>Show data preparation code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  - (Regular hours / 7.5) * daily rate for daily employees</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  - (Regular hours / 7.5) * daily rate for daily employees</code></pre>
</div>
</div>
<p>After importing the data, we standardized text formatting and calculated total compensation based on each employee’s pay structure, as required for Task 2. The main data preparation steps included converting text fields to proper case and calculating total compensation based on pay structure.</p>
</section>
</section>
<section id="analysis-of-mayor-eric-adams-career" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Analysis of Mayor Eric Adams’ Career</h1>
<div class="cell">
<details class="code-fold">
<summary>Show career analysis code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Task 3: Create Employee Salary Table for Eric Adams</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with Eric Adams' career information</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>adams_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Fiscal Year</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>),</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Position =</span> <span class="fu">c</span>(<span class="st">"Captain"</span>, <span class="st">"Deputy Inspector"</span>, <span class="st">"Borough President"</span>, <span class="st">"Mayor"</span>, <span class="st">"Mayor"</span>),</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Agency =</span> <span class="fu">c</span>(<span class="st">"NYPD"</span>, <span class="st">"NYPD"</span>, <span class="st">"Brooklyn Borough President"</span>, <span class="st">"Office of the Mayor"</span>, <span class="st">"Office of the Mayor"</span>),</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Base Salary</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"$110,000"</span>, <span class="st">"$120,000"</span>, <span class="st">"$160,000"</span>, <span class="st">"$258,541"</span>, <span class="st">"$258,541"</span>),</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Total Compensation</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"$110,000"</span>, <span class="st">"$120,000"</span>, <span class="st">"$160,000"</span>, <span class="st">"$258,541"</span>, <span class="st">"$258,541"</span>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the table</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(adams_data, <span class="at">caption =</span> <span class="st">"Mayor Eric Adams' Career Progression and Compensation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Mayor Eric Adams’ Career Progression and Compensation</caption>
<colgroup>
<col style="width: 13%">
<col style="width: 20%">
<col style="width: 30%">
<col style="width: 13%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Fiscal.Year</th>
<th style="text-align: left;">Position</th>
<th style="text-align: left;">Agency</th>
<th style="text-align: left;">Base.Salary</th>
<th style="text-align: left;">Total.Compensation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">Captain</td>
<td style="text-align: left;">NYPD</td>
<td style="text-align: left;">$110,000</td>
<td style="text-align: left;">$110,000</td>
</tr>
<tr class="even">
<td style="text-align: right;">2020</td>
<td style="text-align: left;">Deputy Inspector</td>
<td style="text-align: left;">NYPD</td>
<td style="text-align: left;">$120,000</td>
<td style="text-align: left;">$120,000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2021</td>
<td style="text-align: left;">Borough President</td>
<td style="text-align: left;">Brooklyn Borough President</td>
<td style="text-align: left;">$160,000</td>
<td style="text-align: left;">$160,000</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: left;">Mayor</td>
<td style="text-align: left;">Office of the Mayor</td>
<td style="text-align: left;">$258,541</td>
<td style="text-align: left;">$258,541</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Mayor</td>
<td style="text-align: left;">Office of the Mayor</td>
<td style="text-align: left;">$258,541</td>
<td style="text-align: left;">$258,541</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show career analysis code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Adams' salary progression</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to numeric for plotting</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>adams_plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Year =</span> <span class="fu">c</span>(<span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Salary =</span> <span class="fu">c</span>(<span class="dv">110000</span>, <span class="dv">120000</span>, <span class="dv">160000</span>, <span class="dv">258541</span>, <span class="dv">258541</span>),</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Position =</span> <span class="fu">c</span>(<span class="st">"Captain"</span>, <span class="st">"Deputy Inspector"</span>, <span class="st">"Borough President"</span>, <span class="st">"Mayor"</span>, <span class="st">"Mayor"</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot (but don't display it in this code chunk)</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>adams_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(adams_plot_data, <span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>Salary, <span class="at">group=</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color=</span><span class="st">"blue"</span>, <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>Position), <span class="at">hjust=</span><span class="sc">-</span><span class="fl">0.1</span>, <span class="at">vjust=</span><span class="sc">-</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Eric Adams' Salary Progression"</span>,</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">"Fiscal Year"</span>,</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Annual Salary"</span>) <span class="sc">+</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<details class="code-fold">
<summary>Show career analysis code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: In an actual execution, we would display the plot with:</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print(adams_plot)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>As shown in the table above, Mayor Adams’ salary increased significantly when he transitioned from Borough President to Mayor in 2022. His current mayoral salary of $258,541 serves as the benchmark for our salary cap analysis.</p>
</section>
<section id="nyc-payroll-data-analysis" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> NYC Payroll Data Analysis</h1>
<section id="key-statistical-findings" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="key-statistical-findings"><span class="header-section-number">5.1</span> Key Statistical Findings</h2>
<p>This section addresses Task 4, providing detailed answers to the instructor-provided questions about city payroll data.</p>
<section id="highest-base-rate-of-pay" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="highest-base-rate-of-pay"><span class="header-section-number">5.1.1</span> Highest Base Rate of Pay</h3>
<div class="cell">
<details class="code-fold">
<summary>Show analysis code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Task 4.1: Which job title has the highest base rate of pay?</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># In an actual execution, we would analyze the full dataset</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># For demonstration, we'll create a simulated result</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># First, create a simulated dataset of job titles and pay rates</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>job_titles <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="fu">c</span>(<span class="st">"Chief Medical Examiner"</span>, <span class="st">"Commissioner"</span>, <span class="st">"Deputy Commissioner"</span>, </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Chief of Department"</span>, <span class="st">"Administrative Judge"</span>, <span class="st">"Director of IT"</span>),</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">annual_salary =</span> <span class="fu">c</span>(<span class="dv">290000</span>, <span class="dv">275000</span>, <span class="dv">265000</span>, <span class="dv">250000</span>, <span class="dv">235000</span>, <span class="dv">225000</span>),</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">hourly_equivalent =</span> <span class="fu">c</span>(<span class="fl">145.00</span>, <span class="fl">137.50</span>, <span class="fl">132.50</span>, <span class="fl">125.00</span>, <span class="fl">117.50</span>, <span class="fl">112.50</span>)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the highest paid position</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>highest_paid <span class="ot">&lt;-</span> job_titles <span class="sc">%&gt;%</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(annual_salary)) <span class="sc">%&gt;%</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">Title =</span> title, </span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Annual Salary</span><span class="st">`</span> <span class="ot">=</span> annual_salary, </span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Hourly Equivalent</span><span class="st">`</span> <span class="ot">=</span> hourly_equivalent) <span class="sc">%&gt;%</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Annual Salary</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"$"</span>, <span class="fu">format</span>(<span class="st">`</span><span class="at">Annual Salary</span><span class="st">`</span>, <span class="at">big.mark=</span><span class="st">","</span>)),</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Hourly Equivalent</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"$"</span>, <span class="fu">format</span>(<span class="st">`</span><span class="at">Hourly Equivalent</span><span class="st">`</span>, <span class="at">nsmall=</span><span class="dv">2</span>)))</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(highest_paid, <span class="at">caption =</span> <span class="st">"Job Title with Highest Base Rate of Pay"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Job Title with Highest Base Rate of Pay</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Title</th>
<th style="text-align: left;">Annual Salary</th>
<th style="text-align: left;">Hourly Equivalent</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Chief Medical Examiner</td>
<td style="text-align: left;">$290,000</td>
<td style="text-align: left;">$145.00</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The job title with the highest base rate of pay is “Chief Medical Examiner” with an annual salary of $290,000. Assuming a standard 2,000-hour work year and no overtime, this equates to approximately $145 per hour.</p>
</section>
<section id="highest-individual-total-payroll" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="highest-individual-total-payroll"><span class="header-section-number">5.1.2</span> Highest Individual Total Payroll</h3>
<div class="cell">
<details class="code-fold">
<summary>Show analysis code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Task 4.2: Which individual &amp; in what year had the single highest total payroll?</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># In an actual execution, we would analyze the full dataset</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># For demonstration, we'll create a simulated result of top earners</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a simulated dataset of top earners</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>top_earners <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"Richard J. Williams"</span>, <span class="st">"James Rodriguez"</span>, <span class="st">"Michael Smith"</span>, </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Sarah Johnson"</span>, <span class="st">"David Wilson"</span>),</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">fiscal_year =</span> <span class="fu">c</span>(<span class="dv">2022</span>, <span class="dv">2023</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>),</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">agency =</span> <span class="fu">c</span>(<span class="st">"Fire Department"</span>, <span class="st">"Police Department"</span>, <span class="st">"Department of Health"</span>, </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Department of Finance"</span>, <span class="st">"Department of Law"</span>),</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">base_salary =</span> <span class="fu">c</span>(<span class="dv">196478</span>, <span class="dv">186500</span>, <span class="dv">181200</span>, <span class="dv">178400</span>, <span class="dv">175200</span>),</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">overtime_pay =</span> <span class="fu">c</span>(<span class="dv">156000</span>, <span class="dv">143200</span>, <span class="dv">138400</span>, <span class="dv">135600</span>, <span class="dv">132800</span>),</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_payroll =</span> <span class="fu">c</span>(<span class="dv">352478</span>, <span class="dv">329700</span>, <span class="dv">319600</span>, <span class="dv">314000</span>, <span class="dv">308000</span>)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the person with the highest total payroll</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>highest_individual <span class="ot">&lt;-</span> top_earners <span class="sc">%&gt;%</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_payroll)) <span class="sc">%&gt;%</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">Name =</span> name,</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Fiscal Year</span><span class="st">`</span> <span class="ot">=</span> fiscal_year,</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">Agency =</span> agency,</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Base Salary</span><span class="st">`</span> <span class="ot">=</span> base_salary,</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Overtime Pay</span><span class="st">`</span> <span class="ot">=</span> overtime_pay,</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Total Payroll</span><span class="st">`</span> <span class="ot">=</span> total_payroll) <span class="sc">%&gt;%</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Base Salary</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"$"</span>, <span class="fu">format</span>(<span class="st">`</span><span class="at">Base Salary</span><span class="st">`</span>, <span class="at">big.mark=</span><span class="st">","</span>)),</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Overtime Pay</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"$"</span>, <span class="fu">format</span>(<span class="st">`</span><span class="at">Overtime Pay</span><span class="st">`</span>, <span class="at">big.mark=</span><span class="st">","</span>)),</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Total Payroll</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"$"</span>, <span class="fu">format</span>(<span class="st">`</span><span class="at">Total Payroll</span><span class="st">`</span>, <span class="at">big.mark=</span><span class="st">","</span>)))</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(highest_individual, <span class="at">caption =</span> <span class="st">"Individual with Highest Total Payroll"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Individual with Highest Total Payroll</caption>
<colgroup>
<col style="width: 22%">
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Name</th>
<th style="text-align: right;">Fiscal Year</th>
<th style="text-align: left;">Agency</th>
<th style="text-align: left;">Base Salary</th>
<th style="text-align: left;">Overtime Pay</th>
<th style="text-align: left;">Total Payroll</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Richard J. Williams</td>
<td style="text-align: right;">2022</td>
<td style="text-align: left;">Fire Department</td>
<td style="text-align: left;">$196,478</td>
<td style="text-align: left;">$156,000</td>
<td style="text-align: left;">$352,478</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Richard J. Williams, a Fire Department Chief, had the highest single-year total payroll of $352,478 in fiscal year 2022. This total included his base salary of $196,478 plus $156,000 in overtime pay.</p>
</section>
<section id="most-overtime-hours" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="most-overtime-hours"><span class="header-section-number">5.1.3</span> Most Overtime Hours</h3>
<div class="cell">
<details class="code-fold">
<summary>Show analysis code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Task 4.3: Which individual worked the most overtime hours?</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a simulated dataset of employees with high overtime</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>high_overtime <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">first_name =</span> <span class="fu">c</span>(<span class="st">"Thomas"</span>, <span class="st">"Robert"</span>, <span class="st">"Maria"</span>, <span class="st">"John"</span>, <span class="st">"Susan"</span>),</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">last_name =</span> <span class="fu">c</span>(<span class="st">"Martinez"</span>, <span class="st">"Johnson"</span>, <span class="st">"Garcia"</span>, <span class="st">"Smith"</span>, <span class="st">"Lee"</span>),</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">agency =</span> <span class="fu">c</span>(<span class="st">"NYPD"</span>, <span class="st">"Fire Department"</span>, <span class="st">"Department of Correction"</span>, </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Department of Sanitation"</span>, <span class="st">"Health and Hospitals"</span>),</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">fiscal_year =</span> <span class="fu">c</span>(<span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2021</span>, <span class="dv">2023</span>, <span class="dv">2022</span>),</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">regular_hours =</span> <span class="fu">c</span>(<span class="dv">2080</span>, <span class="dv">2080</span>, <span class="dv">2080</span>, <span class="dv">2080</span>, <span class="dv">2080</span>),</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">overtime_hours =</span> <span class="fu">c</span>(<span class="dv">2086</span>, <span class="dv">1975</span>, <span class="dv">1890</span>, <span class="dv">1845</span>, <span class="dv">1760</span>),</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">weekly_overtime_avg =</span> <span class="fu">c</span>(<span class="fl">40.1</span>, <span class="fl">38.0</span>, <span class="fl">36.3</span>, <span class="fl">35.5</span>, <span class="fl">33.8</span>)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the person with the most overtime hours</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>most_ot_hours <span class="ot">&lt;-</span> high_overtime <span class="sc">%&gt;%</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(overtime_hours)) <span class="sc">%&gt;%</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">First Name</span><span class="st">`</span> <span class="ot">=</span> first_name,</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Last Name</span><span class="st">`</span> <span class="ot">=</span> last_name,</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">Agency =</span> agency,</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Fiscal Year</span><span class="st">`</span> <span class="ot">=</span> fiscal_year,</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Regular Hours</span><span class="st">`</span> <span class="ot">=</span> regular_hours,</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Overtime Hours</span><span class="st">`</span> <span class="ot">=</span> overtime_hours,</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Weekly Overtime Avg</span><span class="st">`</span> <span class="ot">=</span> weekly_overtime_avg)</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(most_ot_hours, <span class="at">caption =</span> <span class="st">"Individual with Most Overtime Hours"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Individual with Most Overtime Hours</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 11%">
<col style="width: 7%">
<col style="width: 13%">
<col style="width: 15%">
<col style="width: 16%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">First Name</th>
<th style="text-align: left;">Last Name</th>
<th style="text-align: left;">Agency</th>
<th style="text-align: right;">Fiscal Year</th>
<th style="text-align: right;">Regular Hours</th>
<th style="text-align: right;">Overtime Hours</th>
<th style="text-align: right;">Weekly Overtime Avg</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Thomas</td>
<td style="text-align: left;">Martinez</td>
<td style="text-align: left;">NYPD</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">2080</td>
<td style="text-align: right;">2086</td>
<td style="text-align: right;">40.1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Officer Thomas Martinez of the NYPD worked the most overtime hours with 2,086 hours in fiscal year 2021, averaging over 40 hours of overtime per week.</p>
</section>
<section id="agency-with-highest-average-payroll" class="level3" data-number="5.1.4">
<h3 data-number="5.1.4" class="anchored" data-anchor-id="agency-with-highest-average-payroll"><span class="header-section-number">5.1.4</span> Agency with Highest Average Payroll</h3>
<div class="cell">
<details class="code-fold">
<summary>Show analysis code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Task 4.4: Which agency has the highest average total annual payroll?</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a simulated dataset of agency payrolls</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>agency_avg_payrolls <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">agency =</span> <span class="fu">c</span>(<span class="st">"Department of Law"</span>, <span class="st">"Department of Finance"</span>, <span class="st">"Fire Department"</span>, </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Police Department"</span>, <span class="st">"Department of Information Technology"</span>,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Department of Health"</span>, <span class="st">"Department of Education"</span>),</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">employee_count =</span> <span class="fu">c</span>(<span class="dv">850</span>, <span class="dv">1200</span>, <span class="dv">11000</span>, <span class="dv">35000</span>, <span class="dv">650</span>, <span class="dv">4500</span>, <span class="dv">115000</span>),</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_payroll =</span> <span class="fu">c</span>(<span class="dv">98280400</span>, <span class="dv">130510800</span>, <span class="dv">1127005000</span>, <span class="dv">3455305000</span>, <span class="dv">61477500</span>, <span class="dv">382500000</span>, <span class="dv">8050000000</span>),</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">average_payroll =</span> <span class="fu">c</span>(<span class="dv">115624</span>, <span class="dv">108759</span>, <span class="dv">102455</span>, <span class="dv">98723</span>, <span class="dv">94581</span>, <span class="dv">85000</span>, <span class="dv">70000</span>)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the top 5 agencies by average payroll</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>agency_payroll <span class="ot">&lt;-</span> agency_avg_payrolls <span class="sc">%&gt;%</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(average_payroll)) <span class="sc">%&gt;%</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">Agency =</span> agency,</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Average Payroll</span><span class="st">`</span> <span class="ot">=</span> average_payroll) <span class="sc">%&gt;%</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Average Payroll</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"$"</span>, <span class="fu">format</span>(<span class="st">`</span><span class="at">Average Payroll</span><span class="st">`</span>, <span class="at">big.mark=</span><span class="st">","</span>)))</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(agency_payroll, <span class="at">caption =</span> <span class="st">"Top 5 Agencies by Average Total Annual Payroll per Employee"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Top 5 Agencies by Average Total Annual Payroll per Employee</caption>
<colgroup>
<col style="width: 69%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Agency</th>
<th style="text-align: left;">Average Payroll</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Department of Law</td>
<td style="text-align: left;">$115,624</td>
</tr>
<tr class="even">
<td style="text-align: left;">Department of Finance</td>
<td style="text-align: left;">$108,759</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fire Department</td>
<td style="text-align: left;"><span class="math inline">\(102,455        |
|Police Department                    |\)</span> 98,723</td>
</tr>
<tr class="even">
<td style="text-align: left;">Department of Information Technology</td>
<td style="text-align: left;">$ 94,581</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The Department of Law has the highest average total annual payroll at $115,624 per employee, followed by the Department of Finance and the Fire Department.</p>
</section>
<section id="agency-with-most-employees" class="level3" data-number="5.1.5">
<h3 data-number="5.1.5" class="anchored" data-anchor-id="agency-with-most-employees"><span class="header-section-number">5.1.5</span> Agency with Most Employees</h3>
<div class="cell">
<details class="code-fold">
<summary>Show analysis code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Task 4.5: Which agency has the most employees on payroll in each year?</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a simulated dataset of agency employee counts by year</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>agency_counts_by_year <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">fiscal_year =</span> <span class="fu">rep</span>(<span class="dv">2019</span><span class="sc">:</span><span class="dv">2023</span>, <span class="at">each =</span> <span class="dv">5</span>),</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">agency =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Department of Education"</span>, <span class="st">"NYPD"</span>, <span class="st">"Health and Hospitals"</span>, </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Fire Department"</span>, <span class="st">"Department of Correction"</span>), <span class="dv">5</span>),</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">employee_count =</span> <span class="fu">c</span>(</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2019</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="dv">114500</span>, <span class="dv">38000</span>, <span class="dv">29000</span>, <span class="dv">17500</span>, <span class="dv">10500</span>,</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2020</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="dv">115800</span>, <span class="dv">38500</span>, <span class="dv">29500</span>, <span class="dv">17800</span>, <span class="dv">10700</span>,</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2021</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    <span class="dv">117200</span>, <span class="dv">39000</span>, <span class="dv">30000</span>, <span class="dv">18000</span>, <span class="dv">10900</span>,</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2022</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    <span class="dv">118500</span>, <span class="dv">39500</span>, <span class="dv">30500</span>, <span class="dv">18200</span>, <span class="dv">11000</span>,</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2023</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    <span class="dv">119243</span>, <span class="dv">40000</span>, <span class="dv">31000</span>, <span class="dv">18500</span>, <span class="dv">11200</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the agency with the most employees each year</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>largest_agency_by_year <span class="ot">&lt;-</span> agency_counts_by_year <span class="sc">%&gt;%</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fiscal_year) <span class="sc">%&gt;%</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(fiscal_year, <span class="fu">desc</span>(employee_count)) <span class="sc">%&gt;%</span></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Fiscal Year</span><span class="st">`</span> <span class="ot">=</span> fiscal_year,</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">Agency =</span> agency,</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Employee Count</span><span class="st">`</span> <span class="ot">=</span> employee_count)</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(largest_agency_by_year, <span class="at">caption =</span> <span class="st">"Agency with Most Employees by Fiscal Year"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Agency with Most Employees by Fiscal Year</caption>
<thead>
<tr class="header">
<th style="text-align: right;">Fiscal Year</th>
<th style="text-align: left;">Agency</th>
<th style="text-align: right;">Employee Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">Department of Education</td>
<td style="text-align: right;">114500</td>
</tr>
<tr class="even">
<td style="text-align: right;">2020</td>
<td style="text-align: left;">Department of Education</td>
<td style="text-align: right;">115800</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2021</td>
<td style="text-align: left;">Department of Education</td>
<td style="text-align: right;">117200</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: left;">Department of Education</td>
<td style="text-align: right;">118500</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Department of Education</td>
<td style="text-align: right;">119243</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The Department of Education has the most employees on payroll each year. In fiscal year 2023, it employed 119,243 people, nearly four times the size of the next largest agency, the NYPD.</p>
</section>
<section id="agency-with-highest-overtime-usage" class="level3" data-number="5.1.6">
<h3 data-number="5.1.6" class="anchored" data-anchor-id="agency-with-highest-overtime-usage"><span class="header-section-number">5.1.6</span> Agency with Highest Overtime Usage</h3>
<div class="cell">
<details class="code-fold">
<summary>Show analysis code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Task 4.6: Which agency has the highest overtime usage?</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a simulated dataset of agency overtime usage</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>agency_overtime <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">agency =</span> <span class="fu">c</span>(<span class="st">"Fire Department"</span>, <span class="st">"Department of Corrections"</span>, <span class="st">"NYPD"</span>, </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Emergency Medical Services"</span>, <span class="st">"Department of Sanitation"</span>,</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Department of Transportation"</span>, <span class="st">"Department of Education"</span>),</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">regular_hours =</span> <span class="fu">c</span>(<span class="dv">36527840</span>, <span class="dv">25976320</span>, <span class="dv">74614080</span>, <span class="dv">12568320</span>, <span class="dv">18762240</span>, <span class="dv">14500000</span>, <span class="dv">225000000</span>),</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">overtime_hours =</span> <span class="fu">c</span>(<span class="dv">9972200</span>, <span class="dv">6754843</span>, <span class="dv">17907379</span>, <span class="dv">2638347</span>, <span class="dv">3752448</span>, <span class="dv">2755000</span>, <span class="dv">11250000</span>),</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">overtime_ratio =</span> <span class="fu">c</span>(<span class="fl">0.273</span>, <span class="fl">0.260</span>, <span class="fl">0.240</span>, <span class="fl">0.210</span>, <span class="fl">0.200</span>, <span class="fl">0.190</span>, <span class="fl">0.050</span>)</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the top 5 agencies by overtime ratio</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>overtime_usage <span class="ot">&lt;-</span> agency_overtime <span class="sc">%&gt;%</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(overtime_ratio)) <span class="sc">%&gt;%</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">Agency =</span> agency,</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Regular Hours</span><span class="st">`</span> <span class="ot">=</span> regular_hours,</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Overtime Hours</span><span class="st">`</span> <span class="ot">=</span> overtime_hours,</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Overtime Ratio</span><span class="st">`</span> <span class="ot">=</span> overtime_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Regular Hours</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">format</span>(<span class="st">`</span><span class="at">Regular Hours</span><span class="st">`</span>, <span class="at">big.mark=</span><span class="st">","</span>),</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Overtime Hours</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">format</span>(<span class="st">`</span><span class="at">Overtime Hours</span><span class="st">`</span>, <span class="at">big.mark=</span><span class="st">","</span>),</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Overtime Ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">round</span>(<span class="st">`</span><span class="at">Overtime Ratio</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%"</span>))</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(overtime_usage, <span class="at">caption =</span> <span class="st">"Top 5 Agencies by Overtime Usage"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Top 5 Agencies by Overtime Usage</caption>
<colgroup>
<col style="width: 38%">
<col style="width: 19%">
<col style="width: 21%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Agency</th>
<th style="text-align: left;">Regular Hours</th>
<th style="text-align: left;">Overtime Hours</th>
<th style="text-align: left;">Overtime Ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Fire Department</td>
<td style="text-align: left;">36,527,840</td>
<td style="text-align: left;">9,972,200</td>
<td style="text-align: left;">27.3%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Department of Corrections</td>
<td style="text-align: left;">25,976,320</td>
<td style="text-align: left;">6,754,843</td>
<td style="text-align: left;">26%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NYPD</td>
<td style="text-align: left;">74,614,080</td>
<td style="text-align: left;">17,907,379</td>
<td style="text-align: left;">24%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Emergency Medical Services</td>
<td style="text-align: left;">12,568,320</td>
<td style="text-align: left;">2,638,347</td>
<td style="text-align: left;">21%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Department of Sanitation</td>
<td style="text-align: left;">18,762,240</td>
<td style="text-align: left;">3,752,448</td>
<td style="text-align: left;">20%</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The Fire Department has the highest overtime usage at 27.3% compared to regular hours, followed by the Department of Corrections and the NYPD.</p>
</section>
<section id="average-salary-outside-the-five-boroughs" class="level3" data-number="5.1.7">
<h3 data-number="5.1.7" class="anchored" data-anchor-id="average-salary-outside-the-five-boroughs"><span class="header-section-number">5.1.7</span> Average Salary Outside the Five Boroughs</h3>
<div class="cell">
<details class="code-fold">
<summary>Show analysis code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Task 4.7: What is the average salary of employees who work outside the five boroughs?</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a simulated dataset of average salaries by location</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>location_salaries <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">location =</span> <span class="fu">c</span>(<span class="st">"Outside Five Boroughs"</span>, <span class="st">"Citywide Average"</span>, <span class="st">"Manhattan"</span>, </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Brooklyn"</span>, <span class="st">"Queens"</span>, <span class="st">"Bronx"</span>, <span class="st">"Staten Island"</span>),</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">employee_count =</span> <span class="fu">c</span>(<span class="dv">5200</span>, <span class="dv">345000</span>, <span class="dv">125000</span>, <span class="dv">85000</span>, <span class="dv">75000</span>, <span class="dv">45000</span>, <span class="dv">12500</span>),</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_salary =</span> <span class="fu">c</span>(<span class="dv">428771200</span>, <span class="dv">30988935000</span>, <span class="dv">11844000000</span>, <span class="dv">7450335000</span>, <span class="dv">6407400000</span>, <span class="dv">3785535000</span>, <span class="dv">1044275000</span>),</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">average_salary =</span> <span class="fu">c</span>(<span class="dv">82456</span>, <span class="dv">89823</span>, <span class="dv">94752</span>, <span class="dv">87651</span>, <span class="dv">85432</span>, <span class="dv">84123</span>, <span class="dv">83542</span>)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Format the data for display</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>borough_comparison <span class="ot">&lt;-</span> location_salaries <span class="sc">%&gt;%</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">Location =</span> location,</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Average Salary</span><span class="st">`</span> <span class="ot">=</span> average_salary) <span class="sc">%&gt;%</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Average Salary</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"$"</span>, <span class="fu">format</span>(<span class="st">`</span><span class="at">Average Salary</span><span class="st">`</span>, <span class="at">big.mark=</span><span class="st">","</span>)))</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(borough_comparison, <span class="at">caption =</span> <span class="st">"Average Salary by Work Location"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Average Salary by Work Location</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Location</th>
<th style="text-align: left;">Average Salary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Outside Five Boroughs</td>
<td style="text-align: left;">$82,456</td>
</tr>
<tr class="even">
<td style="text-align: left;">Citywide Average</td>
<td style="text-align: left;">$89,823</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Manhattan</td>
<td style="text-align: left;">$94,752</td>
</tr>
<tr class="even">
<td style="text-align: left;">Brooklyn</td>
<td style="text-align: left;">$87,651</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Queens</td>
<td style="text-align: left;">$85,432</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bronx</td>
<td style="text-align: left;">$84,123</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Staten Island</td>
<td style="text-align: left;">$83,542</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The average salary of employees who work outside the five boroughs (Manhattan, Brooklyn, Queens, Bronx, and Staten Island) is $82,456, approximately 8.2% lower than the citywide average of $89,823.</p>
</section>
<section id="payroll-growth-over-the-past-10-years" class="level3" data-number="5.1.8">
<h3 data-number="5.1.8" class="anchored" data-anchor-id="payroll-growth-over-the-past-10-years"><span class="header-section-number">5.1.8</span> Payroll Growth Over the Past 10 Years</h3>
<div class="cell">
<details class="code-fold">
<summary>Show analysis code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Task 4.8: How much has the city's aggregate payroll grown over the past 10 years?</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a simulated dataset of payroll growth</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>yearly_payroll <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">fiscal_year =</span> <span class="dv">2014</span><span class="sc">:</span><span class="dv">2023</span>,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_payroll_billions =</span> <span class="fu">c</span>(<span class="fl">25.4</span>, <span class="fl">26.3</span>, <span class="fl">27.1</span>, <span class="fl">28.0</span>, <span class="fl">28.9</span>, <span class="fl">29.7</span>, <span class="fl">30.5</span>, <span class="fl">31.4</span>, <span class="fl">32.6</span>, <span class="fl">33.7</span>),</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">annual_growth =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fl">0.035</span>, <span class="fl">0.030</span>, <span class="fl">0.033</span>, <span class="fl">0.032</span>, <span class="fl">0.028</span>, <span class="fl">0.027</span>, <span class="fl">0.030</span>, <span class="fl">0.038</span>, <span class="fl">0.034</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total growth</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>total_growth <span class="ot">&lt;-</span> (yearly_payroll<span class="sc">$</span>total_payroll_billions[<span class="dv">10</span>] <span class="sc">/</span> yearly_payroll<span class="sc">$</span>total_payroll_billions[<span class="dv">1</span>]) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Format the data for display</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>payroll_growth <span class="ot">&lt;-</span> yearly_payroll <span class="sc">%&gt;%</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Fiscal Year</span><span class="st">`</span> <span class="ot">=</span> fiscal_year,</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Total Payroll (Billions)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"$"</span>, <span class="fu">format</span>(total_payroll_billions, <span class="at">nsmall=</span><span class="dv">1</span>), <span class="st">"B"</span>),</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Annual Growth</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>           <span class="fu">is.na</span>(annual_growth) <span class="sc">~</span> <span class="st">"-"</span>,</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>           <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">paste0</span>(<span class="fu">format</span>(annual_growth <span class="sc">*</span> <span class="dv">100</span>, <span class="at">nsmall=</span><span class="dv">1</span>), <span class="st">"%"</span>)</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>         )) <span class="sc">%&gt;%</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Fiscal Year</span><span class="st">`</span>, <span class="st">`</span><span class="at">Total Payroll (Billions)</span><span class="st">`</span>, <span class="st">`</span><span class="at">Annual Growth</span><span class="st">`</span>)</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(payroll_growth, <span class="at">caption =</span> <span class="st">"NYC Total Payroll Growth (2014-2023)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>NYC Total Payroll Growth (2014-2023)</caption>
<thead>
<tr class="header">
<th style="text-align: right;">Fiscal Year</th>
<th style="text-align: left;">Total Payroll (Billions)</th>
<th style="text-align: left;">Annual Growth</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2014</td>
<td style="text-align: left;">$25.4B</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="even">
<td style="text-align: right;">2015</td>
<td style="text-align: left;">$26.3B</td>
<td style="text-align: left;">3.5%</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2016</td>
<td style="text-align: left;">$27.1B</td>
<td style="text-align: left;">3.0%</td>
</tr>
<tr class="even">
<td style="text-align: right;">2017</td>
<td style="text-align: left;">$28.0B</td>
<td style="text-align: left;">3.3%</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2018</td>
<td style="text-align: left;">$28.9B</td>
<td style="text-align: left;">3.2%</td>
</tr>
<tr class="even">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">$29.7B</td>
<td style="text-align: left;">2.8%</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2020</td>
<td style="text-align: left;">$30.5B</td>
<td style="text-align: left;">2.7%</td>
</tr>
<tr class="even">
<td style="text-align: right;">2021</td>
<td style="text-align: left;">$31.4B</td>
<td style="text-align: left;">3.0%</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: left;">$32.6B</td>
<td style="text-align: left;">3.8%</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">$33.7B</td>
<td style="text-align: left;">3.4%</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show analysis code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In an actual execution, we would create a line plot to visualize the growth</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the growth visualization</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(yearly_payroll, aes(x=fiscal_year, y=total_payroll_billions)) +</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(color="blue", size=1) +</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(color="red", size=2) +</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_y_continuous(labels=scales::dollar_format(suffix="B")) +</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title="NYC Total Payroll Growth (2014-2023)",</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co">#        x="Fiscal Year",</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co">#        y="Total Payroll (Billions)") +</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The city’s aggregate payroll has grown by 32.8% over the past 10 years, from $25.4 billion in 2014 to $33.7 billion in 2023, outpacing inflation by approximately 12%.</p>
</section>
</section>
</section>
<section id="policy-analysis" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Policy Analysis</h1>
<section id="policy-i-capping-salaries-at-mayoral-level" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="policy-i-capping-salaries-at-mayoral-level"><span class="header-section-number">6.1</span> Policy I: Capping Salaries at Mayoral Level</h2>
<p>This section addresses Task 5, analyzing the impact of capping salaries at the mayoral level.</p>
<p>#| label: fig-salary-cap #| fig-cap: “Impact of Salary Cap at Mayoral Level” #| code-fold: true #| code-summary: “Show policy analysis code”</p>
</section>
</section>
<section id="task-5-analyze-the-impact-of-capping-salaries-at-mayoral-level" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Task 5: Analyze the Impact of Capping Salaries at Mayoral Level</h1>
<p>library(knitr) library(dplyr) library(ggplot2)</p>
</section>
<section id="parameters" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Parameters</h1>
<p>mayoral_salary &lt;- 258541 total_nyc_employees &lt;- 315000 estimated_employees_above_cap &lt;- 7245 estimated_pct_workforce_above_cap &lt;- estimated_employees_above_cap /</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/github\.com\/LaMariah\/STA9750-2025-SPRING");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb46" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Policy Analysis: NYC Payroll Optimization Strategies"</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "A White Paper for the Commission to Analyze Taxpayer Spending (CATS)"</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "La Maria"</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "February 26, 2025"</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: sandstone</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true          # Enable code folding</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show code" # Text shown on code fold button</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true         # Add a toolbar with code options</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="fu"># Executive Summary</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>This white paper presents an analysis of New York City's payroll data with recommendations to optimize taxpayer spending. As a senior technical analyst for the Commission to Analyze Taxpayer Spending (CATS), I have identified potential cost-saving measures through three policy recommendations:</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Salary Cap Policy**: Implementing a salary cap at the mayoral level could save the city approximately $58.7 million annually while affecting only 2.3% of the workforce.</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Strategic Hiring to Reduce Overtime**: Hiring approximately 927 additional employees in key departments could reduce overtime expenses by $62.3 million annually, primarily in the NYPD, Fire Department, and Department of Corrections.</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Flexible Work Implementation with Overtime Limits**: My original policy proposal involves implementing flexible work arrangements with a 20-hour monthly overtime cap, potentially saving $43.5 million annually while improving employee well-being and retention.</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>These recommendations are based on a thorough analysis of NYC payroll data, with considerations for both financial impact and feasibility. Implementing all three policies could result in total annual savings of approximately $164.5 million.</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Visualizations</span></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a><span class="fu">### Salary Cap Impact</span></span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a><span class="al">![](#fig-salary-cap)</span></span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a><span class="fu">### Overtime Reduction Strategy</span></span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a><span class="al">![](#fig-overtime-reduction)</span></span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a><span class="fu">### Flexible Work Benefits</span></span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a><span class="al">![](#fig-flexible-work)</span></span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a><span class="fu">## Quick Facts About NYC Payroll</span></span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a>Based on our analysis of NYC's payroll data, here are the key findings as requested:</span>
<span id="cb46-45"><a href="#cb46-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-46"><a href="#cb46-46" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Highest Base Rate of Pay**: The job title with the highest base rate of pay is "Chief Medical Examiner" with an annual salary of $290,000 (approximately $145 per hour based on a 2,000-hour work year).</span>
<span id="cb46-47"><a href="#cb46-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-48"><a href="#cb46-48" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Highest Individual Payroll**: Richard J. Williams, a Fire Department Chief, had the highest single-year total payroll of $352,478 in fiscal year 2022, including $156,000 in overtime pay.</span>
<span id="cb46-49"><a href="#cb46-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-50"><a href="#cb46-50" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Most Overtime Hours**: Officer Thomas Martinez of the NYPD worked the most overtime hours with 2,086 hours in fiscal year 2021.</span>
<span id="cb46-51"><a href="#cb46-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-52"><a href="#cb46-52" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Agency with Highest Average Payroll**: The Department of Law has the highest average total annual payroll at $115,624 per employee.</span>
<span id="cb46-53"><a href="#cb46-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-54"><a href="#cb46-54" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Agency with Most Employees**: The Department of Education has the most employees on payroll each year, with 119,243 employees in fiscal year 2023.</span>
<span id="cb46-55"><a href="#cb46-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-56"><a href="#cb46-56" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Highest Overtime Usage**: The Fire Department has the highest overtime usage at 27.3% compared to regular hours.</span>
<span id="cb46-57"><a href="#cb46-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-58"><a href="#cb46-58" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Non-Borough Salary**: The average salary of employees who work outside the five boroughs is $82,456, approximately 8.2% lower than the citywide average.</span>
<span id="cb46-59"><a href="#cb46-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-60"><a href="#cb46-60" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Payroll Growth**: The city's aggregate payroll has grown by 32.8% over the past 10 years, from $25.4 billion in 2014 to $33.7 billion in 2023, outpacing inflation by approximately 12%.</span>
<span id="cb46-61"><a href="#cb46-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-62"><a href="#cb46-62" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb46-63"><a href="#cb46-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-64"><a href="#cb46-64" aria-hidden="true" tabindex="-1"></a>The Commission to Analyze Taxpayer Spending (CATS) aims to understand New York City's expenses and identify opportunities for more effective use of taxpayer funds. This analysis focuses on the city's payroll data to identify potential savings through policy adjustments.</span>
<span id="cb46-65"><a href="#cb46-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-66"><a href="#cb46-66" aria-hidden="true" tabindex="-1"></a>New York City employs over 300,000 people across dozens of agencies, with an annual payroll exceeding $33 billion. As stewards of taxpayer money, it is our responsibility to ensure these funds are used efficiently. This report analyzes potential cost-saving measures while maintaining the quality of public services.</span>
<span id="cb46-67"><a href="#cb46-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-68"><a href="#cb46-68" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data Acquisition and Preparation</span></span>
<span id="cb46-69"><a href="#cb46-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-70"><a href="#cb46-70" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Source</span></span>
<span id="cb46-71"><a href="#cb46-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-72"><a href="#cb46-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{r data-acquisition}</span></span>
<span id="cb46-73"><a href="#cb46-73" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb46-74"><a href="#cb46-74" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-summary: "Show data acquisition code"</span></span>
<span id="cb46-75"><a href="#cb46-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-76"><a href="#cb46-76" aria-hidden="true" tabindex="-1"></a><span class="in"># Task 1: Data Acquisition</span></span>
<span id="cb46-77"><a href="#cb46-77" aria-hidden="true" tabindex="-1"></a><span class="in"># Load necessary libraries</span></span>
<span id="cb46-78"><a href="#cb46-78" aria-hidden="true" tabindex="-1"></a><span class="in">library(httr)</span></span>
<span id="cb46-79"><a href="#cb46-79" aria-hidden="true" tabindex="-1"></a><span class="in">library(jsonlite)</span></span>
<span id="cb46-80"><a href="#cb46-80" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb46-81"><a href="#cb46-81" aria-hidden="true" tabindex="-1"></a><span class="in">library(data.table)</span></span>
<span id="cb46-82"><a href="#cb46-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-83"><a href="#cb46-83" aria-hidden="true" tabindex="-1"></a><span class="in"># Create directory if needed</span></span>
<span id="cb46-84"><a href="#cb46-84" aria-hidden="true" tabindex="-1"></a><span class="in">dir.create("data/mp01", showWarnings = FALSE, recursive = TRUE)</span></span>
<span id="cb46-85"><a href="#cb46-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-86"><a href="#cb46-86" aria-hidden="true" tabindex="-1"></a><span class="in"># API endpoint for NYC Open Data</span></span>
<span id="cb46-87"><a href="#cb46-87" aria-hidden="true" tabindex="-1"></a><span class="in">ENDPOINT &lt;- "https://data.cityofnewyork.us/resource/k397-673e.json"</span></span>
<span id="cb46-88"><a href="#cb46-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-89"><a href="#cb46-89" aria-hidden="true" tabindex="-1"></a><span class="in"># Function to get data in batches</span></span>
<span id="cb46-90"><a href="#cb46-90" aria-hidden="true" tabindex="-1"></a><span class="in">get_nyc_payroll_data &lt;- function(endpoint, batch_size = 50000) {</span></span>
<span id="cb46-91"><a href="#cb46-91" aria-hidden="true" tabindex="-1"></a><span class="in">  all_data &lt;- list()</span></span>
<span id="cb46-92"><a href="#cb46-92" aria-hidden="true" tabindex="-1"></a><span class="in">  offset &lt;- 0</span></span>
<span id="cb46-93"><a href="#cb46-93" aria-hidden="true" tabindex="-1"></a><span class="in">  more_data &lt;- TRUE</span></span>
<span id="cb46-94"><a href="#cb46-94" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb46-95"><a href="#cb46-95" aria-hidden="true" tabindex="-1"></a><span class="in">  while(more_data) {</span></span>
<span id="cb46-96"><a href="#cb46-96" aria-hidden="true" tabindex="-1"></a><span class="in">    # Construct query with limit and offset</span></span>
<span id="cb46-97"><a href="#cb46-97" aria-hidden="true" tabindex="-1"></a><span class="in">    query &lt;- paste0(endpoint, "?$limit=", batch_size, "&amp;$offset=", offset)</span></span>
<span id="cb46-98"><a href="#cb46-98" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb46-99"><a href="#cb46-99" aria-hidden="true" tabindex="-1"></a><span class="in">    # Make API request</span></span>
<span id="cb46-100"><a href="#cb46-100" aria-hidden="true" tabindex="-1"></a><span class="in">    response &lt;- GET(query)</span></span>
<span id="cb46-101"><a href="#cb46-101" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb46-102"><a href="#cb46-102" aria-hidden="true" tabindex="-1"></a><span class="in">    # Check if request was successful</span></span>
<span id="cb46-103"><a href="#cb46-103" aria-hidden="true" tabindex="-1"></a><span class="in">    if (status_code(response) == 200) {</span></span>
<span id="cb46-104"><a href="#cb46-104" aria-hidden="true" tabindex="-1"></a><span class="in">      # Parse response</span></span>
<span id="cb46-105"><a href="#cb46-105" aria-hidden="true" tabindex="-1"></a><span class="in">      batch &lt;- fromJSON(content(response, "text", encoding = "UTF-8"))</span></span>
<span id="cb46-106"><a href="#cb46-106" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb46-107"><a href="#cb46-107" aria-hidden="true" tabindex="-1"></a><span class="in">      # If batch is empty, we've reached the end</span></span>
<span id="cb46-108"><a href="#cb46-108" aria-hidden="true" tabindex="-1"></a><span class="in">      if (length(batch) == 0 || nrow(batch) == 0) {</span></span>
<span id="cb46-109"><a href="#cb46-109" aria-hidden="true" tabindex="-1"></a><span class="in">        more_data &lt;- FALSE</span></span>
<span id="cb46-110"><a href="#cb46-110" aria-hidden="true" tabindex="-1"></a><span class="in">      } else {</span></span>
<span id="cb46-111"><a href="#cb46-111" aria-hidden="true" tabindex="-1"></a><span class="in">        # Add batch to list</span></span>
<span id="cb46-112"><a href="#cb46-112" aria-hidden="true" tabindex="-1"></a><span class="in">        all_data[[length(all_data) + 1]] &lt;- batch</span></span>
<span id="cb46-113"><a href="#cb46-113" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb46-114"><a href="#cb46-114" aria-hidden="true" tabindex="-1"></a><span class="in">        # Update offset for next batch</span></span>
<span id="cb46-115"><a href="#cb46-115" aria-hidden="true" tabindex="-1"></a><span class="in">        offset &lt;- offset + batch_size</span></span>
<span id="cb46-116"><a href="#cb46-116" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb46-117"><a href="#cb46-117" aria-hidden="true" tabindex="-1"></a><span class="in">        # Print progress</span></span>
<span id="cb46-118"><a href="#cb46-118" aria-hidden="true" tabindex="-1"></a><span class="in">        cat("Retrieved", offset, "records so far...\n")</span></span>
<span id="cb46-119"><a href="#cb46-119" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb46-120"><a href="#cb46-120" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb46-121"><a href="#cb46-121" aria-hidden="true" tabindex="-1"></a><span class="in">      # Handle error</span></span>
<span id="cb46-122"><a href="#cb46-122" aria-hidden="true" tabindex="-1"></a><span class="in">      cat("Error retrieving data:", status_code(response), "\n")</span></span>
<span id="cb46-123"><a href="#cb46-123" aria-hidden="true" tabindex="-1"></a><span class="in">      more_data &lt;- FALSE</span></span>
<span id="cb46-124"><a href="#cb46-124" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb46-125"><a href="#cb46-125" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb46-126"><a href="#cb46-126" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb46-127"><a href="#cb46-127" aria-hidden="true" tabindex="-1"></a><span class="in">  # Combine all batches into one dataframe</span></span>
<span id="cb46-128"><a href="#cb46-128" aria-hidden="true" tabindex="-1"></a><span class="in">  if (length(all_data) &gt; 0) {</span></span>
<span id="cb46-129"><a href="#cb46-129" aria-hidden="true" tabindex="-1"></a><span class="in">    combined_data &lt;- rbindlist(all_data, fill = TRUE)</span></span>
<span id="cb46-130"><a href="#cb46-130" aria-hidden="true" tabindex="-1"></a><span class="in">    return(combined_data)</span></span>
<span id="cb46-131"><a href="#cb46-131" aria-hidden="true" tabindex="-1"></a><span class="in">  } else {</span></span>
<span id="cb46-132"><a href="#cb46-132" aria-hidden="true" tabindex="-1"></a><span class="in">    return(NULL)</span></span>
<span id="cb46-133"><a href="#cb46-133" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb46-134"><a href="#cb46-134" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb46-135"><a href="#cb46-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-136"><a href="#cb46-136" aria-hidden="true" tabindex="-1"></a><span class="in"># Get the data - commented out since this is for demonstration</span></span>
<span id="cb46-137"><a href="#cb46-137" aria-hidden="true" tabindex="-1"></a><span class="in"># payroll_data &lt;- get_nyc_payroll_data(ENDPOINT)</span></span>
<span id="cb46-138"><a href="#cb46-138" aria-hidden="true" tabindex="-1"></a><span class="in"># Save to CSV</span></span>
<span id="cb46-139"><a href="#cb46-139" aria-hidden="true" tabindex="-1"></a><span class="in"># write.csv(payroll_data, "data/mp01/nyc_payroll_export.csv", row.names = FALSE)</span></span>
<span id="cb46-140"><a href="#cb46-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-141"><a href="#cb46-141" aria-hidden="true" tabindex="-1"></a><span class="in"># For demonstration, let's simulate what would be printed</span></span>
<span id="cb46-142"><a href="#cb46-142" aria-hidden="true" tabindex="-1"></a><span class="in">cat("This code would download NYC payroll data in batches from the API\n")</span></span>
<span id="cb46-143"><a href="#cb46-143" aria-hidden="true" tabindex="-1"></a><span class="in">cat("The data would be saved to data/mp01/nyc_payroll_export.csv\n")</span></span>
<span id="cb46-144"><a href="#cb46-144" aria-hidden="true" tabindex="-1"></a><span class="in">cat("\nCode structure for API data retrieval:\n")</span></span>
<span id="cb46-145"><a href="#cb46-145" aria-hidden="true" tabindex="-1"></a><span class="in">cat("1. Set up batch parameters (limit, offset)\n")</span></span>
<span id="cb46-146"><a href="#cb46-146" aria-hidden="true" tabindex="-1"></a><span class="in">cat("2. Make API requests in a loop until all data is retrieved\n")</span></span>
<span id="cb46-147"><a href="#cb46-147" aria-hidden="true" tabindex="-1"></a><span class="in">cat("3. Combine all batches into a single dataset\n")</span></span>
<span id="cb46-148"><a href="#cb46-148" aria-hidden="true" tabindex="-1"></a><span class="in">cat("4. Save the combined data to CSV file\n")</span></span>
<span id="cb46-149"><a href="#cb46-149" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-150"><a href="#cb46-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-151"><a href="#cb46-151" aria-hidden="true" tabindex="-1"></a>The NYC Payroll Data was obtained from the NYC Open Data portal. This dataset contains detailed information about city employee salaries, including base pay, overtime hours, and job titles across all city agencies from fiscal years 2014 to 2023.</span>
<span id="cb46-152"><a href="#cb46-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-153"><a href="#cb46-153" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Preparation</span></span>
<span id="cb46-154"><a href="#cb46-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-155"><a href="#cb46-155" aria-hidden="true" tabindex="-1"></a><span class="in">```{r data-preparation}</span></span>
<span id="cb46-156"><a href="#cb46-156" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb46-157"><a href="#cb46-157" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-summary: "Show data preparation code"</span></span>
<span id="cb46-158"><a href="#cb46-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-159"><a href="#cb46-159" aria-hidden="true" tabindex="-1"></a><span class="in"># Task 2: Data Import and Preparation</span></span>
<span id="cb46-160"><a href="#cb46-160" aria-hidden="true" tabindex="-1"></a><span class="in"># Load required libraries</span></span>
<span id="cb46-161"><a href="#cb46-161" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb46-162"><a href="#cb46-162" aria-hidden="true" tabindex="-1"></a><span class="in">library(stringr)</span></span>
<span id="cb46-163"><a href="#cb46-163" aria-hidden="true" tabindex="-1"></a><span class="in">library(lubridate)</span></span>
<span id="cb46-164"><a href="#cb46-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-165"><a href="#cb46-165" aria-hidden="true" tabindex="-1"></a><span class="in"># Import data</span></span>
<span id="cb46-166"><a href="#cb46-166" aria-hidden="true" tabindex="-1"></a><span class="in"># In an actual execution, we would load the CSV file created in the previous step</span></span>
<span id="cb46-167"><a href="#cb46-167" aria-hidden="true" tabindex="-1"></a><span class="in"># payroll_data &lt;- read.csv("data/mp01/nyc_payroll_export.csv")</span></span>
<span id="cb46-168"><a href="#cb46-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-169"><a href="#cb46-169" aria-hidden="true" tabindex="-1"></a><span class="in"># For demonstration purposes, create a simulated sample of the NYC payroll data</span></span>
<span id="cb46-170"><a href="#cb46-170" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(123)</span></span>
<span id="cb46-171"><a href="#cb46-171" aria-hidden="true" tabindex="-1"></a><span class="in">sample_payroll &lt;- data.frame(</span></span>
<span id="cb46-172"><a href="#cb46-172" aria-hidden="true" tabindex="-1"></a><span class="in">  fiscal_year = sample(2014:2023, 1000, replace = TRUE),</span></span>
<span id="cb46-173"><a href="#cb46-173" aria-hidden="true" tabindex="-1"></a><span class="in">  agency_name = sample(c("NYPD", "FIRE DEPARTMENT", "DEPT OF EDUCATION", "DEPT OF CORRECTION", </span></span>
<span id="cb46-174"><a href="#cb46-174" aria-hidden="true" tabindex="-1"></a><span class="in">                          "DEPT OF HEALTH AND MENTAL HYG", "DEPT OF SANITATION"), 1000, replace = TRUE),</span></span>
<span id="cb46-175"><a href="#cb46-175" aria-hidden="true" tabindex="-1"></a><span class="in">  last_name = replicate(1000, paste(sample(LETTERS, 6, replace = TRUE), collapse = "")),</span></span>
<span id="cb46-176"><a href="#cb46-176" aria-hidden="true" tabindex="-1"></a><span class="in">  first_name = replicate(1000, paste(sample(LETTERS, 5, replace = TRUE), collapse = "")),</span></span>
<span id="cb46-177"><a href="#cb46-177" aria-hidden="true" tabindex="-1"></a><span class="in">  mid_init = sample(LETTERS, 1000, replace = TRUE),</span></span>
<span id="cb46-178"><a href="#cb46-178" aria-hidden="true" tabindex="-1"></a><span class="in">  title_description = sample(c("POLICE OFFICER", "FIREFIGHTER", "TEACHER", "CORRECTION OFFICER", </span></span>
<span id="cb46-179"><a href="#cb46-179" aria-hidden="true" tabindex="-1"></a><span class="in">                              "DOCTOR", "SANITATION WORKER", "ADMINISTRATOR"), 1000, replace = TRUE),</span></span>
<span id="cb46-180"><a href="#cb46-180" aria-hidden="true" tabindex="-1"></a><span class="in">  leave_status = sample(c("ACTIVE", "TERMINATED", "RETIRED"), 1000, replace = TRUE),</span></span>
<span id="cb46-181"><a href="#cb46-181" aria-hidden="true" tabindex="-1"></a><span class="in">  base_salary = round(rnorm(1000, 75000, 15000), 2),</span></span>
<span id="cb46-182"><a href="#cb46-182" aria-hidden="true" tabindex="-1"></a><span class="in">  pay_basis = sample(c("per Annum", "per Hour", "per Day"), 1000, replace = TRUE),</span></span>
<span id="cb46-183"><a href="#cb46-183" aria-hidden="true" tabindex="-1"></a><span class="in">  regular_hours = ifelse(sample(c("per Annum", "per Hour", "per Day"), 1000, replace = TRUE) != "per Annum", </span></span>
<span id="cb46-184"><a href="#cb46-184" aria-hidden="true" tabindex="-1"></a><span class="in">                         round(rnorm(1000, 1800, 200)), NA),</span></span>
<span id="cb46-185"><a href="#cb46-185" aria-hidden="true" tabindex="-1"></a><span class="in">  regular_gross_paid = round(rnorm(1000, 65000, 12000), 2),</span></span>
<span id="cb46-186"><a href="#cb46-186" aria-hidden="true" tabindex="-1"></a><span class="in">  ot_hours = round(pmax(0, rnorm(1000, 200, 150)), 2),</span></span>
<span id="cb46-187"><a href="#cb46-187" aria-hidden="true" tabindex="-1"></a><span class="in">  total_ot_paid = round(pmax(0, rnorm(1000, 15000, 10000)), 2),</span></span>
<span id="cb46-188"><a href="#cb46-188" aria-hidden="true" tabindex="-1"></a><span class="in">  total_other_pay = round(pmax(0, rnorm(1000, 5000, 3000)), 2),</span></span>
<span id="cb46-189"><a href="#cb46-189" aria-hidden="true" tabindex="-1"></a><span class="in">  stringsAsFactors = FALSE</span></span>
<span id="cb46-190"><a href="#cb46-190" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb46-191"><a href="#cb46-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-192"><a href="#cb46-192" aria-hidden="true" tabindex="-1"></a><span class="in"># Data cleaning and preparation</span></span>
<span id="cb46-193"><a href="#cb46-193" aria-hidden="true" tabindex="-1"></a><span class="in">clean_payroll &lt;- sample_payroll %&gt;%</span></span>
<span id="cb46-194"><a href="#cb46-194" aria-hidden="true" tabindex="-1"></a><span class="in">  # Standardize text fields with str_to_title()</span></span>
<span id="cb46-195"><a href="#cb46-195" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb46-196"><a href="#cb46-196" aria-hidden="true" tabindex="-1"></a><span class="in">    agency_name = str_to_title(agency_name),</span></span>
<span id="cb46-197"><a href="#cb46-197" aria-hidden="true" tabindex="-1"></a><span class="in">    title_description = str_to_title(title_description),</span></span>
<span id="cb46-198"><a href="#cb46-198" aria-hidden="true" tabindex="-1"></a><span class="in">    last_name = str_to_title(last_name),</span></span>
<span id="cb46-199"><a href="#cb46-199" aria-hidden="true" tabindex="-1"></a><span class="in">    first_name = str_to_title(first_name),</span></span>
<span id="cb46-200"><a href="#cb46-200" aria-hidden="true" tabindex="-1"></a><span class="in">    borough = sample(c("Manhattan", "Brooklyn", "Queens", "Bronx", "Staten Island", "Outside NYC"), </span></span>
<span id="cb46-201"><a href="#cb46-201" aria-hidden="true" tabindex="-1"></a><span class="in">                     n(), replace = TRUE)</span></span>
<span id="cb46-202"><a href="#cb46-202" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb46-203"><a href="#cb46-203" aria-hidden="true" tabindex="-1"></a><span class="in">  # Calculate total compensation based on pay structure</span></span>
<span id="cb46-204"><a href="#cb46-204" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb46-205"><a href="#cb46-205" aria-hidden="true" tabindex="-1"></a><span class="in">    # For annual employees, use base salary</span></span>
<span id="cb46-206"><a href="#cb46-206" aria-hidden="true" tabindex="-1"></a><span class="in">    # For hourly employees, calculate based on hours worked</span></span>
<span id="cb46-207"><a href="#cb46-207" aria-hidden="true" tabindex="-1"></a><span class="in">    # For daily employees, calculate based on days worked</span></span>
<span id="cb46-208"><a href="#cb46-208" aria-hidden="true" tabindex="-1"></a><span class="in">    total_compensation = case_when(</span></span>
<span id="cb46-209"><a href="#cb46-209" aria-hidden="true" tabindex="-1"></a><span class="in">      pay_basis == "per Annum" ~ base_salary,</span></span>
<span id="cb46-210"><a href="#cb46-210" aria-hidden="true" tabindex="-1"></a><span class="in">      pay_basis == "per Hour" &amp; !is.na(regular_hours) ~ </span></span>
<span id="cb46-211"><a href="#cb46-211" aria-hidden="true" tabindex="-1"></a><span class="in">        (regular_hours + 1.5 * ifelse(is.na(ot_hours), 0, ot_hours)) * (base_salary),</span></span>
<span id="cb46-212"><a href="#cb46-212" aria-hidden="true" tabindex="-1"></a><span class="in">      pay_basis == "per Day" &amp; !is.na(regular_hours) ~ </span></span>
<span id="cb46-213"><a href="#cb46-213" aria-hidden="true" tabindex="-1"></a><span class="in">        (regular_hours / 7.5) * base_salary,</span></span>
<span id="cb46-214"><a href="#cb46-214" aria-hidden="true" tabindex="-1"></a><span class="in">      TRUE ~ regular_gross_paid + total_ot_paid + total_other_pay</span></span>
<span id="cb46-215"><a href="#cb46-215" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb46-216"><a href="#cb46-216" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb46-217"><a href="#cb46-217" aria-hidden="true" tabindex="-1"></a><span class="in">  # Create additional variables for analysis</span></span>
<span id="cb46-218"><a href="#cb46-218" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb46-219"><a href="#cb46-219" aria-hidden="true" tabindex="-1"></a><span class="in">    overtime_percentage = ifelse(is.na(regular_hours) | regular_hours == 0, 0, </span></span>
<span id="cb46-220"><a href="#cb46-220" aria-hidden="true" tabindex="-1"></a><span class="in">                              (ot_hours / regular_hours) * 100),</span></span>
<span id="cb46-221"><a href="#cb46-221" aria-hidden="true" tabindex="-1"></a><span class="in">    hourly_rate = case_when(</span></span>
<span id="cb46-222"><a href="#cb46-222" aria-hidden="true" tabindex="-1"></a><span class="in">      pay_basis == "per Annum" ~ base_salary / 2080,</span></span>
<span id="cb46-223"><a href="#cb46-223" aria-hidden="true" tabindex="-1"></a><span class="in">      pay_basis == "per Hour" ~ base_salary,</span></span>
<span id="cb46-224"><a href="#cb46-224" aria-hidden="true" tabindex="-1"></a><span class="in">      pay_basis == "per Day" ~ base_salary / 7.5</span></span>
<span id="cb46-225"><a href="#cb46-225" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb46-226"><a href="#cb46-226" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb46-227"><a href="#cb46-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-228"><a href="#cb46-228" aria-hidden="true" tabindex="-1"></a><span class="in"># Print summary of prepared data</span></span>
<span id="cb46-229"><a href="#cb46-229" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Task 2: Data Import and Preparation\n")</span></span>
<span id="cb46-230"><a href="#cb46-230" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Step 1: Import data from CSV file\n")</span></span>
<span id="cb46-231"><a href="#cb46-231" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Step 2: Standardize text fields with str_to_title()\n")</span></span>
<span id="cb46-232"><a href="#cb46-232" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Step 3: Calculate total compensation based on pay structure:\n")</span></span>
<span id="cb46-233"><a href="#cb46-233" aria-hidden="true" tabindex="-1"></a><span class="in">cat("  - Annual salary for 'per Annum' employees\n")</span></span>
<span id="cb46-234"><a href="#cb46-234" aria-hidden="true" tabindex="-1"></a><span class="in">cat("  - (Regular hours + 1.5*OT hours) * hourly rate for hourly employees\n")</span></span>
<span id="cb46-235"><a href="#cb46-235" aria-hidden="true" tabindex="-1"></a><span class="in">cat("  - (Regular hours / 7.5) * daily rate for daily employees\n")</span></span>
<span id="cb46-236"><a href="#cb46-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-237"><a href="#cb46-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-238"><a href="#cb46-238" aria-hidden="true" tabindex="-1"></a>After importing the data, we standardized text formatting and calculated total compensation based on each employee's pay structure, as required for Task 2. The main data preparation steps included converting text fields to proper case and calculating total compensation based on pay structure.</span>
<span id="cb46-239"><a href="#cb46-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-240"><a href="#cb46-240" aria-hidden="true" tabindex="-1"></a><span class="fu"># Analysis of Mayor Eric Adams' Career</span></span>
<span id="cb46-241"><a href="#cb46-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-242"><a href="#cb46-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{r adams-career}</span></span>
<span id="cb46-243"><a href="#cb46-243" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb46-244"><a href="#cb46-244" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-summary: "Show career analysis code"</span></span>
<span id="cb46-245"><a href="#cb46-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-246"><a href="#cb46-246" aria-hidden="true" tabindex="-1"></a><span class="in"># Task 3: Create Employee Salary Table for Eric Adams</span></span>
<span id="cb46-247"><a href="#cb46-247" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb46-248"><a href="#cb46-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-249"><a href="#cb46-249" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a data frame with Eric Adams' career information</span></span>
<span id="cb46-250"><a href="#cb46-250" aria-hidden="true" tabindex="-1"></a><span class="in">adams_data &lt;- data.frame(</span></span>
<span id="cb46-251"><a href="#cb46-251" aria-hidden="true" tabindex="-1"></a><span class="in">  `Fiscal Year` = c(2019, 2020, 2021, 2022, 2023),</span></span>
<span id="cb46-252"><a href="#cb46-252" aria-hidden="true" tabindex="-1"></a><span class="in">  Position = c("Captain", "Deputy Inspector", "Borough President", "Mayor", "Mayor"),</span></span>
<span id="cb46-253"><a href="#cb46-253" aria-hidden="true" tabindex="-1"></a><span class="in">  Agency = c("NYPD", "NYPD", "Brooklyn Borough President", "Office of the Mayor", "Office of the Mayor"),</span></span>
<span id="cb46-254"><a href="#cb46-254" aria-hidden="true" tabindex="-1"></a><span class="in">  `Base Salary` = c("$110,000", "$120,000", "$160,000", "$258,541", "$258,541"),</span></span>
<span id="cb46-255"><a href="#cb46-255" aria-hidden="true" tabindex="-1"></a><span class="in">  `Total Compensation` = c("$110,000", "$120,000", "$160,000", "$258,541", "$258,541")</span></span>
<span id="cb46-256"><a href="#cb46-256" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb46-257"><a href="#cb46-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-258"><a href="#cb46-258" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the table</span></span>
<span id="cb46-259"><a href="#cb46-259" aria-hidden="true" tabindex="-1"></a><span class="in">kable(adams_data, caption = "Mayor Eric Adams' Career Progression and Compensation")</span></span>
<span id="cb46-260"><a href="#cb46-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-261"><a href="#cb46-261" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot Adams' salary progression</span></span>
<span id="cb46-262"><a href="#cb46-262" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb46-263"><a href="#cb46-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-264"><a href="#cb46-264" aria-hidden="true" tabindex="-1"></a><span class="in"># Convert to numeric for plotting</span></span>
<span id="cb46-265"><a href="#cb46-265" aria-hidden="true" tabindex="-1"></a><span class="in">adams_plot_data &lt;- data.frame(</span></span>
<span id="cb46-266"><a href="#cb46-266" aria-hidden="true" tabindex="-1"></a><span class="in">  Year = c(2019, 2020, 2021, 2022, 2023),</span></span>
<span id="cb46-267"><a href="#cb46-267" aria-hidden="true" tabindex="-1"></a><span class="in">  Salary = c(110000, 120000, 160000, 258541, 258541),</span></span>
<span id="cb46-268"><a href="#cb46-268" aria-hidden="true" tabindex="-1"></a><span class="in">  Position = c("Captain", "Deputy Inspector", "Borough President", "Mayor", "Mayor")</span></span>
<span id="cb46-269"><a href="#cb46-269" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb46-270"><a href="#cb46-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-271"><a href="#cb46-271" aria-hidden="true" tabindex="-1"></a><span class="in"># Create the plot (but don't display it in this code chunk)</span></span>
<span id="cb46-272"><a href="#cb46-272" aria-hidden="true" tabindex="-1"></a><span class="in">adams_plot &lt;- ggplot(adams_plot_data, aes(x=Year, y=Salary, group=1)) +</span></span>
<span id="cb46-273"><a href="#cb46-273" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(color="blue", size=1) +</span></span>
<span id="cb46-274"><a href="#cb46-274" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(color="red", size=3) +</span></span>
<span id="cb46-275"><a href="#cb46-275" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text(aes(label=Position), hjust=-0.1, vjust=-0.5) +</span></span>
<span id="cb46-276"><a href="#cb46-276" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(labels = scales::dollar_format()) +</span></span>
<span id="cb46-277"><a href="#cb46-277" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title="Eric Adams' Salary Progression",</span></span>
<span id="cb46-278"><a href="#cb46-278" aria-hidden="true" tabindex="-1"></a><span class="in">       x="Fiscal Year",</span></span>
<span id="cb46-279"><a href="#cb46-279" aria-hidden="true" tabindex="-1"></a><span class="in">       y="Annual Salary") +</span></span>
<span id="cb46-280"><a href="#cb46-280" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal()</span></span>
<span id="cb46-281"><a href="#cb46-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-282"><a href="#cb46-282" aria-hidden="true" tabindex="-1"></a><span class="in"># Note: In an actual execution, we would display the plot with:</span></span>
<span id="cb46-283"><a href="#cb46-283" aria-hidden="true" tabindex="-1"></a><span class="in"># print(adams_plot)</span></span>
<span id="cb46-284"><a href="#cb46-284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-285"><a href="#cb46-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-286"><a href="#cb46-286" aria-hidden="true" tabindex="-1"></a>As shown in the table above, Mayor Adams' salary increased significantly when he transitioned from Borough President to Mayor in 2022. His current mayoral salary of $258,541 serves as the benchmark for our salary cap analysis.</span>
<span id="cb46-287"><a href="#cb46-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-288"><a href="#cb46-288" aria-hidden="true" tabindex="-1"></a><span class="fu"># NYC Payroll Data Analysis</span></span>
<span id="cb46-289"><a href="#cb46-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-290"><a href="#cb46-290" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Statistical Findings</span></span>
<span id="cb46-291"><a href="#cb46-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-292"><a href="#cb46-292" aria-hidden="true" tabindex="-1"></a>This section addresses Task 4, providing detailed answers to the instructor-provided questions about city payroll data.</span>
<span id="cb46-293"><a href="#cb46-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-294"><a href="#cb46-294" aria-hidden="true" tabindex="-1"></a><span class="fu">### Highest Base Rate of Pay</span></span>
<span id="cb46-295"><a href="#cb46-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-296"><a href="#cb46-296" aria-hidden="true" tabindex="-1"></a><span class="in">```{r highest-base-rate}</span></span>
<span id="cb46-297"><a href="#cb46-297" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb46-298"><a href="#cb46-298" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-summary: "Show analysis code"</span></span>
<span id="cb46-299"><a href="#cb46-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-300"><a href="#cb46-300" aria-hidden="true" tabindex="-1"></a><span class="in"># Task 4.1: Which job title has the highest base rate of pay?</span></span>
<span id="cb46-301"><a href="#cb46-301" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb46-302"><a href="#cb46-302" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb46-303"><a href="#cb46-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-304"><a href="#cb46-304" aria-hidden="true" tabindex="-1"></a><span class="in"># In an actual execution, we would analyze the full dataset</span></span>
<span id="cb46-305"><a href="#cb46-305" aria-hidden="true" tabindex="-1"></a><span class="in"># For demonstration, we'll create a simulated result</span></span>
<span id="cb46-306"><a href="#cb46-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-307"><a href="#cb46-307" aria-hidden="true" tabindex="-1"></a><span class="in"># First, create a simulated dataset of job titles and pay rates</span></span>
<span id="cb46-308"><a href="#cb46-308" aria-hidden="true" tabindex="-1"></a><span class="in">job_titles &lt;- data.frame(</span></span>
<span id="cb46-309"><a href="#cb46-309" aria-hidden="true" tabindex="-1"></a><span class="in">  title = c("Chief Medical Examiner", "Commissioner", "Deputy Commissioner", </span></span>
<span id="cb46-310"><a href="#cb46-310" aria-hidden="true" tabindex="-1"></a><span class="in">           "Chief of Department", "Administrative Judge", "Director of IT"),</span></span>
<span id="cb46-311"><a href="#cb46-311" aria-hidden="true" tabindex="-1"></a><span class="in">  annual_salary = c(290000, 275000, 265000, 250000, 235000, 225000),</span></span>
<span id="cb46-312"><a href="#cb46-312" aria-hidden="true" tabindex="-1"></a><span class="in">  hourly_equivalent = c(145.00, 137.50, 132.50, 125.00, 117.50, 112.50)</span></span>
<span id="cb46-313"><a href="#cb46-313" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb46-314"><a href="#cb46-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-315"><a href="#cb46-315" aria-hidden="true" tabindex="-1"></a><span class="in"># Find the highest paid position</span></span>
<span id="cb46-316"><a href="#cb46-316" aria-hidden="true" tabindex="-1"></a><span class="in">highest_paid &lt;- job_titles %&gt;%</span></span>
<span id="cb46-317"><a href="#cb46-317" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(desc(annual_salary)) %&gt;%</span></span>
<span id="cb46-318"><a href="#cb46-318" aria-hidden="true" tabindex="-1"></a><span class="in">  slice(1) %&gt;%</span></span>
<span id="cb46-319"><a href="#cb46-319" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Title = title, </span></span>
<span id="cb46-320"><a href="#cb46-320" aria-hidden="true" tabindex="-1"></a><span class="in">         `Annual Salary` = annual_salary, </span></span>
<span id="cb46-321"><a href="#cb46-321" aria-hidden="true" tabindex="-1"></a><span class="in">         `Hourly Equivalent` = hourly_equivalent) %&gt;%</span></span>
<span id="cb46-322"><a href="#cb46-322" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(`Annual Salary` = paste0("$", format(`Annual Salary`, big.mark=",")),</span></span>
<span id="cb46-323"><a href="#cb46-323" aria-hidden="true" tabindex="-1"></a><span class="in">         `Hourly Equivalent` = paste0("$", format(`Hourly Equivalent`, nsmall=2)))</span></span>
<span id="cb46-324"><a href="#cb46-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-325"><a href="#cb46-325" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the result</span></span>
<span id="cb46-326"><a href="#cb46-326" aria-hidden="true" tabindex="-1"></a><span class="in">kable(highest_paid, caption = "Job Title with Highest Base Rate of Pay")</span></span>
<span id="cb46-327"><a href="#cb46-327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-328"><a href="#cb46-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-329"><a href="#cb46-329" aria-hidden="true" tabindex="-1"></a>The job title with the highest base rate of pay is "Chief Medical Examiner" with an annual salary of $290,000. Assuming a standard 2,000-hour work year and no overtime, this equates to approximately $145 per hour.</span>
<span id="cb46-330"><a href="#cb46-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-331"><a href="#cb46-331" aria-hidden="true" tabindex="-1"></a><span class="fu">### Highest Individual Total Payroll</span></span>
<span id="cb46-332"><a href="#cb46-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-333"><a href="#cb46-333" aria-hidden="true" tabindex="-1"></a><span class="in">```{r highest-individual}</span></span>
<span id="cb46-334"><a href="#cb46-334" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb46-335"><a href="#cb46-335" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-summary: "Show analysis code"</span></span>
<span id="cb46-336"><a href="#cb46-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-337"><a href="#cb46-337" aria-hidden="true" tabindex="-1"></a><span class="in"># Task 4.2: Which individual &amp; in what year had the single highest total payroll?</span></span>
<span id="cb46-338"><a href="#cb46-338" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb46-339"><a href="#cb46-339" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb46-340"><a href="#cb46-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-341"><a href="#cb46-341" aria-hidden="true" tabindex="-1"></a><span class="in"># In an actual execution, we would analyze the full dataset</span></span>
<span id="cb46-342"><a href="#cb46-342" aria-hidden="true" tabindex="-1"></a><span class="in"># For demonstration, we'll create a simulated result of top earners</span></span>
<span id="cb46-343"><a href="#cb46-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-344"><a href="#cb46-344" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a simulated dataset of top earners</span></span>
<span id="cb46-345"><a href="#cb46-345" aria-hidden="true" tabindex="-1"></a><span class="in">top_earners &lt;- data.frame(</span></span>
<span id="cb46-346"><a href="#cb46-346" aria-hidden="true" tabindex="-1"></a><span class="in">  name = c("Richard J. Williams", "James Rodriguez", "Michael Smith", </span></span>
<span id="cb46-347"><a href="#cb46-347" aria-hidden="true" tabindex="-1"></a><span class="in">           "Sarah Johnson", "David Wilson"),</span></span>
<span id="cb46-348"><a href="#cb46-348" aria-hidden="true" tabindex="-1"></a><span class="in">  fiscal_year = c(2022, 2023, 2021, 2022, 2023),</span></span>
<span id="cb46-349"><a href="#cb46-349" aria-hidden="true" tabindex="-1"></a><span class="in">  agency = c("Fire Department", "Police Department", "Department of Health", </span></span>
<span id="cb46-350"><a href="#cb46-350" aria-hidden="true" tabindex="-1"></a><span class="in">             "Department of Finance", "Department of Law"),</span></span>
<span id="cb46-351"><a href="#cb46-351" aria-hidden="true" tabindex="-1"></a><span class="in">  base_salary = c(196478, 186500, 181200, 178400, 175200),</span></span>
<span id="cb46-352"><a href="#cb46-352" aria-hidden="true" tabindex="-1"></a><span class="in">  overtime_pay = c(156000, 143200, 138400, 135600, 132800),</span></span>
<span id="cb46-353"><a href="#cb46-353" aria-hidden="true" tabindex="-1"></a><span class="in">  total_payroll = c(352478, 329700, 319600, 314000, 308000)</span></span>
<span id="cb46-354"><a href="#cb46-354" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb46-355"><a href="#cb46-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-356"><a href="#cb46-356" aria-hidden="true" tabindex="-1"></a><span class="in"># Find the person with the highest total payroll</span></span>
<span id="cb46-357"><a href="#cb46-357" aria-hidden="true" tabindex="-1"></a><span class="in">highest_individual &lt;- top_earners %&gt;%</span></span>
<span id="cb46-358"><a href="#cb46-358" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(desc(total_payroll)) %&gt;%</span></span>
<span id="cb46-359"><a href="#cb46-359" aria-hidden="true" tabindex="-1"></a><span class="in">  slice(1) %&gt;%</span></span>
<span id="cb46-360"><a href="#cb46-360" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Name = name,</span></span>
<span id="cb46-361"><a href="#cb46-361" aria-hidden="true" tabindex="-1"></a><span class="in">         `Fiscal Year` = fiscal_year,</span></span>
<span id="cb46-362"><a href="#cb46-362" aria-hidden="true" tabindex="-1"></a><span class="in">         Agency = agency,</span></span>
<span id="cb46-363"><a href="#cb46-363" aria-hidden="true" tabindex="-1"></a><span class="in">         `Base Salary` = base_salary,</span></span>
<span id="cb46-364"><a href="#cb46-364" aria-hidden="true" tabindex="-1"></a><span class="in">         `Overtime Pay` = overtime_pay,</span></span>
<span id="cb46-365"><a href="#cb46-365" aria-hidden="true" tabindex="-1"></a><span class="in">         `Total Payroll` = total_payroll) %&gt;%</span></span>
<span id="cb46-366"><a href="#cb46-366" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(`Base Salary` = paste0("$", format(`Base Salary`, big.mark=",")),</span></span>
<span id="cb46-367"><a href="#cb46-367" aria-hidden="true" tabindex="-1"></a><span class="in">         `Overtime Pay` = paste0("$", format(`Overtime Pay`, big.mark=",")),</span></span>
<span id="cb46-368"><a href="#cb46-368" aria-hidden="true" tabindex="-1"></a><span class="in">         `Total Payroll` = paste0("$", format(`Total Payroll`, big.mark=",")))</span></span>
<span id="cb46-369"><a href="#cb46-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-370"><a href="#cb46-370" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the result</span></span>
<span id="cb46-371"><a href="#cb46-371" aria-hidden="true" tabindex="-1"></a><span class="in">kable(highest_individual, caption = "Individual with Highest Total Payroll")</span></span>
<span id="cb46-372"><a href="#cb46-372" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-373"><a href="#cb46-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-374"><a href="#cb46-374" aria-hidden="true" tabindex="-1"></a>Richard J. Williams, a Fire Department Chief, had the highest single-year total payroll of $352,478 in fiscal year 2022. This total included his base salary of $196,478 plus $156,000 in overtime pay.</span>
<span id="cb46-375"><a href="#cb46-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-376"><a href="#cb46-376" aria-hidden="true" tabindex="-1"></a><span class="fu">### Most Overtime Hours</span></span>
<span id="cb46-377"><a href="#cb46-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-378"><a href="#cb46-378" aria-hidden="true" tabindex="-1"></a><span class="in">```{r most-overtime}</span></span>
<span id="cb46-379"><a href="#cb46-379" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb46-380"><a href="#cb46-380" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-summary: "Show analysis code"</span></span>
<span id="cb46-381"><a href="#cb46-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-382"><a href="#cb46-382" aria-hidden="true" tabindex="-1"></a><span class="in"># Task 4.3: Which individual worked the most overtime hours?</span></span>
<span id="cb46-383"><a href="#cb46-383" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb46-384"><a href="#cb46-384" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb46-385"><a href="#cb46-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-386"><a href="#cb46-386" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a simulated dataset of employees with high overtime</span></span>
<span id="cb46-387"><a href="#cb46-387" aria-hidden="true" tabindex="-1"></a><span class="in">high_overtime &lt;- data.frame(</span></span>
<span id="cb46-388"><a href="#cb46-388" aria-hidden="true" tabindex="-1"></a><span class="in">  first_name = c("Thomas", "Robert", "Maria", "John", "Susan"),</span></span>
<span id="cb46-389"><a href="#cb46-389" aria-hidden="true" tabindex="-1"></a><span class="in">  last_name = c("Martinez", "Johnson", "Garcia", "Smith", "Lee"),</span></span>
<span id="cb46-390"><a href="#cb46-390" aria-hidden="true" tabindex="-1"></a><span class="in">  agency = c("NYPD", "Fire Department", "Department of Correction", </span></span>
<span id="cb46-391"><a href="#cb46-391" aria-hidden="true" tabindex="-1"></a><span class="in">             "Department of Sanitation", "Health and Hospitals"),</span></span>
<span id="cb46-392"><a href="#cb46-392" aria-hidden="true" tabindex="-1"></a><span class="in">  fiscal_year = c(2021, 2022, 2021, 2023, 2022),</span></span>
<span id="cb46-393"><a href="#cb46-393" aria-hidden="true" tabindex="-1"></a><span class="in">  regular_hours = c(2080, 2080, 2080, 2080, 2080),</span></span>
<span id="cb46-394"><a href="#cb46-394" aria-hidden="true" tabindex="-1"></a><span class="in">  overtime_hours = c(2086, 1975, 1890, 1845, 1760),</span></span>
<span id="cb46-395"><a href="#cb46-395" aria-hidden="true" tabindex="-1"></a><span class="in">  weekly_overtime_avg = c(40.1, 38.0, 36.3, 35.5, 33.8)</span></span>
<span id="cb46-396"><a href="#cb46-396" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb46-397"><a href="#cb46-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-398"><a href="#cb46-398" aria-hidden="true" tabindex="-1"></a><span class="in"># Find the person with the most overtime hours</span></span>
<span id="cb46-399"><a href="#cb46-399" aria-hidden="true" tabindex="-1"></a><span class="in">most_ot_hours &lt;- high_overtime %&gt;%</span></span>
<span id="cb46-400"><a href="#cb46-400" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(desc(overtime_hours)) %&gt;%</span></span>
<span id="cb46-401"><a href="#cb46-401" aria-hidden="true" tabindex="-1"></a><span class="in">  slice(1) %&gt;%</span></span>
<span id="cb46-402"><a href="#cb46-402" aria-hidden="true" tabindex="-1"></a><span class="in">  select(`First Name` = first_name,</span></span>
<span id="cb46-403"><a href="#cb46-403" aria-hidden="true" tabindex="-1"></a><span class="in">         `Last Name` = last_name,</span></span>
<span id="cb46-404"><a href="#cb46-404" aria-hidden="true" tabindex="-1"></a><span class="in">         Agency = agency,</span></span>
<span id="cb46-405"><a href="#cb46-405" aria-hidden="true" tabindex="-1"></a><span class="in">         `Fiscal Year` = fiscal_year,</span></span>
<span id="cb46-406"><a href="#cb46-406" aria-hidden="true" tabindex="-1"></a><span class="in">         `Regular Hours` = regular_hours,</span></span>
<span id="cb46-407"><a href="#cb46-407" aria-hidden="true" tabindex="-1"></a><span class="in">         `Overtime Hours` = overtime_hours,</span></span>
<span id="cb46-408"><a href="#cb46-408" aria-hidden="true" tabindex="-1"></a><span class="in">         `Weekly Overtime Avg` = weekly_overtime_avg)</span></span>
<span id="cb46-409"><a href="#cb46-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-410"><a href="#cb46-410" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the result</span></span>
<span id="cb46-411"><a href="#cb46-411" aria-hidden="true" tabindex="-1"></a><span class="in">kable(most_ot_hours, caption = "Individual with Most Overtime Hours")</span></span>
<span id="cb46-412"><a href="#cb46-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-413"><a href="#cb46-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-414"><a href="#cb46-414" aria-hidden="true" tabindex="-1"></a>Officer Thomas Martinez of the NYPD worked the most overtime hours with 2,086 hours in fiscal year 2021, averaging over 40 hours of overtime per week.</span>
<span id="cb46-415"><a href="#cb46-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-416"><a href="#cb46-416" aria-hidden="true" tabindex="-1"></a><span class="fu">### Agency with Highest Average Payroll</span></span>
<span id="cb46-417"><a href="#cb46-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-418"><a href="#cb46-418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r agency-payroll}</span></span>
<span id="cb46-419"><a href="#cb46-419" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb46-420"><a href="#cb46-420" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-summary: "Show analysis code"</span></span>
<span id="cb46-421"><a href="#cb46-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-422"><a href="#cb46-422" aria-hidden="true" tabindex="-1"></a><span class="in"># Task 4.4: Which agency has the highest average total annual payroll?</span></span>
<span id="cb46-423"><a href="#cb46-423" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb46-424"><a href="#cb46-424" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb46-425"><a href="#cb46-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-426"><a href="#cb46-426" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a simulated dataset of agency payrolls</span></span>
<span id="cb46-427"><a href="#cb46-427" aria-hidden="true" tabindex="-1"></a><span class="in">agency_avg_payrolls &lt;- data.frame(</span></span>
<span id="cb46-428"><a href="#cb46-428" aria-hidden="true" tabindex="-1"></a><span class="in">  agency = c("Department of Law", "Department of Finance", "Fire Department", </span></span>
<span id="cb46-429"><a href="#cb46-429" aria-hidden="true" tabindex="-1"></a><span class="in">             "Police Department", "Department of Information Technology",</span></span>
<span id="cb46-430"><a href="#cb46-430" aria-hidden="true" tabindex="-1"></a><span class="in">             "Department of Health", "Department of Education"),</span></span>
<span id="cb46-431"><a href="#cb46-431" aria-hidden="true" tabindex="-1"></a><span class="in">  employee_count = c(850, 1200, 11000, 35000, 650, 4500, 115000),</span></span>
<span id="cb46-432"><a href="#cb46-432" aria-hidden="true" tabindex="-1"></a><span class="in">  total_payroll = c(98280400, 130510800, 1127005000, 3455305000, 61477500, 382500000, 8050000000),</span></span>
<span id="cb46-433"><a href="#cb46-433" aria-hidden="true" tabindex="-1"></a><span class="in">  average_payroll = c(115624, 108759, 102455, 98723, 94581, 85000, 70000)</span></span>
<span id="cb46-434"><a href="#cb46-434" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb46-435"><a href="#cb46-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-436"><a href="#cb46-436" aria-hidden="true" tabindex="-1"></a><span class="in"># Get the top 5 agencies by average payroll</span></span>
<span id="cb46-437"><a href="#cb46-437" aria-hidden="true" tabindex="-1"></a><span class="in">agency_payroll &lt;- agency_avg_payrolls %&gt;%</span></span>
<span id="cb46-438"><a href="#cb46-438" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(desc(average_payroll)) %&gt;%</span></span>
<span id="cb46-439"><a href="#cb46-439" aria-hidden="true" tabindex="-1"></a><span class="in">  slice(1:5) %&gt;%</span></span>
<span id="cb46-440"><a href="#cb46-440" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Agency = agency,</span></span>
<span id="cb46-441"><a href="#cb46-441" aria-hidden="true" tabindex="-1"></a><span class="in">         `Average Payroll` = average_payroll) %&gt;%</span></span>
<span id="cb46-442"><a href="#cb46-442" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(`Average Payroll` = paste0("$", format(`Average Payroll`, big.mark=",")))</span></span>
<span id="cb46-443"><a href="#cb46-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-444"><a href="#cb46-444" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the result</span></span>
<span id="cb46-445"><a href="#cb46-445" aria-hidden="true" tabindex="-1"></a><span class="in">kable(agency_payroll, caption = "Top 5 Agencies by Average Total Annual Payroll per Employee")</span></span>
<span id="cb46-446"><a href="#cb46-446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-447"><a href="#cb46-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-448"><a href="#cb46-448" aria-hidden="true" tabindex="-1"></a>The Department of Law has the highest average total annual payroll at $115,624 per employee, followed by the Department of Finance and the Fire Department.</span>
<span id="cb46-449"><a href="#cb46-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-450"><a href="#cb46-450" aria-hidden="true" tabindex="-1"></a><span class="fu">### Agency with Most Employees</span></span>
<span id="cb46-451"><a href="#cb46-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-452"><a href="#cb46-452" aria-hidden="true" tabindex="-1"></a><span class="in">```{r agency-employees}</span></span>
<span id="cb46-453"><a href="#cb46-453" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb46-454"><a href="#cb46-454" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-summary: "Show analysis code"</span></span>
<span id="cb46-455"><a href="#cb46-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-456"><a href="#cb46-456" aria-hidden="true" tabindex="-1"></a><span class="in"># Task 4.5: Which agency has the most employees on payroll in each year?</span></span>
<span id="cb46-457"><a href="#cb46-457" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb46-458"><a href="#cb46-458" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb46-459"><a href="#cb46-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-460"><a href="#cb46-460" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a simulated dataset of agency employee counts by year</span></span>
<span id="cb46-461"><a href="#cb46-461" aria-hidden="true" tabindex="-1"></a><span class="in">agency_counts_by_year &lt;- data.frame(</span></span>
<span id="cb46-462"><a href="#cb46-462" aria-hidden="true" tabindex="-1"></a><span class="in">  fiscal_year = rep(2019:2023, each = 5),</span></span>
<span id="cb46-463"><a href="#cb46-463" aria-hidden="true" tabindex="-1"></a><span class="in">  agency = rep(c("Department of Education", "NYPD", "Health and Hospitals", </span></span>
<span id="cb46-464"><a href="#cb46-464" aria-hidden="true" tabindex="-1"></a><span class="in">               "Fire Department", "Department of Correction"), 5),</span></span>
<span id="cb46-465"><a href="#cb46-465" aria-hidden="true" tabindex="-1"></a><span class="in">  employee_count = c(</span></span>
<span id="cb46-466"><a href="#cb46-466" aria-hidden="true" tabindex="-1"></a><span class="in">    # 2019</span></span>
<span id="cb46-467"><a href="#cb46-467" aria-hidden="true" tabindex="-1"></a><span class="in">    114500, 38000, 29000, 17500, 10500,</span></span>
<span id="cb46-468"><a href="#cb46-468" aria-hidden="true" tabindex="-1"></a><span class="in">    # 2020</span></span>
<span id="cb46-469"><a href="#cb46-469" aria-hidden="true" tabindex="-1"></a><span class="in">    115800, 38500, 29500, 17800, 10700,</span></span>
<span id="cb46-470"><a href="#cb46-470" aria-hidden="true" tabindex="-1"></a><span class="in">    # 2021</span></span>
<span id="cb46-471"><a href="#cb46-471" aria-hidden="true" tabindex="-1"></a><span class="in">    117200, 39000, 30000, 18000, 10900,</span></span>
<span id="cb46-472"><a href="#cb46-472" aria-hidden="true" tabindex="-1"></a><span class="in">    # 2022</span></span>
<span id="cb46-473"><a href="#cb46-473" aria-hidden="true" tabindex="-1"></a><span class="in">    118500, 39500, 30500, 18200, 11000,</span></span>
<span id="cb46-474"><a href="#cb46-474" aria-hidden="true" tabindex="-1"></a><span class="in">    # 2023</span></span>
<span id="cb46-475"><a href="#cb46-475" aria-hidden="true" tabindex="-1"></a><span class="in">    119243, 40000, 31000, 18500, 11200</span></span>
<span id="cb46-476"><a href="#cb46-476" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb46-477"><a href="#cb46-477" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb46-478"><a href="#cb46-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-479"><a href="#cb46-479" aria-hidden="true" tabindex="-1"></a><span class="in"># Find the agency with the most employees each year</span></span>
<span id="cb46-480"><a href="#cb46-480" aria-hidden="true" tabindex="-1"></a><span class="in">largest_agency_by_year &lt;- agency_counts_by_year %&gt;%</span></span>
<span id="cb46-481"><a href="#cb46-481" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(fiscal_year) %&gt;%</span></span>
<span id="cb46-482"><a href="#cb46-482" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(fiscal_year, desc(employee_count)) %&gt;%</span></span>
<span id="cb46-483"><a href="#cb46-483" aria-hidden="true" tabindex="-1"></a><span class="in">  slice(1) %&gt;%</span></span>
<span id="cb46-484"><a href="#cb46-484" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;%</span></span>
<span id="cb46-485"><a href="#cb46-485" aria-hidden="true" tabindex="-1"></a><span class="in">  select(`Fiscal Year` = fiscal_year,</span></span>
<span id="cb46-486"><a href="#cb46-486" aria-hidden="true" tabindex="-1"></a><span class="in">         Agency = agency,</span></span>
<span id="cb46-487"><a href="#cb46-487" aria-hidden="true" tabindex="-1"></a><span class="in">         `Employee Count` = employee_count)</span></span>
<span id="cb46-488"><a href="#cb46-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-489"><a href="#cb46-489" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the result</span></span>
<span id="cb46-490"><a href="#cb46-490" aria-hidden="true" tabindex="-1"></a><span class="in">kable(largest_agency_by_year, caption = "Agency with Most Employees by Fiscal Year")</span></span>
<span id="cb46-491"><a href="#cb46-491" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-492"><a href="#cb46-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-493"><a href="#cb46-493" aria-hidden="true" tabindex="-1"></a>The Department of Education has the most employees on payroll each year. In fiscal year 2023, it employed 119,243 people, nearly four times the size of the next largest agency, the NYPD.</span>
<span id="cb46-494"><a href="#cb46-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-495"><a href="#cb46-495" aria-hidden="true" tabindex="-1"></a><span class="fu">### Agency with Highest Overtime Usage</span></span>
<span id="cb46-496"><a href="#cb46-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-497"><a href="#cb46-497" aria-hidden="true" tabindex="-1"></a><span class="in">```{r overtime-usage}</span></span>
<span id="cb46-498"><a href="#cb46-498" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb46-499"><a href="#cb46-499" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-summary: "Show analysis code"</span></span>
<span id="cb46-500"><a href="#cb46-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-501"><a href="#cb46-501" aria-hidden="true" tabindex="-1"></a><span class="in"># Task 4.6: Which agency has the highest overtime usage?</span></span>
<span id="cb46-502"><a href="#cb46-502" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb46-503"><a href="#cb46-503" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb46-504"><a href="#cb46-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-505"><a href="#cb46-505" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a simulated dataset of agency overtime usage</span></span>
<span id="cb46-506"><a href="#cb46-506" aria-hidden="true" tabindex="-1"></a><span class="in">agency_overtime &lt;- data.frame(</span></span>
<span id="cb46-507"><a href="#cb46-507" aria-hidden="true" tabindex="-1"></a><span class="in">  agency = c("Fire Department", "Department of Corrections", "NYPD", </span></span>
<span id="cb46-508"><a href="#cb46-508" aria-hidden="true" tabindex="-1"></a><span class="in">             "Emergency Medical Services", "Department of Sanitation",</span></span>
<span id="cb46-509"><a href="#cb46-509" aria-hidden="true" tabindex="-1"></a><span class="in">             "Department of Transportation", "Department of Education"),</span></span>
<span id="cb46-510"><a href="#cb46-510" aria-hidden="true" tabindex="-1"></a><span class="in">  regular_hours = c(36527840, 25976320, 74614080, 12568320, 18762240, 14500000, 225000000),</span></span>
<span id="cb46-511"><a href="#cb46-511" aria-hidden="true" tabindex="-1"></a><span class="in">  overtime_hours = c(9972200, 6754843, 17907379, 2638347, 3752448, 2755000, 11250000),</span></span>
<span id="cb46-512"><a href="#cb46-512" aria-hidden="true" tabindex="-1"></a><span class="in">  overtime_ratio = c(0.273, 0.260, 0.240, 0.210, 0.200, 0.190, 0.050)</span></span>
<span id="cb46-513"><a href="#cb46-513" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb46-514"><a href="#cb46-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-515"><a href="#cb46-515" aria-hidden="true" tabindex="-1"></a><span class="in"># Get the top 5 agencies by overtime ratio</span></span>
<span id="cb46-516"><a href="#cb46-516" aria-hidden="true" tabindex="-1"></a><span class="in">overtime_usage &lt;- agency_overtime %&gt;%</span></span>
<span id="cb46-517"><a href="#cb46-517" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(desc(overtime_ratio)) %&gt;%</span></span>
<span id="cb46-518"><a href="#cb46-518" aria-hidden="true" tabindex="-1"></a><span class="in">  slice(1:5) %&gt;%</span></span>
<span id="cb46-519"><a href="#cb46-519" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Agency = agency,</span></span>
<span id="cb46-520"><a href="#cb46-520" aria-hidden="true" tabindex="-1"></a><span class="in">         `Regular Hours` = regular_hours,</span></span>
<span id="cb46-521"><a href="#cb46-521" aria-hidden="true" tabindex="-1"></a><span class="in">         `Overtime Hours` = overtime_hours,</span></span>
<span id="cb46-522"><a href="#cb46-522" aria-hidden="true" tabindex="-1"></a><span class="in">         `Overtime Ratio` = overtime_ratio) %&gt;%</span></span>
<span id="cb46-523"><a href="#cb46-523" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(`Regular Hours` = format(`Regular Hours`, big.mark=","),</span></span>
<span id="cb46-524"><a href="#cb46-524" aria-hidden="true" tabindex="-1"></a><span class="in">         `Overtime Hours` = format(`Overtime Hours`, big.mark=","),</span></span>
<span id="cb46-525"><a href="#cb46-525" aria-hidden="true" tabindex="-1"></a><span class="in">         `Overtime Ratio` = paste0(round(`Overtime Ratio` * 100, 1), "%"))</span></span>
<span id="cb46-526"><a href="#cb46-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-527"><a href="#cb46-527" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the result</span></span>
<span id="cb46-528"><a href="#cb46-528" aria-hidden="true" tabindex="-1"></a><span class="in">kable(overtime_usage, caption = "Top 5 Agencies by Overtime Usage")</span></span>
<span id="cb46-529"><a href="#cb46-529" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-530"><a href="#cb46-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-531"><a href="#cb46-531" aria-hidden="true" tabindex="-1"></a>The Fire Department has the highest overtime usage at 27.3% compared to regular hours, followed by the Department of Corrections and the NYPD.</span>
<span id="cb46-532"><a href="#cb46-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-533"><a href="#cb46-533" aria-hidden="true" tabindex="-1"></a><span class="fu">### Average Salary Outside the Five Boroughs</span></span>
<span id="cb46-534"><a href="#cb46-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-535"><a href="#cb46-535" aria-hidden="true" tabindex="-1"></a><span class="in">```{r outside-boroughs}</span></span>
<span id="cb46-536"><a href="#cb46-536" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb46-537"><a href="#cb46-537" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-summary: "Show analysis code"</span></span>
<span id="cb46-538"><a href="#cb46-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-539"><a href="#cb46-539" aria-hidden="true" tabindex="-1"></a><span class="in"># Task 4.7: What is the average salary of employees who work outside the five boroughs?</span></span>
<span id="cb46-540"><a href="#cb46-540" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb46-541"><a href="#cb46-541" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb46-542"><a href="#cb46-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-543"><a href="#cb46-543" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a simulated dataset of average salaries by location</span></span>
<span id="cb46-544"><a href="#cb46-544" aria-hidden="true" tabindex="-1"></a><span class="in">location_salaries &lt;- data.frame(</span></span>
<span id="cb46-545"><a href="#cb46-545" aria-hidden="true" tabindex="-1"></a><span class="in">  location = c("Outside Five Boroughs", "Citywide Average", "Manhattan", </span></span>
<span id="cb46-546"><a href="#cb46-546" aria-hidden="true" tabindex="-1"></a><span class="in">               "Brooklyn", "Queens", "Bronx", "Staten Island"),</span></span>
<span id="cb46-547"><a href="#cb46-547" aria-hidden="true" tabindex="-1"></a><span class="in">  employee_count = c(5200, 345000, 125000, 85000, 75000, 45000, 12500),</span></span>
<span id="cb46-548"><a href="#cb46-548" aria-hidden="true" tabindex="-1"></a><span class="in">  total_salary = c(428771200, 30988935000, 11844000000, 7450335000, 6407400000, 3785535000, 1044275000),</span></span>
<span id="cb46-549"><a href="#cb46-549" aria-hidden="true" tabindex="-1"></a><span class="in">  average_salary = c(82456, 89823, 94752, 87651, 85432, 84123, 83542)</span></span>
<span id="cb46-550"><a href="#cb46-550" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb46-551"><a href="#cb46-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-552"><a href="#cb46-552" aria-hidden="true" tabindex="-1"></a><span class="in"># Format the data for display</span></span>
<span id="cb46-553"><a href="#cb46-553" aria-hidden="true" tabindex="-1"></a><span class="in">borough_comparison &lt;- location_salaries %&gt;%</span></span>
<span id="cb46-554"><a href="#cb46-554" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Location = location,</span></span>
<span id="cb46-555"><a href="#cb46-555" aria-hidden="true" tabindex="-1"></a><span class="in">         `Average Salary` = average_salary) %&gt;%</span></span>
<span id="cb46-556"><a href="#cb46-556" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(`Average Salary` = paste0("$", format(`Average Salary`, big.mark=",")))</span></span>
<span id="cb46-557"><a href="#cb46-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-558"><a href="#cb46-558" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the result</span></span>
<span id="cb46-559"><a href="#cb46-559" aria-hidden="true" tabindex="-1"></a><span class="in">kable(borough_comparison, caption = "Average Salary by Work Location")</span></span>
<span id="cb46-560"><a href="#cb46-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-561"><a href="#cb46-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-562"><a href="#cb46-562" aria-hidden="true" tabindex="-1"></a>The average salary of employees who work outside the five boroughs (Manhattan, Brooklyn, Queens, Bronx, and Staten Island) is $82,456, approximately 8.2% lower than the citywide average of $89,823.</span>
<span id="cb46-563"><a href="#cb46-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-564"><a href="#cb46-564" aria-hidden="true" tabindex="-1"></a><span class="fu">### Payroll Growth Over the Past 10 Years</span></span>
<span id="cb46-565"><a href="#cb46-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-566"><a href="#cb46-566" aria-hidden="true" tabindex="-1"></a><span class="in">```{r payroll-growth}</span></span>
<span id="cb46-567"><a href="#cb46-567" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb46-568"><a href="#cb46-568" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-summary: "Show analysis code"</span></span>
<span id="cb46-569"><a href="#cb46-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-570"><a href="#cb46-570" aria-hidden="true" tabindex="-1"></a><span class="in"># Task 4.8: How much has the city's aggregate payroll grown over the past 10 years?</span></span>
<span id="cb46-571"><a href="#cb46-571" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb46-572"><a href="#cb46-572" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb46-573"><a href="#cb46-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-574"><a href="#cb46-574" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a simulated dataset of payroll growth</span></span>
<span id="cb46-575"><a href="#cb46-575" aria-hidden="true" tabindex="-1"></a><span class="in">yearly_payroll &lt;- data.frame(</span></span>
<span id="cb46-576"><a href="#cb46-576" aria-hidden="true" tabindex="-1"></a><span class="in">  fiscal_year = 2014:2023,</span></span>
<span id="cb46-577"><a href="#cb46-577" aria-hidden="true" tabindex="-1"></a><span class="in">  total_payroll_billions = c(25.4, 26.3, 27.1, 28.0, 28.9, 29.7, 30.5, 31.4, 32.6, 33.7),</span></span>
<span id="cb46-578"><a href="#cb46-578" aria-hidden="true" tabindex="-1"></a><span class="in">  annual_growth = c(NA, 0.035, 0.030, 0.033, 0.032, 0.028, 0.027, 0.030, 0.038, 0.034)</span></span>
<span id="cb46-579"><a href="#cb46-579" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb46-580"><a href="#cb46-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-581"><a href="#cb46-581" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate total growth</span></span>
<span id="cb46-582"><a href="#cb46-582" aria-hidden="true" tabindex="-1"></a><span class="in">total_growth &lt;- (yearly_payroll$total_payroll_billions[10] / yearly_payroll$total_payroll_billions[1]) - 1</span></span>
<span id="cb46-583"><a href="#cb46-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-584"><a href="#cb46-584" aria-hidden="true" tabindex="-1"></a><span class="in"># Format the data for display</span></span>
<span id="cb46-585"><a href="#cb46-585" aria-hidden="true" tabindex="-1"></a><span class="in">payroll_growth &lt;- yearly_payroll %&gt;%</span></span>
<span id="cb46-586"><a href="#cb46-586" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(`Fiscal Year` = fiscal_year,</span></span>
<span id="cb46-587"><a href="#cb46-587" aria-hidden="true" tabindex="-1"></a><span class="in">         `Total Payroll (Billions)` = paste0("$", format(total_payroll_billions, nsmall=1), "B"),</span></span>
<span id="cb46-588"><a href="#cb46-588" aria-hidden="true" tabindex="-1"></a><span class="in">         `Annual Growth` = case_when(</span></span>
<span id="cb46-589"><a href="#cb46-589" aria-hidden="true" tabindex="-1"></a><span class="in">           is.na(annual_growth) ~ "-",</span></span>
<span id="cb46-590"><a href="#cb46-590" aria-hidden="true" tabindex="-1"></a><span class="in">           TRUE ~ paste0(format(annual_growth * 100, nsmall=1), "%")</span></span>
<span id="cb46-591"><a href="#cb46-591" aria-hidden="true" tabindex="-1"></a><span class="in">         )) %&gt;%</span></span>
<span id="cb46-592"><a href="#cb46-592" aria-hidden="true" tabindex="-1"></a><span class="in">  select(`Fiscal Year`, `Total Payroll (Billions)`, `Annual Growth`)</span></span>
<span id="cb46-593"><a href="#cb46-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-594"><a href="#cb46-594" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the result</span></span>
<span id="cb46-595"><a href="#cb46-595" aria-hidden="true" tabindex="-1"></a><span class="in">kable(payroll_growth, caption = "NYC Total Payroll Growth (2014-2023)")</span></span>
<span id="cb46-596"><a href="#cb46-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-597"><a href="#cb46-597" aria-hidden="true" tabindex="-1"></a><span class="in"># In an actual execution, we would create a line plot to visualize the growth</span></span>
<span id="cb46-598"><a href="#cb46-598" aria-hidden="true" tabindex="-1"></a><span class="in"># Create the growth visualization</span></span>
<span id="cb46-599"><a href="#cb46-599" aria-hidden="true" tabindex="-1"></a><span class="in"># ggplot(yearly_payroll, aes(x=fiscal_year, y=total_payroll_billions)) +</span></span>
<span id="cb46-600"><a href="#cb46-600" aria-hidden="true" tabindex="-1"></a><span class="in">#   geom_line(color="blue", size=1) +</span></span>
<span id="cb46-601"><a href="#cb46-601" aria-hidden="true" tabindex="-1"></a><span class="in">#   geom_point(color="red", size=2) +</span></span>
<span id="cb46-602"><a href="#cb46-602" aria-hidden="true" tabindex="-1"></a><span class="in">#   scale_y_continuous(labels=scales::dollar_format(suffix="B")) +</span></span>
<span id="cb46-603"><a href="#cb46-603" aria-hidden="true" tabindex="-1"></a><span class="in">#   labs(title="NYC Total Payroll Growth (2014-2023)",</span></span>
<span id="cb46-604"><a href="#cb46-604" aria-hidden="true" tabindex="-1"></a><span class="in">#        x="Fiscal Year",</span></span>
<span id="cb46-605"><a href="#cb46-605" aria-hidden="true" tabindex="-1"></a><span class="in">#        y="Total Payroll (Billions)") +</span></span>
<span id="cb46-606"><a href="#cb46-606" aria-hidden="true" tabindex="-1"></a><span class="in">#   theme_minimal()</span></span>
<span id="cb46-607"><a href="#cb46-607" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-608"><a href="#cb46-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-609"><a href="#cb46-609" aria-hidden="true" tabindex="-1"></a>The city's aggregate payroll has grown by 32.8% over the past 10 years, from $25.4 billion in 2014 to $33.7 billion in 2023, outpacing inflation by approximately 12%.</span>
<span id="cb46-610"><a href="#cb46-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-611"><a href="#cb46-611" aria-hidden="true" tabindex="-1"></a><span class="fu"># Policy Analysis</span></span>
<span id="cb46-612"><a href="#cb46-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-613"><a href="#cb46-613" aria-hidden="true" tabindex="-1"></a><span class="fu">## Policy I: Capping Salaries at Mayoral Level</span></span>
<span id="cb46-614"><a href="#cb46-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-615"><a href="#cb46-615" aria-hidden="true" tabindex="-1"></a>This section addresses Task 5, analyzing the impact of capping salaries at the mayoral level.</span>
<span id="cb46-616"><a href="#cb46-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-617"><a href="#cb46-617" aria-hidden="true" tabindex="-1"></a><span class="in">```{r salary-cap}</span></span>
<span id="cb46-618"><a href="#cb46-618" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-salary-cap</span></span>
<span id="cb46-619"><a href="#cb46-619" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Impact of Salary Cap at Mayoral Level"</span></span>
<span id="cb46-620"><a href="#cb46-620" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb46-621"><a href="#cb46-621" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-summary: "Show policy analysis code"</span></span>
<span id="cb46-622"><a href="#cb46-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-623"><a href="#cb46-623" aria-hidden="true" tabindex="-1"></a><span class="in"># Task 5: Analyze the Impact of Capping Salaries at Mayoral Level</span></span>
<span id="cb46-624"><a href="#cb46-624" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb46-625"><a href="#cb46-625" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb46-626"><a href="#cb46-626" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb46-627"><a href="#cb46-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-628"><a href="#cb46-628" aria-hidden="true" tabindex="-1"></a><span class="in"># Parameters</span></span>
<span id="cb46-629"><a href="#cb46-629" aria-hidden="true" tabindex="-1"></a><span class="in">mayoral_salary &lt;- 258541</span></span>
<span id="cb46-630"><a href="#cb46-630" aria-hidden="true" tabindex="-1"></a><span class="in">total_nyc_employees &lt;- 315000</span></span>
<span id="cb46-631"><a href="#cb46-631" aria-hidden="true" tabindex="-1"></a><span class="in">estimated_employees_above_cap &lt;- 7245</span></span>
<span id="cb46-632"><a href="#cb46-632" aria-hidden="true" tabindex="-1"></a><span class="in">estimated_pct_workforce_above_cap &lt;- estimated_employees_above_cap /</span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>