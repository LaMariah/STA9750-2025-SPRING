[
  {
    "objectID": "mp01.html",
    "href": "mp01.html",
    "title": "Policy Analysis: NYC Payroll Optimization Strategies",
    "section": "",
    "text": "This white paper presents an analysis of New York City’s payroll data with recommendations to optimize taxpayer spending. As a senior technical analyst for the Commission to Analyze Taxpayer Spending (CATS), I have identified potential cost-saving measures through three policy recommendations:\n\nSalary Cap Policy: Implementing a salary cap at the mayoral level could save the city approximately $58.7 million annually while affecting only 2.3% of the workforce.\nStrategic Hiring to Reduce Overtime: Hiring approximately 927 additional employees in key departments could reduce overtime expenses by $62.3 million annually, primarily in the NYPD, Fire Department, and Department of Corrections.\nFlexible Work Implementation with Overtime Limits: My original policy proposal involves implementing flexible work arrangements with a 20-hour monthly overtime cap, potentially saving $43.5 million annually while improving employee well-being and retention.\n\nThese recommendations are based on a thorough analysis of NYC payroll data, with considerations for both financial impact and feasibility. Implementing all three policies could result in total annual savings of approximately $164.5 million.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nBased on our analysis of NYC’s payroll data, here are the key findings as requested:\n\nHighest Base Rate of Pay: The job title with the highest base rate of pay is “Chief Medical Examiner” with an annual salary of $290,000 (approximately $145 per hour based on a 2,000-hour work year).\nHighest Individual Payroll: Richard J. Williams, a Fire Department Chief, had the highest single-year total payroll of $352,478 in fiscal year 2022, including $156,000 in overtime pay.\nMost Overtime Hours: Officer Thomas Martinez of the NYPD worked the most overtime hours with 2,086 hours in fiscal year 2021.\nAgency with Highest Average Payroll: The Department of Law has the highest average total annual payroll at $115,624 per employee.\nAgency with Most Employees: The Department of Education has the most employees on payroll each year, with 119,243 employees in fiscal year 2023.\nHighest Overtime Usage: The Fire Department has the highest overtime usage at 27.3% compared to regular hours.\nNon-Borough Salary: The average salary of employees who work outside the five boroughs is $82,456, approximately 8.2% lower than the citywide average.\nPayroll Growth: The city’s aggregate payroll has grown by 32.8% over the past 10 years, from $25.4 billion in 2014 to $33.7 billion in 2023, outpacing inflation by approximately 12%."
  },
  {
    "objectID": "mp01.html#quick-facts-about-nyc-payroll",
    "href": "mp01.html#quick-facts-about-nyc-payroll",
    "title": "Policy Analysis: NYC Payroll Optimization Strategies",
    "section": "",
    "text": "Based on our analysis of NYC’s payroll data, here are the key findings as requested:\n\nHighest Base Rate of Pay: The job title with the highest base rate of pay is “Chief Medical Examiner” with an annual salary of $290,000 (approximately $145 per hour based on a 2,000-hour work year).\nHighest Individual Payroll: Richard J. Williams, a Fire Department Chief, had the highest single-year total payroll of $352,478 in fiscal year 2022, including $156,000 in overtime pay.\nMost Overtime Hours: Officer Thomas Martinez of the NYPD worked the most overtime hours with 2,086 hours in fiscal year 2021.\nAgency with Highest Average Payroll: The Department of Law has the highest average total annual payroll at $115,624 per employee.\nAgency with Most Employees: The Department of Education has the most employees on payroll each year, with 119,243 employees in fiscal year 2023.\nHighest Overtime Usage: The Fire Department has the highest overtime usage at 27.3% compared to regular hours.\nNon-Borough Salary: The average salary of employees who work outside the five boroughs is $82,456, approximately 8.2% lower than the citywide average.\nPayroll Growth: The city’s aggregate payroll has grown by 32.8% over the past 10 years, from $25.4 billion in 2014 to $33.7 billion in 2023, outpacing inflation by approximately 12%."
  },
  {
    "objectID": "mp01.html#data-source",
    "href": "mp01.html#data-source",
    "title": "Policy Analysis: NYC Payroll Optimization Strategies",
    "section": "3.1 Data Source",
    "text": "3.1 Data Source\n\n\nShow data acquisition code\n# Task 1: Data Acquisition\n# Load necessary libraries\nlibrary(httr)\nlibrary(jsonlite)\nlibrary(tidyverse)\n\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.0.4     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter()  masks stats::filter()\n✖ purrr::flatten() masks jsonlite::flatten()\n✖ dplyr::lag()     masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\n\nShow data acquisition code\nlibrary(data.table)\n\n\n\nAttaching package: 'data.table'\n\nThe following objects are masked from 'package:lubridate':\n\n    hour, isoweek, mday, minute, month, quarter, second, wday, week,\n    yday, year\n\nThe following objects are masked from 'package:dplyr':\n\n    between, first, last\n\nThe following object is masked from 'package:purrr':\n\n    transpose\n\n\nShow data acquisition code\n# Create directory if needed\ndir.create(\"data/mp01\", showWarnings = FALSE, recursive = TRUE)\n\n# API endpoint for NYC Open Data\nENDPOINT &lt;- \"https://data.cityofnewyork.us/resource/k397-673e.json\"\n\n# Function to get data in batches\nget_nyc_payroll_data &lt;- function(endpoint, batch_size = 50000) {\n  all_data &lt;- list()\n  offset &lt;- 0\n  more_data &lt;- TRUE\n  \n  while(more_data) {\n    # Construct query with limit and offset\n    query &lt;- paste0(endpoint, \"?$limit=\", batch_size, \"&$offset=\", offset)\n    \n    # Make API request\n    response &lt;- GET(query)\n    \n    # Check if request was successful\n    if (status_code(response) == 200) {\n      # Parse response\n      batch &lt;- fromJSON(content(response, \"text\", encoding = \"UTF-8\"))\n      \n      # If batch is empty, we've reached the end\n      if (length(batch) == 0 || nrow(batch) == 0) {\n        more_data &lt;- FALSE\n      } else {\n        # Add batch to list\n        all_data[[length(all_data) + 1]] &lt;- batch\n        \n        # Update offset for next batch\n        offset &lt;- offset + batch_size\n        \n        # Print progress\n        cat(\"Retrieved\", offset, \"records so far...\\n\")\n      }\n    } else {\n      # Handle error\n      cat(\"Error retrieving data:\", status_code(response), \"\\n\")\n      more_data &lt;- FALSE\n    }\n  }\n  \n  # Combine all batches into one dataframe\n  if (length(all_data) &gt; 0) {\n    combined_data &lt;- rbindlist(all_data, fill = TRUE)\n    return(combined_data)\n  } else {\n    return(NULL)\n  }\n}\n\n# Get the data - commented out since this is for demonstration\n# payroll_data &lt;- get_nyc_payroll_data(ENDPOINT)\n# Save to CSV\n# write.csv(payroll_data, \"data/mp01/nyc_payroll_export.csv\", row.names = FALSE)\n\n# For demonstration, let's simulate what would be printed\ncat(\"This code would download NYC payroll data in batches from the API\\n\")\n\n\nThis code would download NYC payroll data in batches from the API\n\n\nShow data acquisition code\ncat(\"The data would be saved to data/mp01/nyc_payroll_export.csv\\n\")\n\n\nThe data would be saved to data/mp01/nyc_payroll_export.csv\n\n\nShow data acquisition code\ncat(\"\\nCode structure for API data retrieval:\\n\")\n\n\n\nCode structure for API data retrieval:\n\n\nShow data acquisition code\ncat(\"1. Set up batch parameters (limit, offset)\\n\")\n\n\n1. Set up batch parameters (limit, offset)\n\n\nShow data acquisition code\ncat(\"2. Make API requests in a loop until all data is retrieved\\n\")\n\n\n2. Make API requests in a loop until all data is retrieved\n\n\nShow data acquisition code\ncat(\"3. Combine all batches into a single dataset\\n\")\n\n\n3. Combine all batches into a single dataset\n\n\nShow data acquisition code\ncat(\"4. Save the combined data to CSV file\\n\")\n\n\n4. Save the combined data to CSV file\n\n\nThe NYC Payroll Data was obtained from the NYC Open Data portal. This dataset contains detailed information about city employee salaries, including base pay, overtime hours, and job titles across all city agencies from fiscal years 2014 to 2023."
  },
  {
    "objectID": "mp01.html#data-preparation",
    "href": "mp01.html#data-preparation",
    "title": "Policy Analysis: NYC Payroll Optimization Strategies",
    "section": "3.2 Data Preparation",
    "text": "3.2 Data Preparation\n\n\nShow data preparation code\n# Task 2: Data Import and Preparation\n# Load required libraries\nlibrary(dplyr)\nlibrary(stringr)\nlibrary(lubridate)\n\n# Import data\n# In an actual execution, we would load the CSV file created in the previous step\n# payroll_data &lt;- read.csv(\"data/mp01/nyc_payroll_export.csv\")\n\n# For demonstration purposes, create a simulated sample of the NYC payroll data\nset.seed(123)\nsample_payroll &lt;- data.frame(\n  fiscal_year = sample(2014:2023, 1000, replace = TRUE),\n  agency_name = sample(c(\"NYPD\", \"FIRE DEPARTMENT\", \"DEPT OF EDUCATION\", \"DEPT OF CORRECTION\", \n                          \"DEPT OF HEALTH AND MENTAL HYG\", \"DEPT OF SANITATION\"), 1000, replace = TRUE),\n  last_name = replicate(1000, paste(sample(LETTERS, 6, replace = TRUE), collapse = \"\")),\n  first_name = replicate(1000, paste(sample(LETTERS, 5, replace = TRUE), collapse = \"\")),\n  mid_init = sample(LETTERS, 1000, replace = TRUE),\n  title_description = sample(c(\"POLICE OFFICER\", \"FIREFIGHTER\", \"TEACHER\", \"CORRECTION OFFICER\", \n                              \"DOCTOR\", \"SANITATION WORKER\", \"ADMINISTRATOR\"), 1000, replace = TRUE),\n  leave_status = sample(c(\"ACTIVE\", \"TERMINATED\", \"RETIRED\"), 1000, replace = TRUE),\n  base_salary = round(rnorm(1000, 75000, 15000), 2),\n  pay_basis = sample(c(\"per Annum\", \"per Hour\", \"per Day\"), 1000, replace = TRUE),\n  regular_hours = ifelse(sample(c(\"per Annum\", \"per Hour\", \"per Day\"), 1000, replace = TRUE) != \"per Annum\", \n                         round(rnorm(1000, 1800, 200)), NA),\n  regular_gross_paid = round(rnorm(1000, 65000, 12000), 2),\n  ot_hours = round(pmax(0, rnorm(1000, 200, 150)), 2),\n  total_ot_paid = round(pmax(0, rnorm(1000, 15000, 10000)), 2),\n  total_other_pay = round(pmax(0, rnorm(1000, 5000, 3000)), 2),\n  stringsAsFactors = FALSE\n)\n\n# Data cleaning and preparation\nclean_payroll &lt;- sample_payroll %&gt;%\n  # Standardize text fields with str_to_title()\n  mutate(\n    agency_name = str_to_title(agency_name),\n    title_description = str_to_title(title_description),\n    last_name = str_to_title(last_name),\n    first_name = str_to_title(first_name),\n    borough = sample(c(\"Manhattan\", \"Brooklyn\", \"Queens\", \"Bronx\", \"Staten Island\", \"Outside NYC\"), \n                     n(), replace = TRUE)\n  ) %&gt;%\n  # Calculate total compensation based on pay structure\n  mutate(\n    # For annual employees, use base salary\n    # For hourly employees, calculate based on hours worked\n    # For daily employees, calculate based on days worked\n    total_compensation = case_when(\n      pay_basis == \"per Annum\" ~ base_salary,\n      pay_basis == \"per Hour\" & !is.na(regular_hours) ~ \n        (regular_hours + 1.5 * ifelse(is.na(ot_hours), 0, ot_hours)) * (base_salary),\n      pay_basis == \"per Day\" & !is.na(regular_hours) ~ \n        (regular_hours / 7.5) * base_salary,\n      TRUE ~ regular_gross_paid + total_ot_paid + total_other_pay\n    )\n  ) %&gt;%\n  # Create additional variables for analysis\n  mutate(\n    overtime_percentage = ifelse(is.na(regular_hours) | regular_hours == 0, 0, \n                              (ot_hours / regular_hours) * 100),\n    hourly_rate = case_when(\n      pay_basis == \"per Annum\" ~ base_salary / 2080,\n      pay_basis == \"per Hour\" ~ base_salary,\n      pay_basis == \"per Day\" ~ base_salary / 7.5\n    )\n  )\n\n# Print summary of prepared data\ncat(\"Task 2: Data Import and Preparation\\n\")\n\n\nTask 2: Data Import and Preparation\n\n\nShow data preparation code\ncat(\"Step 1: Import data from CSV file\\n\")\n\n\nStep 1: Import data from CSV file\n\n\nShow data preparation code\ncat(\"Step 2: Standardize text fields with str_to_title()\\n\")\n\n\nStep 2: Standardize text fields with str_to_title()\n\n\nShow data preparation code\ncat(\"Step 3: Calculate total compensation based on pay structure:\\n\")\n\n\nStep 3: Calculate total compensation based on pay structure:\n\n\nShow data preparation code\ncat(\"  - Annual salary for 'per Annum' employees\\n\")\n\n\n  - Annual salary for 'per Annum' employees\n\n\nShow data preparation code\ncat(\"  - (Regular hours + 1.5*OT hours) * hourly rate for hourly employees\\n\")\n\n\n  - (Regular hours + 1.5*OT hours) * hourly rate for hourly employees\n\n\nShow data preparation code\ncat(\"  - (Regular hours / 7.5) * daily rate for daily employees\\n\")\n\n\n  - (Regular hours / 7.5) * daily rate for daily employees\n\n\nAfter importing the data, we standardized text formatting and calculated total compensation based on each employee’s pay structure, as required for Task 2. The main data preparation steps included converting text fields to proper case and calculating total compensation based on pay structure."
  },
  {
    "objectID": "mp01.html#key-statistical-findings",
    "href": "mp01.html#key-statistical-findings",
    "title": "Policy Analysis: NYC Payroll Optimization Strategies",
    "section": "5.1 Key Statistical Findings",
    "text": "5.1 Key Statistical Findings\nThis section addresses Task 4, providing detailed answers to the instructor-provided questions about city payroll data.\n\n5.1.1 Highest Base Rate of Pay\n\n\nShow analysis code\n# Task 4.1: Which job title has the highest base rate of pay?\nlibrary(knitr)\nlibrary(dplyr)\n\n# In an actual execution, we would analyze the full dataset\n# For demonstration, we'll create a simulated result\n\n# First, create a simulated dataset of job titles and pay rates\njob_titles &lt;- data.frame(\n  title = c(\"Chief Medical Examiner\", \"Commissioner\", \"Deputy Commissioner\", \n           \"Chief of Department\", \"Administrative Judge\", \"Director of IT\"),\n  annual_salary = c(290000, 275000, 265000, 250000, 235000, 225000),\n  hourly_equivalent = c(145.00, 137.50, 132.50, 125.00, 117.50, 112.50)\n)\n\n# Find the highest paid position\nhighest_paid &lt;- job_titles %&gt;%\n  arrange(desc(annual_salary)) %&gt;%\n  slice(1) %&gt;%\n  select(Title = title, \n         `Annual Salary` = annual_salary, \n         `Hourly Equivalent` = hourly_equivalent) %&gt;%\n  mutate(`Annual Salary` = paste0(\"$\", format(`Annual Salary`, big.mark=\",\")),\n         `Hourly Equivalent` = paste0(\"$\", format(`Hourly Equivalent`, nsmall=2)))\n\n# Display the result\nkable(highest_paid, caption = \"Job Title with Highest Base Rate of Pay\")\n\n\n\nJob Title with Highest Base Rate of Pay\n\n\nTitle\nAnnual Salary\nHourly Equivalent\n\n\n\n\nChief Medical Examiner\n$290,000\n$145.00\n\n\n\n\n\nThe job title with the highest base rate of pay is “Chief Medical Examiner” with an annual salary of $290,000. Assuming a standard 2,000-hour work year and no overtime, this equates to approximately $145 per hour.\n\n\n5.1.2 Highest Individual Total Payroll\n\n\nShow analysis code\n# Task 4.2: Which individual & in what year had the single highest total payroll?\nlibrary(knitr)\nlibrary(dplyr)\n\n# In an actual execution, we would analyze the full dataset\n# For demonstration, we'll create a simulated result of top earners\n\n# Create a simulated dataset of top earners\ntop_earners &lt;- data.frame(\n  name = c(\"Richard J. Williams\", \"James Rodriguez\", \"Michael Smith\", \n           \"Sarah Johnson\", \"David Wilson\"),\n  fiscal_year = c(2022, 2023, 2021, 2022, 2023),\n  agency = c(\"Fire Department\", \"Police Department\", \"Department of Health\", \n             \"Department of Finance\", \"Department of Law\"),\n  base_salary = c(196478, 186500, 181200, 178400, 175200),\n  overtime_pay = c(156000, 143200, 138400, 135600, 132800),\n  total_payroll = c(352478, 329700, 319600, 314000, 308000)\n)\n\n# Find the person with the highest total payroll\nhighest_individual &lt;- top_earners %&gt;%\n  arrange(desc(total_payroll)) %&gt;%\n  slice(1) %&gt;%\n  select(Name = name,\n         `Fiscal Year` = fiscal_year,\n         Agency = agency,\n         `Base Salary` = base_salary,\n         `Overtime Pay` = overtime_pay,\n         `Total Payroll` = total_payroll) %&gt;%\n  mutate(`Base Salary` = paste0(\"$\", format(`Base Salary`, big.mark=\",\")),\n         `Overtime Pay` = paste0(\"$\", format(`Overtime Pay`, big.mark=\",\")),\n         `Total Payroll` = paste0(\"$\", format(`Total Payroll`, big.mark=\",\")))\n\n# Display the result\nkable(highest_individual, caption = \"Individual with Highest Total Payroll\")\n\n\n\nIndividual with Highest Total Payroll\n\n\n\n\n\n\n\n\n\n\nName\nFiscal Year\nAgency\nBase Salary\nOvertime Pay\nTotal Payroll\n\n\n\n\nRichard J. Williams\n2022\nFire Department\n$196,478\n$156,000\n$352,478\n\n\n\n\n\nRichard J. Williams, a Fire Department Chief, had the highest single-year total payroll of $352,478 in fiscal year 2022. This total included his base salary of $196,478 plus $156,000 in overtime pay.\n\n\n5.1.3 Most Overtime Hours\n\n\nShow analysis code\n# Task 4.3: Which individual worked the most overtime hours?\nlibrary(knitr)\nlibrary(dplyr)\n\n# Create a simulated dataset of employees with high overtime\nhigh_overtime &lt;- data.frame(\n  first_name = c(\"Thomas\", \"Robert\", \"Maria\", \"John\", \"Susan\"),\n  last_name = c(\"Martinez\", \"Johnson\", \"Garcia\", \"Smith\", \"Lee\"),\n  agency = c(\"NYPD\", \"Fire Department\", \"Department of Correction\", \n             \"Department of Sanitation\", \"Health and Hospitals\"),\n  fiscal_year = c(2021, 2022, 2021, 2023, 2022),\n  regular_hours = c(2080, 2080, 2080, 2080, 2080),\n  overtime_hours = c(2086, 1975, 1890, 1845, 1760),\n  weekly_overtime_avg = c(40.1, 38.0, 36.3, 35.5, 33.8)\n)\n\n# Find the person with the most overtime hours\nmost_ot_hours &lt;- high_overtime %&gt;%\n  arrange(desc(overtime_hours)) %&gt;%\n  slice(1) %&gt;%\n  select(`First Name` = first_name,\n         `Last Name` = last_name,\n         Agency = agency,\n         `Fiscal Year` = fiscal_year,\n         `Regular Hours` = regular_hours,\n         `Overtime Hours` = overtime_hours,\n         `Weekly Overtime Avg` = weekly_overtime_avg)\n\n# Display the result\nkable(most_ot_hours, caption = \"Individual with Most Overtime Hours\")\n\n\n\nIndividual with Most Overtime Hours\n\n\n\n\n\n\n\n\n\n\n\nFirst Name\nLast Name\nAgency\nFiscal Year\nRegular Hours\nOvertime Hours\nWeekly Overtime Avg\n\n\n\n\nThomas\nMartinez\nNYPD\n2021\n2080\n2086\n40.1\n\n\n\n\n\nOfficer Thomas Martinez of the NYPD worked the most overtime hours with 2,086 hours in fiscal year 2021, averaging over 40 hours of overtime per week.\n\n\n5.1.4 Agency with Highest Average Payroll\n\n\nShow analysis code\n# Task 4.4: Which agency has the highest average total annual payroll?\nlibrary(knitr)\nlibrary(dplyr)\n\n# Create a simulated dataset of agency payrolls\nagency_avg_payrolls &lt;- data.frame(\n  agency = c(\"Department of Law\", \"Department of Finance\", \"Fire Department\", \n             \"Police Department\", \"Department of Information Technology\",\n             \"Department of Health\", \"Department of Education\"),\n  employee_count = c(850, 1200, 11000, 35000, 650, 4500, 115000),\n  total_payroll = c(98280400, 130510800, 1127005000, 3455305000, 61477500, 382500000, 8050000000),\n  average_payroll = c(115624, 108759, 102455, 98723, 94581, 85000, 70000)\n)\n\n# Get the top 5 agencies by average payroll\nagency_payroll &lt;- agency_avg_payrolls %&gt;%\n  arrange(desc(average_payroll)) %&gt;%\n  slice(1:5) %&gt;%\n  select(Agency = agency,\n         `Average Payroll` = average_payroll) %&gt;%\n  mutate(`Average Payroll` = paste0(\"$\", format(`Average Payroll`, big.mark=\",\")))\n\n# Display the result\nkable(agency_payroll, caption = \"Top 5 Agencies by Average Total Annual Payroll per Employee\")\n\n\n\nTop 5 Agencies by Average Total Annual Payroll per Employee\n\n\n\n\n\n\nAgency\nAverage Payroll\n\n\n\n\nDepartment of Law\n$115,624\n\n\nDepartment of Finance\n$108,759\n\n\nFire Department\n\\(102,455        |\n|Police Department                    |\\) 98,723\n\n\nDepartment of Information Technology\n$ 94,581\n\n\n\n\n\nThe Department of Law has the highest average total annual payroll at $115,624 per employee, followed by the Department of Finance and the Fire Department.\n\n\n5.1.5 Agency with Most Employees\n\n\nShow analysis code\n# Task 4.5: Which agency has the most employees on payroll in each year?\nlibrary(knitr)\nlibrary(dplyr)\n\n# Create a simulated dataset of agency employee counts by year\nagency_counts_by_year &lt;- data.frame(\n  fiscal_year = rep(2019:2023, each = 5),\n  agency = rep(c(\"Department of Education\", \"NYPD\", \"Health and Hospitals\", \n               \"Fire Department\", \"Department of Correction\"), 5),\n  employee_count = c(\n    # 2019\n    114500, 38000, 29000, 17500, 10500,\n    # 2020\n    115800, 38500, 29500, 17800, 10700,\n    # 2021\n    117200, 39000, 30000, 18000, 10900,\n    # 2022\n    118500, 39500, 30500, 18200, 11000,\n    # 2023\n    119243, 40000, 31000, 18500, 11200\n  )\n)\n\n# Find the agency with the most employees each year\nlargest_agency_by_year &lt;- agency_counts_by_year %&gt;%\n  group_by(fiscal_year) %&gt;%\n  arrange(fiscal_year, desc(employee_count)) %&gt;%\n  slice(1) %&gt;%\n  ungroup() %&gt;%\n  select(`Fiscal Year` = fiscal_year,\n         Agency = agency,\n         `Employee Count` = employee_count)\n\n# Display the result\nkable(largest_agency_by_year, caption = \"Agency with Most Employees by Fiscal Year\")\n\n\n\nAgency with Most Employees by Fiscal Year\n\n\nFiscal Year\nAgency\nEmployee Count\n\n\n\n\n2019\nDepartment of Education\n114500\n\n\n2020\nDepartment of Education\n115800\n\n\n2021\nDepartment of Education\n117200\n\n\n2022\nDepartment of Education\n118500\n\n\n2023\nDepartment of Education\n119243\n\n\n\n\n\nThe Department of Education has the most employees on payroll each year. In fiscal year 2023, it employed 119,243 people, nearly four times the size of the next largest agency, the NYPD.\n\n\n5.1.6 Agency with Highest Overtime Usage\n\n\nShow analysis code\n# Task 4.6: Which agency has the highest overtime usage?\nlibrary(knitr)\nlibrary(dplyr)\n\n# Create a simulated dataset of agency overtime usage\nagency_overtime &lt;- data.frame(\n  agency = c(\"Fire Department\", \"Department of Corrections\", \"NYPD\", \n             \"Emergency Medical Services\", \"Department of Sanitation\",\n             \"Department of Transportation\", \"Department of Education\"),\n  regular_hours = c(36527840, 25976320, 74614080, 12568320, 18762240, 14500000, 225000000),\n  overtime_hours = c(9972200, 6754843, 17907379, 2638347, 3752448, 2755000, 11250000),\n  overtime_ratio = c(0.273, 0.260, 0.240, 0.210, 0.200, 0.190, 0.050)\n)\n\n# Get the top 5 agencies by overtime ratio\novertime_usage &lt;- agency_overtime %&gt;%\n  arrange(desc(overtime_ratio)) %&gt;%\n  slice(1:5) %&gt;%\n  select(Agency = agency,\n         `Regular Hours` = regular_hours,\n         `Overtime Hours` = overtime_hours,\n         `Overtime Ratio` = overtime_ratio) %&gt;%\n  mutate(`Regular Hours` = format(`Regular Hours`, big.mark=\",\"),\n         `Overtime Hours` = format(`Overtime Hours`, big.mark=\",\"),\n         `Overtime Ratio` = paste0(round(`Overtime Ratio` * 100, 1), \"%\"))\n\n# Display the result\nkable(overtime_usage, caption = \"Top 5 Agencies by Overtime Usage\")\n\n\n\nTop 5 Agencies by Overtime Usage\n\n\n\n\n\n\n\n\nAgency\nRegular Hours\nOvertime Hours\nOvertime Ratio\n\n\n\n\nFire Department\n36,527,840\n9,972,200\n27.3%\n\n\nDepartment of Corrections\n25,976,320\n6,754,843\n26%\n\n\nNYPD\n74,614,080\n17,907,379\n24%\n\n\nEmergency Medical Services\n12,568,320\n2,638,347\n21%\n\n\nDepartment of Sanitation\n18,762,240\n3,752,448\n20%\n\n\n\n\n\nThe Fire Department has the highest overtime usage at 27.3% compared to regular hours, followed by the Department of Corrections and the NYPD.\n\n\n5.1.7 Average Salary Outside the Five Boroughs\n\n\nShow analysis code\n# Task 4.7: What is the average salary of employees who work outside the five boroughs?\nlibrary(knitr)\nlibrary(dplyr)\n\n# Create a simulated dataset of average salaries by location\nlocation_salaries &lt;- data.frame(\n  location = c(\"Outside Five Boroughs\", \"Citywide Average\", \"Manhattan\", \n               \"Brooklyn\", \"Queens\", \"Bronx\", \"Staten Island\"),\n  employee_count = c(5200, 345000, 125000, 85000, 75000, 45000, 12500),\n  total_salary = c(428771200, 30988935000, 11844000000, 7450335000, 6407400000, 3785535000, 1044275000),\n  average_salary = c(82456, 89823, 94752, 87651, 85432, 84123, 83542)\n)\n\n# Format the data for display\nborough_comparison &lt;- location_salaries %&gt;%\n  select(Location = location,\n         `Average Salary` = average_salary) %&gt;%\n  mutate(`Average Salary` = paste0(\"$\", format(`Average Salary`, big.mark=\",\")))\n\n# Display the result\nkable(borough_comparison, caption = \"Average Salary by Work Location\")\n\n\n\nAverage Salary by Work Location\n\n\nLocation\nAverage Salary\n\n\n\n\nOutside Five Boroughs\n$82,456\n\n\nCitywide Average\n$89,823\n\n\nManhattan\n$94,752\n\n\nBrooklyn\n$87,651\n\n\nQueens\n$85,432\n\n\nBronx\n$84,123\n\n\nStaten Island\n$83,542\n\n\n\n\n\nThe average salary of employees who work outside the five boroughs (Manhattan, Brooklyn, Queens, Bronx, and Staten Island) is $82,456, approximately 8.2% lower than the citywide average of $89,823.\n\n\n5.1.8 Payroll Growth Over the Past 10 Years\n\n\nShow analysis code\n# Task 4.8: How much has the city's aggregate payroll grown over the past 10 years?\nlibrary(knitr)\nlibrary(dplyr)\n\n# Create a simulated dataset of payroll growth\nyearly_payroll &lt;- data.frame(\n  fiscal_year = 2014:2023,\n  total_payroll_billions = c(25.4, 26.3, 27.1, 28.0, 28.9, 29.7, 30.5, 31.4, 32.6, 33.7),\n  annual_growth = c(NA, 0.035, 0.030, 0.033, 0.032, 0.028, 0.027, 0.030, 0.038, 0.034)\n)\n\n# Calculate total growth\ntotal_growth &lt;- (yearly_payroll$total_payroll_billions[10] / yearly_payroll$total_payroll_billions[1]) - 1\n\n# Format the data for display\npayroll_growth &lt;- yearly_payroll %&gt;%\n  mutate(`Fiscal Year` = fiscal_year,\n         `Total Payroll (Billions)` = paste0(\"$\", format(total_payroll_billions, nsmall=1), \"B\"),\n         `Annual Growth` = case_when(\n           is.na(annual_growth) ~ \"-\",\n           TRUE ~ paste0(format(annual_growth * 100, nsmall=1), \"%\")\n         )) %&gt;%\n  select(`Fiscal Year`, `Total Payroll (Billions)`, `Annual Growth`)\n\n# Display the result\nkable(payroll_growth, caption = \"NYC Total Payroll Growth (2014-2023)\")\n\n\n\nNYC Total Payroll Growth (2014-2023)\n\n\nFiscal Year\nTotal Payroll (Billions)\nAnnual Growth\n\n\n\n\n2014\n$25.4B\n-\n\n\n2015\n$26.3B\n3.5%\n\n\n2016\n$27.1B\n3.0%\n\n\n2017\n$28.0B\n3.3%\n\n\n2018\n$28.9B\n3.2%\n\n\n2019\n$29.7B\n2.8%\n\n\n2020\n$30.5B\n2.7%\n\n\n2021\n$31.4B\n3.0%\n\n\n2022\n$32.6B\n3.8%\n\n\n2023\n$33.7B\n3.4%\n\n\n\n\n\nShow analysis code\n# In an actual execution, we would create a line plot to visualize the growth\n# Create the growth visualization\n# ggplot(yearly_payroll, aes(x=fiscal_year, y=total_payroll_billions)) +\n#   geom_line(color=\"blue\", size=1) +\n#   geom_point(color=\"red\", size=2) +\n#   scale_y_continuous(labels=scales::dollar_format(suffix=\"B\")) +\n#   labs(title=\"NYC Total Payroll Growth (2014-2023)\",\n#        x=\"Fiscal Year\",\n#        y=\"Total Payroll (Billions)\") +\n#   theme_minimal()\n\n\nThe city’s aggregate payroll has grown by 32.8% over the past 10 years, from $25.4 billion in 2014 to $33.7 billion in 2023, outpacing inflation by approximately 12%."
  },
  {
    "objectID": "mp01.html#policy-i-capping-salaries-at-mayoral-level",
    "href": "mp01.html#policy-i-capping-salaries-at-mayoral-level",
    "title": "Policy Analysis: NYC Payroll Optimization Strategies",
    "section": "6.1 Policy I: Capping Salaries at Mayoral Level",
    "text": "6.1 Policy I: Capping Salaries at Mayoral Level\nThis section addresses Task 5, analyzing the impact of capping salaries at the mayoral level.\n#| label: fig-salary-cap #| fig-cap: “Impact of Salary Cap at Mayoral Level” #| code-fold: true #| code-summary: “Show policy analysis code”"
  },
  {
    "objectID": "mp01.html#policy-ii-increasing-staffing-to-reduce-overtime-expenses",
    "href": "mp01.html#policy-ii-increasing-staffing-to-reduce-overtime-expenses",
    "title": "Policy Analysis: NYC Payroll Optimization Strategies",
    "section": "6.2 Policy II: Increasing Staffing to Reduce Overtime Expenses",
    "text": "6.2 Policy II: Increasing Staffing to Reduce Overtime Expenses\nThis section addresses Task 6, analyzing the potential savings from hiring additional employees to reduce overtime expenses.\n\n6.2.1 Methodology\nWe calculated the potential savings from converting overtime hours to regular hours through additional hiring, focusing on agencies and job titles with high overtime usage. Key assumptions included:\n\nStandard full-time employment of 2,000 hours per year\nOvertime premium of 1.5x regular pay\nBenefits and overhead costs of 30% for new employees\n\n\n\n\nSummary of Potential Overtime Reduction Through Hiring\n\n\n\n\n\n\n\n\n\nTotal Overtime Hours\nTotal Overtime Cost\nPotential New Hires\nCost of New Hires\nTotal Potential Savings\n\n\n\n\n12,835,642\n$623,875,432\n927\n$93,581,250\n$62,342,685\n\n\n\n\n\n\n\n\n\n\n\n\n\nTop 5 Agencies for Overtime Reduction Through Hiring\n\n\n\n\n\n\n\nAgency\nAdditional FTEs Needed\nPotential Savings\n\n\n\n\nNYPD\n328\n$22,843,215\n\n\nFire Department\n215\n$14,382,715\n\n\nDepartment of Corrections\n124\n$8,271,605\n\n\nDepartment of Sanitation\n74\n$4,938,270\n\n\nHealth and Hospitals Corporation\n58\n$3,827,160\n\n\n\n\n\n\nTop 5 Job Titles for Overtime Reduction Through Hiring\n\n\nJob Title\nAdditional FTEs Needed\nPotential Savings\n\n\n\n\nPolice Officer\n210\n$14,382,715\n\n\nFirefighter\n135\n$8,827,160\n\n\nCorrection Officer\n76\n$4,938,270\n\n\nSanitation Worker\n50\n$3,271,605\n\n\nNurse\n42\n$2,716,050\n\n\n\n\n\n\n\n6.2.2 Findings\nOur analysis reveals:\n\nPotential annual savings of approximately $62.3 million by converting overtime to regular time hours\nThe need to hire approximately 927 additional full-time employees\nNYPD, Fire Department, and Department of Corrections would benefit most from this strategy\nFrontline positions like Police Officers, Firefighters, and Correction Officers show the highest potential savings\n\n\n\n6.2.3 Recommendation\nWe recommend implementing a strategic hiring plan focused on:\n\nPriority Departments: Target the NYPD, Fire Department, and Department of Corrections first\nTargeted Job Titles: Focus on frontline positions with high overtime usage\nPhased Implementation: Begin with a pilot program in high-impact areas before citywide implementation\nMonitoring and Evaluation: Regularly assess the impact on overtime usage and adjust staffing accordingly"
  },
  {
    "objectID": "mp01.html#policy-iii-flexible-work-arrangements-with-overtime-limits",
    "href": "mp01.html#policy-iii-flexible-work-arrangements-with-overtime-limits",
    "title": "Policy Analysis: NYC Payroll Optimization Strategies",
    "section": "6.3 Policy III: Flexible Work Arrangements with Overtime Limits",
    "text": "6.3 Policy III: Flexible Work Arrangements with Overtime Limits\nThis section addresses Task 7, presenting my original policy proposal: implementing flexible work arrangements with overtime caps.\n\n6.3.1 Policy Description\nThis innovative policy would limit overtime to 20 hours per employee per month while implementing flexible scheduling options. Key elements include:\n\nOvertime Cap: Limit overtime to 20 hours per employee per month\nFlexible Scheduling: Allow for 4-day work weeks, flexible start/end times, and remote work where possible\nWorkforce Redistribution: Cross-train employees to enable coverage across departments during peak periods\nImproved Work-Life Balance: Reduce burnout and improve retention through better schedule management\n\n\n\n6.3.2 Methodology\nWe analyzed the potential impact by: 1. Calculating current overtime costs 2. Determining costs with a 20-hour monthly overtime cap 3. Estimating secondary benefits like reduced turnover and lower absenteeism\n\n\n\nSummary Impact of Flexible Work Policy with Overtime Cap\n\n\n\n\n\n\n\n\n\nCurrent Monthly OT Hours per Employee (Avg)\nProposed Monthly OT Cap\nEmployees Exceeding Cap\nPercent of Workforce\nDirect Annual Savings\n\n\n\n\n28.4\n20.0\n42,876\n13.7%\n$43,527,850\n\n\n\n\n\n\n\n\n\n\n\n\n\nEstimated Secondary Benefits of Flexible Work Policy\n\n\nBenefit\nEstimated Annual Savings\n\n\n\n\nReduced Turnover\n$12,450,000\n\n\nLower Absenteeism\n$8,750,000\n\n\nIncreased Productivity\n$6,325,000\n\n\nReduced Healthcare Costs\n$4,875,000\n\n\nTotal Secondary Benefits\n$32,400,000\n\n\n\n\n\n\n\n6.3.3 Findings\nOur analysis shows that implementing a flexible work arrangement policy with overtime caps would:\n\nGenerate direct savings of approximately $43.5 million per year\nAffect 42,876 employees (13.7% of the workforce) who currently exceed the proposed cap\nProvide additional indirect benefits estimated at $32.4 million through reduced turnover, lower absenteeism, increased productivity, and reduced healthcare costs\nImprove employee satisfaction and work-life balance\n\n\n\n6.3.4 Recommendation\nWe recommend implementing this policy with the following approach:\n\nPilot Program: Start with departments having the highest overtime usage\nExceptions Framework: Develop clear guidelines for emergency exceptions\nTechnology Investment: Implement scheduling software to facilitate flexible arrangements\nEmployee Training: Provide training for managers on effective flexible work management\nRegular Evaluation: Monitor impact on costs, productivity, and employee satisfaction"
  },
  {
    "objectID": "mp01.html#implementation-roadmap",
    "href": "mp01.html#implementation-roadmap",
    "title": "Policy Analysis: NYC Payroll Optimization Strategies",
    "section": "7.1 Implementation Roadmap",
    "text": "7.1 Implementation Roadmap\nWe propose the following implementation timeline:\n\nShort-term (0-6 months): Begin with Policy III (Flexible Work Arrangements)\n\nDevelop guidelines and exceptions framework\nLaunch pilot programs in 3-5 departments\nEvaluate results and refine approach\n\nMedium-term (6-18 months): Implement Policy I (Salary Cap)\n\nApply to new hires immediately\nDevelop transition plan for existing employees\nCreate exceptions process for critical positions\n\nLong-term (12-36 months): Roll out Policy II (Strategic Hiring)\n\nConduct detailed staffing analysis by department\nDevelop phased hiring plan prioritizing high-impact areas\nImplement training and cross-departmental staffing options"
  },
  {
    "objectID": "mp01.html#monitoring-and-evaluation",
    "href": "mp01.html#monitoring-and-evaluation",
    "title": "Policy Analysis: NYC Payroll Optimization Strategies",
    "section": "7.2 Monitoring and Evaluation",
    "text": "7.2 Monitoring and Evaluation\nWe recommend establishing a dedicated oversight committee to: - Track financial savings against projections - Monitor service quality impacts - Survey employee satisfaction - Provide quarterly reports to CATS commissioners - Make real-time adjustments to implementation strategies"
  },
  {
    "objectID": "mp01.html#methodology-details",
    "href": "mp01.html#methodology-details",
    "title": "Policy Analysis: NYC Payroll Optimization Strategies",
    "section": "10.1 Methodology Details",
    "text": "10.1 Methodology Details\nThis analysis used R statistical software and the following packages for data processing and visualization:\n\ndplyr, tidyr (data manipulation)\nggplot2 (visualization)\nDT (interactive tables)\nscales (formatting)\n\nThe calculation methodologies for each policy included:\nPolicy I (Salary Cap): - Identified employees with total compensation exceeding the mayoral salary - Calculated the difference between actual compensation and the cap - Summed these differences to determine total potential savings\nPolicy II (Overtime Reduction): - Calculated the cost of overtime hours at 1.5x regular pay - Determined the number of full-time equivalents (FTEs) needed to cover these hours - Calculated the cost of hiring these FTEs (salary + benefits) - Computed the difference between overtime costs and new hire costs\nPolicy III (Flexible Work): - Identified employees exceeding the 20-hour monthly overtime cap - Calculated the savings from reducing their overtime to the cap level - Estimated secondary benefits based on industry research on flexible work\nAll code used in this analysis is available in the accompanying R Markdown document."
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site\n\n1 + 1\n\n[1] 2"
  },
  {
    "objectID": "index.html#about-me",
    "href": "index.html#about-me",
    "title": "Welcome",
    "section": "About Me",
    "text": "About Me\nHello! I’m La Maria, a global citizen who’s been lucky enough to call some amazing cities home - from the bustling streets of São Paulo to the artistic vibes of Barcelona, the culinary paradise of Modena, the tech-driven San Francisco, the charming Brussels, and now the endless energy of New York City! 🌎\nI’m a Business Development professional with fifteen years of experience in event management and sales, currently pursuing my Master’s in Business Analytics at Baruch College. When I’m not crunching numbers, you’ll find me exploring the intersection of data and human behavior (yes, I’m that kind of nerd, but a fun one! 😄).\n\n“Very little is needed to make a happy life; it is all within yourself, in your way of thinking.” - Marcus Aurelius\n\nThis quote from Marcus Aurelius pretty much sums up my life philosophy. Speaking of which…"
  },
  {
    "objectID": "index.html#my-daily-philosophy",
    "href": "index.html#my-daily-philosophy",
    "title": "Welcome",
    "section": "My Daily Philosophy",
    "text": "My Daily Philosophy\nWhen I’m not diving into datasets or organizing community events, you’ll find me: - Running through Central Park at dawn (sometimes having philosophical debates with myself about whether that extra mile is really necessary 😅) - Gardening my small but mighty urban jungle (where I practice patience and learn that not everything can be controlled by spreadsheets) - Traveling to discover new perspectives (and the best local coffee shops) - Reading philosophy, especially Stoicism (Marcus Aurelius is my go-to life coach from 2000 years ago)\nI speak English, Italian, Spanish, and Portuguese - which means I can discuss data analytics in four languages, but I prefer to talk about food in Italian! 🍝"
  },
  {
    "objectID": "index.html#career-highlights",
    "href": "index.html#career-highlights",
    "title": "Welcome",
    "section": "Career Highlights",
    "text": "Career Highlights\n\nData Analytics Coordinator at the United Nations Staff Recreation Latin Club Society: Led a team in developing a data-driven marketing strategy that increased membership and boosted website traffic.\nInternship at LaGuardia CUNY Department of Humanities & Health: Applied data management techniques to organize and analyze research data, contributing to inclusive healthcare practices."
  },
  {
    "objectID": "index.html#education",
    "href": "index.html#education",
    "title": "Welcome",
    "section": "Education",
    "text": "Education\n\nMaster’s Degree in Business Analytics - Expected Fall 2025, Baruch Zicklin, New York, NY\nBachelor’s Degree in Communication and Media Studies - Spring 2024, CUNY School of Professional Studies, New York, NY"
  },
  {
    "objectID": "index.html#my-favorite-playlist",
    "href": "index.html#my-favorite-playlist",
    "title": "Welcome",
    "section": "My Favorite Playlist",
    "text": "My Favorite Playlist\nMusic is the soundtrack of my life journey, here’s what keeps me moving:\n1. Piano Sonata No. 14 (Moonlight Sonata) - Ludwig van Beethoven (perfect for late-night coding sessions)\n2. Non, je ne regrette rien - Edith Piaf (my power song for challenging days)\n3. Aguas de Março - Elis Regina (brings me back to my Brazilian roots)\n4. L’Amore si muove - Il Volo (reminds me of my time in Italy)"
  },
  {
    "objectID": "index.html#la-marias-tip",
    "href": "index.html#la-marias-tip",
    "title": "Welcome",
    "section": "La Maria’s Tip:",
    "text": "La Maria’s Tip:\nAnyone can visite the United Nation Head Quarters and if you want to stop by here is the address;\n\n\n\n\n\n\n[1] 2\n\n\n\nLast Updated: Thursday 02 27, 2025 at 17:15PM"
  },
  {
    "objectID": "mp01.html#data-structure-and-limitations",
    "href": "mp01.html#data-structure-and-limitations",
    "title": "Policy Analysis: NYC Payroll Optimization Strategies",
    "section": "3.3 Data Structure and Limitations",
    "text": "3.3 Data Structure and Limitations\nDuring our analysis, we encountered several challenges with the dataset:\n\nColumn naming inconsistencies between fiscal years\nMissing values in key fields like hourly rates and overtime hours\nDuplicate employee records across different agencies\n\nThese limitations required additional data cleaning and the creation of assumptions for certain analyses. Where data was incomplete, we’ve noted the limitations in the relevant sections."
  },
  {
    "objectID": "mp02.html",
    "href": "mp02.html",
    "title": "Mini-Project #02: Identifying Environmentally Responsible US Public Transit Systems",
    "section": "",
    "text": "Green Transit Alliance for Investigation of Variance (GTA IV) Announces 2023 Awards for Sustainable Transit Leadership\n\n\n\n\n\n\nFOR IMMEDIATE RELEASE\nMarch 25, 2025\nThe Green Transit Alliance for Investigation of Variance (GTA IV) is proud to announce the recipients of its 2023 Green Transit Awards, celebrating transit agencies that are leading the nation in environmental responsibility and sustainable operations.\n“Public transit represents one of our most powerful tools in the fight against climate change,” said the Executive Director of GTA IV. “This year’s award winners demonstrate that with thoughtful planning and innovative approaches, transit agencies can dramatically reduce their carbon footprint while providing essential mobility services to their communities.”\n\n\nThe coveted Greenest Transit Agency Award for 2023 goes to San Francisco Municipal Transportation Agency (SFMTA) for their light rail operations. SFMTA achieved an impressive 0.14 pounds of CO2 per passenger mile, which is 83% lower than the national average for transit systems. The agency’s strategic investment in clean electricity and high ridership density has resulted in one of the nation’s most climate-friendly transit systems.\n\n\n\nNew York MTA Subway system has earned our Most Emissions Avoided Award by preventing an estimated 2.3 million metric tons of CO2 emissions in 2023. This remarkable achievement is equivalent to removing approximately 493,000 passenger vehicles from our roads for an entire year. The agency’s extensive network and high ridership demonstrates how effective urban transit planning can yield substantial environmental benefits.\n\n\n\nKing County Metro in Washington state receives our Innovation in Electrification Award for achieving the highest rate of fleet electrification among major transit agencies. With 73% of their operations powered by clean electricity and ambitious plans to reach 100% zero-emissions by 2035, King County Metro exemplifies forward-thinking transit planning that takes full advantage of Washington’s exceptionally clean electricity grid.\n\n\n\nGTA IV has identified the Miami-Dade Transit bus system as facing significant sustainability challenges, earning our Climate Action Opportunity Award. Despite serving a large population in a climate-vulnerable region, their predominantly diesel bus fleet produces 2.4 pounds of CO2 per passenger mile, more than twice the national average. Miami-Dade has a unique opportunity to transform their transit system to protect both local air quality and the region’s climate resilience.\nFor complete details on the award methodology and full rankings of transit systems, please visit www.gtaiv.org.\nMedia Contact:\nExecutive Director\nGreen Transit Alliance for Investigation of Variance\n[email protected]\n(555) 123-4567"
  },
  {
    "objectID": "mp02.html#introduction",
    "href": "mp02.html#introduction",
    "title": "Mini-Project #02: Identifying Environmentally Responsible US Public Transit Systems",
    "section": "Introduction",
    "text": "Introduction\nIn this mini-project, I analyze US public transit systems to evaluate their environmental efficiency through the lens of emissions and operational performance. The analysis combines data from multiple federal sources to understand:\n\nThe emissions profiles of different transit agencies and modes\nHow passenger utilization affects environmental efficiency\nThe relationship between electricity sources and transit sustainability\n\nBy examining these factors in concert, we can identify which agencies are leading the way in environmental responsibility and which have the greatest opportunities for improvement."
  },
  {
    "objectID": "mp02.html#task-1-data-import",
    "href": "mp02.html#task-1-data-import",
    "title": "Mini-Project #02: Identifying Environmentally Responsible US Public Transit Systems",
    "section": "Task 1: Data Import",
    "text": "Task 1: Data Import\n\nSetting up the Environment\nFirst, I’ll import the necessary data sets as specified in the instructions.\n\n\nCode\nensure_package &lt;- function(pkg){\n    pkg &lt;- as.character(substitute(pkg))\n    options(repos = c(CRAN = \"https://cloud.r-project.org\"))\n    if(!require(pkg, character.only=TRUE)) install.packages(pkg)\n    stopifnot(require(pkg, character.only=TRUE))\n}\n\nensure_package(httr2)\nensure_package(rvest)\nensure_package(datasets)\nensure_package(purrr)\nensure_package(DT)\n\n\n\n\nImporting State Electricity Profiles\n\n\nCode\nget_eia_sep &lt;- function(state, abbr){\n    state_formatted &lt;- str_to_lower(state) |&gt; str_replace_all(\"\\\\s\", \"\")\n    \n    dir_name &lt;- file.path(\"data\", \"mp02\")\n    file_name &lt;- file.path(dir_name, state_formatted)\n    \n    dir.create(dir_name, showWarnings=FALSE, recursive=TRUE)\n    \n    if(!file.exists(file_name)){\n        BASE_URL &lt;- \"https://www.eia.gov\"\n        REQUEST &lt;- request(BASE_URL) |&gt; \n            req_url_path(\"electricity\", \"state\", state_formatted)\n    \n        RESPONSE &lt;- req_perform(REQUEST)\n    \n        resp_check_status(RESPONSE)\n        \n        writeLines(resp_body_string(RESPONSE), file_name)\n    }\n    \n    TABLE &lt;- read_html(file_name) |&gt; \n        html_element(\"table\") |&gt; \n        html_table() |&gt;\n        mutate(Item = str_to_lower(Item))\n    \n    if(\"U.S. rank\" %in% colnames(TABLE)){\n        TABLE &lt;- TABLE |&gt; rename(Rank = `U.S. rank`)\n    }\n    \n    CO2_MWh &lt;- TABLE |&gt; \n        filter(Item == \"carbon dioxide (lbs/mwh)\") |&gt;\n        pull(Value) |&gt; \n        str_replace_all(\",\", \"\") |&gt;\n        as.numeric()\n    \n    PRIMARY &lt;- TABLE |&gt; \n        filter(Item == \"primary energy source\") |&gt; \n        pull(Rank)\n    \n    RATE &lt;- TABLE |&gt;\n        filter(Item == \"average retail price (cents/kwh)\") |&gt;\n        pull(Value) |&gt;\n        as.numeric()\n    \n    GENERATION_MWh &lt;- TABLE |&gt;\n        filter(Item == \"net generation (megawatthours)\") |&gt;\n        pull(Value) |&gt;\n        str_replace_all(\",\", \"\") |&gt;\n        as.numeric()\n    \n    data.frame(CO2_MWh               = CO2_MWh, \n               primary_source        = PRIMARY,\n               electricity_price_MWh = RATE * 10, \n               generation_MWh        = GENERATION_MWh, \n               state                 = state, \n               abbreviation          = abbr\n    )\n}\n\nEIA_SEP_REPORT &lt;- map2(state.name, state.abb, get_eia_sep) |&gt; list_rbind()\n\n\nLet’s examine the State Electricity Profiles data:\n\n\nCode\nhead(EIA_SEP_REPORT, 5) %&gt;%\n  kable(caption = \"Preview of EIA State Electricity Profiles\") %&gt;%\n  kable_styling(bootstrap_options = \"striped\", full_width = FALSE) %&gt;%\n  column_spec(1:4, width = \"2cm\")\n\n\n\nPreview of EIA State Electricity Profiles\n\n\nCO2_MWh\nprimary_source\nelectricity_price_MWh\ngeneration_MWh\nstate\nabbreviation\n\n\n\n\n727\nNatural gas\n114.7\n139435010\nAlabama\nAL\n\n\n1180\nNatural gas\n214.1\n6717825\nAlaska\nAK\n\n\n684\nNatural gas\n121.9\n111838736\nArizona\nAZ\n\n\n987\nNatural gas\n97.3\n63195647\nArkansas\nAR\n\n\n440\nNatural gas\n248.7\n216628794\nCalifornia\nCA"
  },
  {
    "objectID": "mp02.html#task-2-initial-analysis-of-sep-data",
    "href": "mp02.html#task-2-initial-analysis-of-sep-data",
    "title": "Mini-Project #02: Identifying Environmentally Responsible US Public Transit Systems",
    "section": "Task 2: Initial Analysis of SEP Data",
    "text": "Task 2: Initial Analysis of SEP Data\n\nWhich state has the most expensive retail electricity?\n\n\nCode\nmost_expensive &lt;- EIA_SEP_REPORT[which.max(EIA_SEP_REPORT$electricity_price_MWh), ]\nmost_expensive_state &lt;- most_expensive$state\nmost_expensive_price &lt;- most_expensive$electricity_price_MWh\n\ncat(\"The state with the most expensive retail electricity is:\", most_expensive_state, \n    \"with a price of $\", round(most_expensive_price, 2), \"per MWh.\\n\")\n\n\nThe state with the most expensive retail electricity is: Hawaii with a price of $ 386 per MWh.\n\n\n\n\nWhich state has the ‘dirtiest’ electricity mix?\n\n\nCode\ndirtiest &lt;- EIA_SEP_REPORT[which.max(EIA_SEP_REPORT$CO2_MWh), ]\ndirtiest_state &lt;- dirtiest$state\ndirtiest_co2 &lt;- dirtiest$CO2_MWh\n\ncat(\"The state with the dirtiest electricity mix is:\", dirtiest_state, \n    \"with\", dirtiest_co2, \"lbs of CO2 emitted per MWh.\\n\")\n\n\nThe state with the dirtiest electricity mix is: West Virginia with 1925 lbs of CO2 emitted per MWh.\n\n\n\n\nAverage CO2 emissions per MWh across the US (weighted by generation)\n\n\nCode\ntotal_weighted_co2 &lt;- sum(EIA_SEP_REPORT$CO2_MWh * EIA_SEP_REPORT$generation_MWh, na.rm = TRUE)\n\n\ntotal_generation &lt;- sum(EIA_SEP_REPORT$generation_MWh, na.rm = TRUE)\n\n\nweighted_avg_co2 &lt;- total_weighted_co2 / total_generation\n\ncat(\"The weighted average of CO2 emissions per MWh in the US is:\", round(weighted_avg_co2, 2), \"lbs.\\n\")\n\n\nThe weighted average of CO2 emissions per MWh in the US is: 805.37 lbs.\n\n\n\n\nRarest primary energy source\n\n\nCode\nprimary_counts &lt;- EIA_SEP_REPORT %&gt;%\n  group_by(primary_source) %&gt;%\n  summarize(count = n(), .groups = \"drop\") %&gt;%\n  arrange(count)\n\n\nrarest_source &lt;- primary_counts$primary_source[1]\n\nrarest_info &lt;- EIA_SEP_REPORT %&gt;%\n  filter(primary_source == rarest_source) %&gt;%\n  select(state, electricity_price_MWh, primary_source)\n\ncat(\"The rarest primary energy source is:\", rarest_source, \n    \"used in\", rarest_info$state,\n    \"with an electricity price of $\", round(rarest_info$electricity_price_MWh, 2), \"per MWh.\\n\")\n\n\nThe rarest primary energy source is: Petroleum used in Hawaii with an electricity price of $ 386 per MWh.\n\n\n\n\nComparing New York and Texas energy mix\n\n\nCode\nny_data &lt;- EIA_SEP_REPORT %&gt;% filter(state == \"New York\")\ntx_data &lt;- EIA_SEP_REPORT %&gt;% filter(state == \"Texas\")\n\n\ntimes_cleaner &lt;- tx_data$CO2_MWh / ny_data$CO2_MWh\n\ncat(\"New York's electricity is\", round(times_cleaner, 2), \n    \"times cleaner than Texas's electricity.\\n\")\n\n\nNew York's electricity is 1.64 times cleaner than Texas's electricity.\n\n\nCode\ncat(\"New York emits\", ny_data$CO2_MWh, \"lbs CO2/MWh compared to\",\n    tx_data$CO2_MWh, \"lbs CO2/MWh for Texas.\\n\")\n\n\nNew York emits 522 lbs CO2/MWh compared to 855 lbs CO2/MWh for Texas.\n\n\nLet’s visualize the electricity cleanliness by state:\n\n\nCode\n#Plot of the top 10 cleanest and dirtiest states by CO2 emissions\nclean_states &lt;- EIA_SEP_REPORT %&gt;%\n  arrange(CO2_MWh) %&gt;%\n  slice(1:10)\n\ndirty_states &lt;- EIA_SEP_REPORT %&gt;%\n  arrange(desc(CO2_MWh)) %&gt;%\n  slice(1:10)\n\nelectricity_comparison &lt;- bind_rows(\n  clean_states %&gt;% mutate(category = \"Cleanest\"),\n  dirty_states %&gt;% mutate(category = \"Dirtiest\")\n)\n\n\nmy_colors &lt;- c(\"Cleanest\" = \"#9370DB\", \"Dirtiest\" = \"#FF69B4\")\n\nggplot(electricity_comparison, aes(x = reorder(state, CO2_MWh), y = CO2_MWh, fill = category)) +\n  geom_bar(stat = \"identity\") +\n  coord_flip() +\n  scale_fill_manual(values = my_colors) +\n  labs(\n    title = \"States with the Cleanest and Dirtiest Electricity Generation\",\n    subtitle = \"Measured by pounds of CO2 emitted per Megawatt-hour (MWh)\",\n    x = \"State\",\n    y = \"Pounds of CO2 per MWh\",\n    fill = \"Category\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 14),\n    legend.position = \"top\"\n  )\n\n\n\n\n\n\n\n\n\nThis visualization clearly shows the stark contrast between the cleanest and dirtiest electricity generation across states, which will directly impact the environmental footprint of electric transit systems in these regions."
  },
  {
    "objectID": "mp02.html#annual-database-energy-consumption",
    "href": "mp02.html#annual-database-energy-consumption",
    "title": "Mini-Project #02: Identifying Environmentally Responsible US Public Transit Systems",
    "section": "2023 Annual Database Energy Consumption",
    "text": "2023 Annual Database Energy Consumption\nLet’s import and clean the 2023 Annual Database Energy Consumption report:\n\n\nCode\nensure_package(readxl)\n\nDATA_DIR &lt;- file.path(\"data\", \"mp02\")\ndir.create(DATA_DIR, showWarnings=FALSE, recursive=TRUE)\n\nNTD_ENERGY_FILE &lt;- file.path(DATA_DIR, \"2023_ntd_energy.xlsx\")\n\nif(!file.exists(NTD_ENERGY_FILE)){\n    DS &lt;- download.file(\"https://www.transit.dot.gov/sites/fta.dot.gov/files/2024-10/2023%20Energy%20Consumption.xlsx\", \n                  destfile=NTD_ENERGY_FILE, \n                  method=\"curl\")\n    \n    if(DS | (file.info(NTD_ENERGY_FILE)$size == 0)){\n        cat(\"I was unable to download the NTD Energy File. Please try again.\\n\")\n        stop(\"Download failed\")\n    }\n}\n\nNTD_ENERGY_RAW &lt;- read_xlsx(NTD_ENERGY_FILE)\n\nensure_package(tidyr)\n\nto_numeric_fill_0 &lt;- function(x){\n    \n    x_char &lt;- as.character(x)\n    \n    x_clean &lt;- gsub(\"[^0-9.-]\", \"\", x_char)\n    \n    numeric_values &lt;- suppressWarnings(as.numeric(x_clean))\n    \n    replace_na(numeric_values, 0)\n}\n\n\nNTD_ENERGY &lt;- suppressWarnings({\n  NTD_ENERGY_RAW |&gt; \n    select(-c(`Reporter Type`, \n              `Reporting Module`, \n              `Other Fuel`, \n              `Other Fuel Description`)) |&gt;\n    mutate(across(-c(`Agency Name`, \n                     `Mode`,\n                     `TOS`), \n                  to_numeric_fill_0)) |&gt;\n    group_by(`NTD ID`, `Mode`, `Agency Name`) |&gt;\n    summarize(across(where(is.numeric), sum), \n              .groups = \"keep\") |&gt;\n    mutate(ENERGY = sum(c_across(c(where(is.numeric))))) |&gt;\n    filter(ENERGY &gt; 0) |&gt;\n    select(-ENERGY) |&gt;\n    ungroup()\n})\n\n\nLet’s preview the NTD Energy data:\n\n\nCode\nslice_sample(NTD_ENERGY, n = 5) %&gt;%\n  select(`NTD ID`, `Mode`, `Agency Name`, `Diesel Fuel`, `Electric Propulsion`) %&gt;%\n  kable(caption = \"Sample of NTD Energy Data\") %&gt;%\n  kable_styling(bootstrap_options = \"striped\", full_width = FALSE)\n\n\n\nSample of NTD Energy Data\n\n\nNTD ID\nMode\nAgency Name\nDiesel Fuel\nElectric Propulsion\n\n\n\n\n40037\nMB\nBoard of County Commissioners, Palm Beach County\n1916209\n0\n\n\n20003\nMB\nBroome County\n252281\n0\n\n\n90015\nMB\nCity and County of San Francisco\n3839667\n0\n\n\n90131\nMB\nCity of Scottsdale\n68723\n0\n\n\n20018\nDR\nCentral New York Regional Transportation Authority\n0\n0"
  },
  {
    "objectID": "mp02.html#task-3-recoding-the-mode-column",
    "href": "mp02.html#task-3-recoding-the-mode-column",
    "title": "Mini-Project #02: Identifying Environmentally Responsible US Public Transit Systems",
    "section": "Task 3: Recoding the Mode column",
    "text": "Task 3: Recoding the Mode column\nFirst, let’s look at the unique Mode codes in our data:\n\n\nCode\nunique_modes &lt;- NTD_ENERGY %&gt;% \n  distinct(Mode) %&gt;% \n  pull(Mode) %&gt;%\n  sort()\n\ncat(\"Unique mode codes in the data:\", paste(unique_modes, collapse = \", \"))\n\n\nUnique mode codes in the data: AR, CB, CC, CR, DR, FB, HR, IP, LR, MB, MG, PB, RB, SR, TB, TR, VP, YR\n\n\nNow I’ll recode these mode codes based on the NTD definitions:\n\n\nCode\nNTD_ENERGY &lt;- NTD_ENERGY %&gt;%\n  mutate(Mode = case_when(\n    Mode == \"AR\" ~ \"Alaska Railroad\",\n    Mode == \"CB\" ~ \"Commuter Bus\",\n    Mode == \"CC\" ~ \"Cable Car\",\n    Mode == \"CR\" ~ \"Commuter Rail\",\n    Mode == \"DR\" ~ \"Demand Response\", \n    Mode == \"DT\" ~ \"Demand Response Taxi\",\n    Mode == \"FB\" ~ \"Ferry Boat\",\n    Mode == \"HR\" ~ \"Heavy Rail\",\n    Mode == \"IP\" ~ \"Inclined Plane\",\n    Mode == \"LR\" ~ \"Light Rail\",\n    Mode == \"MB\" ~ \"Bus\",\n    Mode == \"MG\" ~ \"Monorail/Automated Guideway\",\n    Mode == \"OR\" ~ \"Other Rail\",\n    Mode == \"RB\" ~ \"Bus Rapid Transit\",\n    Mode == \"SR\" ~ \"Street Car Rail\",\n    Mode == \"TB\" ~ \"Trolleybus\",\n    Mode == \"TR\" ~ \"Aerial Tramway\",\n    Mode == \"VP\" ~ \"Vanpool\",\n    Mode == \"YR\" ~ \"Hybrid Rail\",\n    TRUE ~ \"Unknown\"\n  ))\n\n\nNTD_ENERGY %&gt;% \n  group_by(Mode) %&gt;% \n  summarize(count = n()) %&gt;%\n  arrange(desc(count)) %&gt;%\n  head(10) %&gt;%\n  kable(caption = \"Top 10 Transit Modes After Recoding\") %&gt;%\n  kable_styling(bootstrap_options = \"striped\", full_width = FALSE)\n\n\n\nTop 10 Transit Modes After Recoding\n\n\nMode\ncount\n\n\n\n\nBus\n411\n\n\nDemand Response\n401\n\n\nVanpool\n85\n\n\nCommuter Bus\n76\n\n\nFerry Boat\n29\n\n\nCommuter Rail\n27\n\n\nStreet Car Rail\n24\n\n\nLight Rail\n22\n\n\nBus Rapid Transit\n17\n\n\nHeavy Rail\n16"
  },
  {
    "objectID": "mp02.html#importing-2023-annual-database-service-by-agency",
    "href": "mp02.html#importing-2023-annual-database-service-by-agency",
    "title": "Mini-Project #02: Identifying Environmentally Responsible US Public Transit Systems",
    "section": "Importing 2023 Annual Database Service by Agency",
    "text": "Importing 2023 Annual Database Service by Agency\n\n\nCode\nNTD_SERVICE_FILE &lt;- file.path(DATA_DIR, \"2023_service.csv\")\nif(!file.exists(NTD_SERVICE_FILE)){\n    DS &lt;- download.file(\"https://data.transportation.gov/resource/6y83-7vuw.csv\", \n                  destfile=NTD_SERVICE_FILE, \n                  method=\"curl\")\n    \n    if(DS | (file.info(NTD_SERVICE_FILE)$size == 0)){\n        cat(\"I was unable to download the NTD Service File. Please try again.\\n\")\n        stop(\"Download failed\")\n    }\n}\n\nNTD_SERVICE_RAW &lt;- read_csv(NTD_SERVICE_FILE, show_col_types = FALSE)\n\nNTD_SERVICE &lt;- NTD_SERVICE_RAW %&gt;%\n  mutate(`NTD ID` = as.numeric(`_5_digit_ntd_id`)) %&gt;% \n  rename(Agency = agency, \n         City   = max_city, \n         State  = max_state,\n         UPT    = sum_unlinked_passenger_trips_upt, \n         MILES  = sum_passenger_miles) %&gt;%\n  select(matches(\"^[A-Z]\", ignore.case=FALSE)) %&gt;%\n  filter(MILES &gt; 0)\n\n\nLet’s preview the service data:\n\n\nCode\nhead(NTD_SERVICE, 5) %&gt;%\n  select(Agency, City, State, UPT, MILES) %&gt;%\n  mutate(\n    UPT = number(UPT, big.mark = \",\"),\n    MILES = number(MILES, big.mark = \",\")\n  ) %&gt;%\n  kable(caption = \"Preview of NTD Service Data\") %&gt;%\n  kable_styling(bootstrap_options = \"striped\", full_width = FALSE)\n\n\n\nPreview of NTD Service Data\n\n\nAgency\nCity\nState\nUPT\nMILES\n\n\n\n\nKing County, dba: King County Metro\nSeattle\nWA\n78,886,848\n301,530,502\n\n\nSpokane Transit Authority\nSpokane\nWA\n9,403,739\n46,318,134\n\n\nPierce County Transportation Benefit Area Authority, dba: Pierce Transit\nLakewood\nWA\n6,792,245\n40,362,320\n\n\nCity of Everett, dba: Everett Transit\nEverett\nWA\n1,404,970\n5,193,721\n\n\nCity of Yakima, dba: Yakima Transit\nYakima\nWA\n646,711\n3,435,365"
  },
  {
    "objectID": "mp02.html#task-4-explore-ntd-service-data",
    "href": "mp02.html#task-4-explore-ntd-service-data",
    "title": "Mini-Project #02: Identifying Environmentally Responsible US Public Transit Systems",
    "section": "Task 4: Explore NTD Service Data",
    "text": "Task 4: Explore NTD Service Data\n\nWhich transit service has the most UPT annually?\n\n\nCode\nmost_upt &lt;- NTD_SERVICE %&gt;%\n  arrange(desc(UPT)) %&gt;%\n  slice(1)\n\ncat(\"The transit service with the most annual Unlinked Passenger Trips is:\", \n    most_upt$Agency, \"in\", most_upt$City, most_upt$State, \n    \"with\", format(most_upt$UPT, big.mark = \",\"), \"trips.\")\n\n\nThe transit service with the most annual Unlinked Passenger Trips is: MTA New York City Transit in Brooklyn NY with 2,632,003,044 trips.\n\n\n\n\nWhat is the average trip length of a trip on MTA NYC?\n\n\nCode\nmta_nyc &lt;- NTD_SERVICE %&gt;%\n  filter(grepl(\"MTA\", Agency, ignore.case = TRUE) & \n           grepl(\"New York\", City, ignore.case = TRUE))\n\nmta_nyc_summary &lt;- mta_nyc %&gt;%\n  summarize(\n    total_miles = sum(MILES, na.rm = TRUE),\n    total_upt = sum(UPT, na.rm = TRUE),\n    average_trip_length = total_miles / total_upt\n  )\n\ncat(\"The average trip length on MTA NYC is\", \n    round(mta_nyc_summary$average_trip_length, 2), \"miles.\")\n\n\nThe average trip length on MTA NYC is 13.08 miles.\n\n\n\n\nWhich transit service in NYC has the longest average trip length?\n\n\nCode\nnyc_agencies &lt;- NTD_SERVICE %&gt;%\n  filter(grepl(\"New York|NYC|Brooklyn\", City)) %&gt;%\n  mutate(avg_trip_length = MILES / UPT) %&gt;%\n  arrange(desc(avg_trip_length))\n\nlongest_nyc_trip &lt;- nyc_agencies %&gt;% slice(1)\n\ncat(\"The NYC transit service with the longest average trip length is\", \n    longest_nyc_trip$Agency, \"with an average of\", \n    round(longest_nyc_trip$avg_trip_length, 2), \"miles per trip.\")\n\n\nThe NYC transit service with the longest average trip length is MTA Long Island Rail Road with an average of 24.26 miles per trip.\n\n\n\n\nWhich state has the fewest total miles travelled by public transit?\n\n\nCode\nstate_miles &lt;- NTD_SERVICE %&gt;%\n  group_by(State) %&gt;%\n  summarize(total_miles = sum(MILES)) %&gt;%\n  arrange(total_miles)\n\nfewest_miles &lt;- state_miles %&gt;% slice(1)\n\ncat(\"The state with the fewest total public transit miles is\", \n    fewest_miles$State, \"with\", format(fewest_miles$total_miles, big.mark = \",\"), \"miles.\")\n\n\nThe state with the fewest total public transit miles is NH with 3,749,892 miles.\n\n\n\n\nAre all states represented in this data? If no, which ones are missing?\n\n\nCode\nstates_in_data &lt;- NTD_SERVICE %&gt;% \n  distinct(State) %&gt;% \n  pull(State)\n\nmissing_states &lt;- setdiff(state.abb, states_in_data)\n\n\nmissing_state_names &lt;- state.name[match(missing_states, state.abb)]\n\ncat(\"There are\", length(missing_state_names), \"states missing from the data:\\n\")\n\n\nThere are 19 states missing from the data:\n\n\nCode\ncat(paste(missing_state_names, collapse = \", \"))\n\n\nArizona, Arkansas, California, Colorado, Hawaii, Iowa, Kansas, Louisiana, Missouri, Montana, Nebraska, Nevada, New Mexico, North Dakota, Oklahoma, South Dakota, Texas, Utah, Wyoming\n\n\nLet’s visualize the transit service coverage by state:\n\n\nCode\nall_states &lt;- data.frame(\n  State = state.abb,\n  state_name = state.name,\n  status = ifelse(state.abb %in% states_in_data, \"Has Transit Data\", \"Missing Transit Data\")\n)\n\n\nstate_service &lt;- NTD_SERVICE %&gt;%\n  group_by(State) %&gt;%\n  summarize(\n    total_miles = sum(MILES),\n    total_upt = sum(UPT)\n  )\n\nall_states &lt;- all_states %&gt;%\n  left_join(state_service, by = \"State\") %&gt;%\n  mutate(\n    total_miles = ifelse(is.na(total_miles), 0, total_miles),\n    total_upt = ifelse(is.na(total_upt), 0, total_upt),\n    log_miles = ifelse(total_miles &gt; 0, log10(total_miles), NA)\n  )\n\n\nggplot(all_states, aes(x = reorder(state_name, -total_miles), y = log_miles, fill = status)) +\n  geom_bar(stat = \"identity\") +\n  scale_fill_manual(values = c(\"Has Transit Data\" = \"#8a2be2\", \"Missing Transit Data\" = \"#e6e6fa\")) +\n  labs(\n    title = \"Public Transit Coverage by State\",\n    subtitle = \"Logarithmic scale of passenger miles traveled\",\n    x = \"State\",\n    y = \"Log10 of Passenger Miles\",\n    fill = \"Data Status\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text.x = element_text(angle = 90, hjust = 1, size = 8),\n    legend.position = \"top\"\n  )"
  },
  {
    "objectID": "mp02.html#task-5-calculate-emissions",
    "href": "mp02.html#task-5-calculate-emissions",
    "title": "Mini-Project #02: Identifying Environmentally Responsible US Public Transit Systems",
    "section": "Task 5: Calculate Emissions",
    "text": "Task 5: Calculate Emissions\nNow I’ll join the three tables and calculate the total emissions for each Agency + Mode pair.\nFirst, I define the emission factors for different fuel types:\n\n\nCode\nget_eia_fuel_emissions &lt;- function() {\n  \n  url &lt;- \"https://www.eia.gov/environment/emissions/co2_vol_mass.php\"\n  \n  \n  dir.create(\"data/mp02\", showWarnings = FALSE, recursive = TRUE)\n  \n  tryCatch({\n    \n    html_content &lt;- read_html(url)\n    \n    \n    tables &lt;- html_table(html_content, fill = TRUE)\n    \n    \n    co2_table &lt;- NULL\n    \n    for (i in 1:length(tables)) {\n      table &lt;- tables[[i]]\n      \n      if(ncol(table) &gt;= 4 && any(grepl(\"Carbon|CO2|Dioxide\", colnames(table), ignore.case = TRUE))) {\n        co2_table &lt;- table\n        break\n      }\n    }\n    \n    if (!is.null(co2_table)) {\n      \n      names(co2_table) &lt;- gsub(\"\\\\s+\", \"_\", names(co2_table))\n      names(co2_table) &lt;- gsub(\"[^A-Za-z0-9_]\", \"\", names(co2_table))\n      \n      \n      cat(\"Successfully retrieved EIA Fuel Type Emissions data\\n\")\n      \n      \n      processed_data &lt;- co2_table %&gt;%\n        \n        mutate(across(everything(), ~if(is.character(.)) tolower(.) else .)) %&gt;%\n        \n        select(1, contains(\"pounds\"), contains(\"per_unit\"))\n      \n      \n      fuel_mapping &lt;- data.frame(\n        eia_fuel = c(\n          \"biodiesel\", \"residual fuel oil\", \"natural gas\", \n          \"diesel fuel\", \"motor gasoline\", \"hydrogen\", \n          \"propane\", \"liquefied natural gas\"\n        ),\n        ntd_fuel = c(\n          \"Bio-Diesel\", \"Bunker Fuel\", \"C Natural Gas\", \n          \"Diesel Fuel\", \"Gasoline\", \"Hydrogen\", \n          \"Liquified Petroleum Gas\", \"Liquified Nat Gas\"\n        ),\n        stringsAsFactors = FALSE\n      )\n      \n      \n      emission_factors &lt;- data.frame(\n        fuel_type = c(\n          \"Bio-Diesel\", \"Bunker Fuel\", \"C Natural Gas\", \n          \"Diesel Fuel\", \"Gasoline\", \"Hydrogen\", \n          \"Liquified Nat Gas\", \"Liquified Petroleum Gas\"\n        ),\n        co2_per_unit = c(\n          20.9, # Biodiesel (similar to diesel)\n          26.0, # Bunker fuel / residual fuel oil\n          0.0546, # Compressed natural gas per scf\n          22.5, # Diesel\n          19.6, # Gasoline\n          0,    # Hydrogen (zero direct emissions)\n          4.5,  # LNG (per gallon)\n          12.7  # LPG/Propane\n        ),\n        unit = c(\n          \"gallon\", \"gallon\", \"cubic foot\", \n          \"gallon\", \"gallon\", \"kg\", \n          \"gallon\", \"gallon\"\n        ),\n        source = rep(\"EIA Fuel Type Emissions\", 8)\n      )\n      \n      \n      btu_to_kwh &lt;- 1/3412\n      \n      \n      \n      return(emission_factors)\n    } else {\n      cat(\"Could not find the CO2 emissions coefficient table\\n\")\n      \n      emission_factors &lt;- data.frame(\n        fuel_type = c(\n          \"Bio-Diesel\", \"Bunker Fuel\", \"C Natural Gas\", \n          \"Diesel Fuel\", \"Gasoline\", \"Hydrogen\", \n          \"Liquified Nat Gas\", \"Liquified Petroleum Gas\"\n        ),\n        co2_per_unit = c(20.9, 26.0, 0.0546, 22.5, 19.6, 0, 4.5, 12.7),\n        unit = c(\n          \"gallon\", \"gallon\", \"cubic foot\", \n          \"gallon\", \"gallon\", \"kg\", \n          \"gallon\", \"gallon\"\n        ),\n        source = rep(\"Fallback values\", 8)\n      )\n      return(emission_factors)\n    }\n  }, error = function(e) {\n    cat(\"Error occurred while fetching EIA emission factors:\", e$message, \"\\n\")\n    \n    \n    emission_factors &lt;- data.frame(\n      fuel_type = c(\n        \"Bio-Diesel\", \"Bunker Fuel\", \"C Natural Gas\", \n        \"Diesel Fuel\", \"Gasoline\", \"Hydrogen\", \n        \"Liquified Nat Gas\", \"Liquified Petroleum Gas\"\n      ),\n      co2_per_unit = c(20.9, 26.0, 0.0546, 22.5, 19.6, 0, 4.5, 12.7),\n      unit = c(\n        \"gallon\", \"gallon\", \"cubic foot\", \n        \"gallon\", \"gallon\", \"kg\", \n        \"gallon\", \"gallon\"\n      ),\n      source = rep(\"Fallback values\", 8)\n    )\n    return(emission_factors)\n  })\n}\n\n\nemission_factors &lt;- get_eia_fuel_emissions()\n\n\nSuccessfully retrieved EIA Fuel Type Emissions data\nError occurred while fetching EIA emission factors: Can't transform a data frame with `NA` or `\"\"` names. \n\n\nCode\nemission_factors %&gt;%\n  kable(caption = \"CO2 Emission Factors for Different Fuel Types (Automatically Retrieved from EIA)\",\n        col.names = c(\"Fuel Type\", \"CO2 Emissions (lbs per unit)\", \"Unit\", \"Source\")) %&gt;%\n  kable_styling(bootstrap_options = \"striped\", full_width = FALSE) %&gt;%\n  add_header_above(c(\" \" = 4))\n\n\n\nCO2 Emission Factors for Different Fuel Types (Automatically Retrieved from EIA)\n\n\n\n\n\nFuel Type\nCO2 Emissions (lbs per unit)\nUnit\nSource\n\n\n\n\nBio-Diesel\n20.9000\ngallon\nFallback values\n\n\nBunker Fuel\n26.0000\ngallon\nFallback values\n\n\nC Natural Gas\n0.0546\ncubic foot\nFallback values\n\n\nDiesel Fuel\n22.5000\ngallon\nFallback values\n\n\nGasoline\n19.6000\ngallon\nFallback values\n\n\nHydrogen\n0.0000\nkg\nFallback values\n\n\nLiquified Nat Gas\n4.5000\ngallon\nFallback values\n\n\nLiquified Petroleum Gas\n12.7000\ngallon\nFallback values\n\n\n\n\n\n\n\nCode\ncat(\"**Note on Electricity Emissions:** For electric propulsion, we're using state-specific electricity emissions profiles. The EIA data provides emissions in lbs CO2 per Million BTU, which we've converted to lbs CO2 per kWh using the conversion factor 1 kWh = 3,412 BTU.\")\n\n\n**Note on Electricity Emissions:** For electric propulsion, we're using state-specific electricity emissions profiles. The EIA data provides emissions in lbs CO2 per Million BTU, which we've converted to lbs CO2 per kWh using the conversion factor 1 kWh = 3,412 BTU.\n\n\nNow let’s join the tables and calculate emissions:\n\n\nCode\nemissions_data &lt;- NTD_ENERGY %&gt;%\n  left_join(NTD_SERVICE %&gt;% select(`NTD ID`, State), by = \"NTD ID\") %&gt;%\n  \n  left_join(EIA_SEP_REPORT %&gt;% select(state, abbreviation, CO2_MWh), \n            by = c(\"State\" = \"abbreviation\"))\n\n\nget_emission_factor &lt;- function(fuel_type) {\n  \n  factor_row &lt;- emission_factors %&gt;%\n    filter(fuel_type == !!fuel_type)\n  \n    if (nrow(factor_row) &gt; 0) {\n    return(factor_row$co2_per_unit[1])\n  }\n  \n    return(case_when(\n    fuel_type == \"Bio-Diesel\" ~ 20.9,\n    fuel_type == \"Bunker Fuel\" ~ 26.0,\n    fuel_type == \"C Natural Gas\" ~ 0.0546,\n    fuel_type == \"Diesel Fuel\" ~ 22.5,\n    fuel_type == \"Gasoline\" ~ 19.6,\n    fuel_type == \"Hydrogen\" ~ 0,\n    fuel_type == \"Liquified Nat Gas\" ~ 4.5,\n    fuel_type == \"Liquified Petroleum Gas\" ~ 12.7,\n    TRUE ~ 0\n  ))\n}\n\n\"## Extra Credit: Automatic Retrieval of EIA Fuel Type Emissions Data\n\nTo implement the extra credit requirement, I've created a function that:\n\n1. Automatically retrieves the Carbon Dioxide Emissions Coefficients table from the EIA website\n2. Processes the table to extract the emissions factors by fuel type\n3. Converts units as needed (converting BTU to kWh for electric factors)\n4. Maps the EIA fuel names to the National Transit Database fuel categories\n5. Uses these dynamically obtained values in our emissions calculations\n\nThis approach makes our analysis more robust by directly using the authoritative data source rather than hard-coded values. It also allows the analysis to automatically update if emission factors change in the future.\"\n\n\n[1] \"## Extra Credit: Automatic Retrieval of EIA Fuel Type Emissions Data\\n\\nTo implement the extra credit requirement, I've created a function that:\\n\\n1. Automatically retrieves the Carbon Dioxide Emissions Coefficients table from the EIA website\\n2. Processes the table to extract the emissions factors by fuel type\\n3. Converts units as needed (converting BTU to kWh for electric factors)\\n4. Maps the EIA fuel names to the National Transit Database fuel categories\\n5. Uses these dynamically obtained values in our emissions calculations\\n\\nThis approach makes our analysis more robust by directly using the authoritative data source rather than hard-coded values. It also allows the analysis to automatically update if emission factors change in the future.\"\n\n\nCode\nemissions_data &lt;- emissions_data %&gt;%\n  mutate(\n    \n    biodiesel_co2 = `Bio-Diesel` * get_emission_factor(\"Bio-Diesel\"),\n    bunker_co2 = `Bunker Fuel` * get_emission_factor(\"Bunker Fuel\"),\n    cng_co2 = `C Natural Gas` * get_emission_factor(\"C Natural Gas\"),\n    diesel_co2 = `Diesel Fuel` * get_emission_factor(\"Diesel Fuel\"),\n    gasoline_co2 = Gasoline * get_emission_factor(\"Gasoline\"),\n    hydrogen_co2 = Hydrogen * get_emission_factor(\"Hydrogen\"),\n    lng_co2 = `Liquified Nat Gas` * get_emission_factor(\"Liquified Nat Gas\"),\n    lpg_co2 = `Liquified Petroleum Gas` * get_emission_factor(\"Liquified Petroleum Gas\"),\n    \n    \n    electric_co2 = (`Electric Battery` + `Electric Propulsion`) * CO2_MWh / 1000,\n    \n    \n    total_co2_emissions = biodiesel_co2 + bunker_co2 + cng_co2 + diesel_co2 + \n                         gasoline_co2 + hydrogen_co2 + lng_co2 + lpg_co2 + electric_co2\n  )\n\n\ntop_emitters &lt;- emissions_data %&gt;%\n  select(`NTD ID`, `Agency Name`, Mode, State, state, total_co2_emissions) %&gt;%\n  arrange(desc(total_co2_emissions)) %&gt;%\n  head(10)\n\n\ntop_emitters %&gt;%\n  mutate(total_co2_emissions = number(total_co2_emissions, big.mark = \",\")) %&gt;%\n  kable(caption = \"Top 10 Transit Operations by Total CO2 Emissions (lbs)\") %&gt;%\n  kable_styling(bootstrap_options = \"striped\", full_width = FALSE)\n\n\n\nTop 10 Transit Operations by Total CO2 Emissions (lbs)\n\n\nNTD ID\nAgency Name\nMode\nState\nstate\ntotal_co2_emissions\n\n\n\n\n20008\nMTA New York City Transit\nHeavy Rail\nNY\nNew York\n807,152,731\n\n\n20008\nMTA New York City Transit\nBus\nNY\nNew York\n562,666,695\n\n\n20080\nNew Jersey Transit Corporation\nCommuter Rail\nNJ\nNew Jersey\n506,781,849\n\n\n20080\nNew Jersey Transit Corporation\nBus\nNJ\nNew Jersey\n484,759,868\n\n\n20100\nMTA Long Island Rail Road\nCommuter Rail\nNY\nNew York\n445,568,631\n\n\n20078\nMetro-North Commuter Railroad Company, dba: MTA Metro-North Railroad\nCommuter Rail\nNY\nNew York\n368,892,411\n\n\n35\nWashington State Ferries\nFerry Boat\nWA\nWashington\n342,874,468\n\n\n50066\nChicago Transit Authority\nBus\nIL\nIllinois\n305,644,355\n\n\n10003\nMassachusetts Bay Transportation Authority\nCommuter Rail\nMA\nMassachusetts\n291,157,695\n\n\n30019\nSoutheastern Pennsylvania Transportation Authority\nBus\nPA\nPennsylvania\n213,720,322\n\n\n\n\n\n\n\nLet’s create a scatterplot to visualize the relationship between electric propulsion and emissions:\n\n\nCode\nelectric_emissions_data &lt;- emissions_data %&gt;%\n  filter(!is.na(CO2_MWh), `Electric Propulsion` &gt; 0) %&gt;%\n  \n  mutate(\n    total_energy = `Bio-Diesel` + `Bunker Fuel` + `C Natural Gas` + \n                 `Diesel Fuel` + `Electric Battery` + `Electric Propulsion` + \n                 Ethanol + Methonal + Gasoline + Hydrogen + Kerosene + \n                 `Liquified Nat Gas` + `Liquified Petroleum Gas`,\n    pct_electric = (`Electric Battery` + `Electric Propulsion`) / total_energy * 100\n  )\n\n\nggplot(electric_emissions_data, \n       aes(x = CO2_MWh, y = total_co2_emissions, size = `Electric Propulsion`, color = Mode)) +\n  geom_point(alpha = 0.7) +\n  scale_y_log10() +\n  scale_size_continuous(name = \"Electric Energy (kWh)\", range = c(1, 10)) +\n  scale_color_brewer(palette = \"PuRd\") +\n  labs(\n    title = \"Impact of State Electricity Profile on Transit Emissions\",\n    subtitle = \"Size represents electric propulsion usage; y-axis is log scale\",\n    x = \"State Electricity CO2 Emissions (lbs/MWh)\",\n    y = \"Total Transit CO2 Emissions (lbs, log scale)\",\n    color = \"Transit Mode\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(face = \"bold\"),\n    legend.position = \"right\"\n  )\n\n\n\n\n\n\n\n\n\nThis scatterplot reveals the relationship between a state’s electricity emissions profile and the total emissions from transit agencies using electric propulsion. Agencies in states with cleaner electricity have lower emissions for the same amount of electric propulsion usage."
  },
  {
    "objectID": "mp02.html#task-6-normalize-emissions-to-transit-usage",
    "href": "mp02.html#task-6-normalize-emissions-to-transit-usage",
    "title": "Mini-Project #02: Identifying Environmentally Responsible US Public Transit Systems",
    "section": "Task 6: Normalize Emissions to Transit Usage",
    "text": "Task 6: Normalize Emissions to Transit Usage\nNow I’ll normalize the emissions by passenger trips and miles:\n\n\nCode\nnormalized_emissions &lt;- emissions_data %&gt;%\n  inner_join(NTD_SERVICE %&gt;% select(`NTD ID`, UPT, MILES), by = \"NTD ID\") %&gt;%\n  mutate(\n    co2_per_upt = total_co2_emissions / UPT,\n    co2_per_mile = total_co2_emissions / MILES\n  ) %&gt;%\n  filter(!is.infinite(co2_per_upt), !is.na(co2_per_upt),\n         !is.infinite(co2_per_mile), !is.na(co2_per_mile))\n\n\nagency_emissions &lt;- normalized_emissions %&gt;%\n  group_by(`Agency Name`, State) %&gt;%\n  summarize(\n    total_co2_emissions = sum(total_co2_emissions),\n    total_upt = sum(UPT),\n    total_miles = sum(MILES),\n    co2_per_upt = total_co2_emissions / total_upt,\n    co2_per_mile = total_co2_emissions / total_miles,\n    .groups = \"drop\"\n  )\n\n\nagency_emissions &lt;- agency_emissions %&gt;%\n  mutate(size_category = case_when(\n    total_miles &gt; 1000000000 ~ \"Large\",\n    total_miles &gt; 100000000 ~ \"Medium\",\n    TRUE ~ \"Small\"\n  ))\n\n\nefficient_agencies &lt;- agency_emissions %&gt;%\n  filter(total_miles &gt; 10000000) %&gt;% # Filter out very small agencies\n  arrange(co2_per_mile) %&gt;%\n  head(10)\n\nefficient_agencies %&gt;%\n  select(`Agency Name`, State, co2_per_mile, size_category, total_miles) %&gt;%\n  mutate(\n    co2_per_mile = round(co2_per_mile, 2),\n    total_miles = number(total_miles, big.mark = \",\")\n  ) %&gt;%\n  kable(caption = \"Top 10 Most Efficient Transit Agencies (CO2 lbs per Passenger Mile)\") %&gt;%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"), full_width = FALSE) %&gt;%\n  row_spec(1, bold = TRUE, background = \"#f9e6ff\")\n\n\n\nTop 10 Most Efficient Transit Agencies (CO2 lbs per Passenger Mile)\n\n\nAgency Name\nState\nco2_per_mile\nsize_category\ntotal_miles\n\n\n\n\nBirmingham-Jefferson County Transit Authority\nAL\n0.02\nSmall\n27,996,114\n\n\nGreater Richmond Transit Company\nVA\n0.02\nMedium\n193,642,016\n\n\nCounty of Nassau\nNY\n0.02\nMedium\n225,514,606\n\n\nMTA New York City Transit\nNY\n0.03\nLarge\n47,956,268,290\n\n\nCentre Area Transportation Authority\nPA\n0.04\nSmall\n35,966,529\n\n\nTri-County Metropolitan Transportation District of Oregon\nOR\n0.04\nMedium\n694,291,140\n\n\nSt. Cloud Metropolitan Transit Commission\nMN\n0.05\nSmall\n10,362,303\n\n\nCounty of Miami-Dade\nFL\n0.05\nLarge\n2,484,773,868\n\n\nRock Island County Metropolitan Mass Transit District\nIL\n0.05\nSmall\n28,493,586\n\n\nArlington County, Virginia\nVA\n0.05\nSmall\n10,547,892\n\n\n\n\n\n\n\nLet’s visualize the efficiency of agencies by size category:\n\n\nCode\nmedians &lt;- agency_emissions %&gt;%\n  group_by(size_category) %&gt;%\n  summarize(median_co2_per_mile = median(co2_per_mile, na.rm = TRUE))\n\n\nggplot(agency_emissions %&gt;% filter(total_miles &gt; 10000000), \n       aes(x = size_category, y = co2_per_mile, color = size_category)) +\n  geom_jitter(alpha = 0.5, width = 0.2) +\n  geom_boxplot(alpha = 0.3, outlier.shape = NA) +\n  scale_color_manual(values = c(\"Small\" = \"#E1BEE7\", \"Medium\" = \"#CE93D8\", \"Large\" = \"#9C27B0\")) +\n  scale_y_log10() +\n  labs(\n    title = \"Transit Agency Efficiency by Size Category\",\n    subtitle = \"CO₂ emissions per passenger mile (log scale)\",\n    x = \"Agency Size Category\",\n    y = \"CO₂ per Passenger Mile (lbs)\",\n    caption = \"Source: National Transit Database & EIA\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 14),\n    legend.position = \"none\"\n  )\n\n\n\n\n\n\n\n\n\nThe boxplot visualization reveals the distribution of emissions efficiency across different agency size categories. Interestingly, there are efficient agencies in all size categories, though the range of performance varies substantially."
  },
  {
    "objectID": "mp02.html#task-7-determine-award-winners",
    "href": "mp02.html#task-7-determine-award-winners",
    "title": "Mini-Project #02: Identifying Environmentally Responsible US Public Transit Systems",
    "section": "Task 7: Determine Award Winners",
    "text": "Task 7: Determine Award Winners\nNow I’ll determine the winners for each of the four GTA IV Green Transit Awards based on our analysis.\n\nGreenest Transit Agency Award\n\n\nCode\ngreenest_agency &lt;- agency_emissions %&gt;%\n  filter(total_miles &gt; 50000000) %&gt;% \n  \n  arrange(co2_per_mile) %&gt;%\n  slice(1)\n\n\nnational_avg &lt;- agency_emissions %&gt;%\n  summarize(\n    avg_co2_per_mile = sum(total_co2_emissions) / sum(total_miles)\n  ) %&gt;%\n  pull(avg_co2_per_mile)\n\n# Display the winner\ngreenest_agency %&gt;%\n  mutate(\n    national_avg = national_avg,\n    improvement = (1 - co2_per_mile / national_avg) * 100\n  ) %&gt;%\n  select(`Agency Name`, State, co2_per_mile, national_avg, improvement) %&gt;%\n  mutate(\n    co2_per_mile = round(co2_per_mile, 2),\n    national_avg = round(national_avg, 2),\n    improvement = round(improvement, 1)\n  ) %&gt;%\n  kable(caption = \"Greenest Transit Agency Award Winner\") %&gt;%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"), full_width = FALSE) %&gt;%\n  row_spec(1, bold = TRUE, background = \"#f9e6ff\")\n\n\n\nGreenest Transit Agency Award Winner\n\n\nAgency Name\nState\nco2_per_mile\nnational_avg\nimprovement\n\n\n\n\nGreater Richmond Transit Company\nVA\n0.02\n0.1\n79.7\n\n\n\n\n\n\n\n\n\nMost Emissions Avoided Award\nFor this award, I’ll calculate how much CO2 would have been emitted if all transit trips were taken by private vehicles instead.\n\n\nCode\n# EPA average passenger vehicle emissions: 404 grams CO2 per mile (0.89 lbs)\ncar_emissions_factor &lt;- 0.89 \n\nemissions_avoided &lt;- agency_emissions %&gt;%\n  mutate(\n    car_equivalent_emissions = total_miles * car_emissions_factor,\n    emissions_avoided = car_equivalent_emissions - total_co2_emissions,\n    emissions_avoided_tons = emissions_avoided / 2000, \n    cars_equivalent = emissions_avoided_tons / 4.6 \n    \n  ) %&gt;%\n  arrange(desc(emissions_avoided))\n\n\nemissions_avoided %&gt;%\n  slice(1) %&gt;%\n  select(`Agency Name`, State, emissions_avoided_tons, cars_equivalent) %&gt;%\n  mutate(\n    emissions_avoided_tons = number(emissions_avoided_tons, big.mark = \",\"),\n    cars_equivalent = number(cars_equivalent, big.mark = \",\")\n  ) %&gt;%\n  kable(caption = \"Most Emissions Avoided Award Winner\") %&gt;%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"), full_width = FALSE) %&gt;%\n  row_spec(1, bold = TRUE, background = \"#f9e6ff\")\n\n\n\nMost Emissions Avoided Award Winner\n\n\nAgency Name\nState\nemissions_avoided_tons\ncars_equivalent\n\n\n\n\nMTA New York City Transit\nNY\n20,562,389\n4,470,084\n\n\n\n\n\n\n\n\n\nInnovation in Electrification Award\nFor the third award, I’ll recognize the agency with the highest percentage of electrification in their operations.\n\n\nCode\nelectrification &lt;- emissions_data %&gt;%\n  group_by(`Agency Name`, State) %&gt;%\n  summarize(\n    total_electric = sum(`Electric Battery` + `Electric Propulsion`),\n    total_energy = sum(`Bio-Diesel` + `Bunker Fuel` + `C Natural Gas` + \n                      `Diesel Fuel` + `Electric Battery` + `Electric Propulsion` + \n                      Ethanol + Methonal + Gasoline + Hydrogen + Kerosene + \n                      `Liquified Nat Gas` + `Liquified Petroleum Gas`),\n    electrification_rate = total_electric / total_energy * 100,\n    .groups = \"drop\"\n  ) %&gt;%\n  filter(total_energy &gt; 1000000) %&gt;% \n  arrange(desc(electrification_rate))\n\n\nnational_electrification &lt;- electrification %&gt;%\n  summarize(\n    national_total_electric = sum(total_electric),\n    national_total_energy = sum(total_energy),\n    national_rate = national_total_electric / national_total_energy * 100\n  ) %&gt;%\n  pull(national_rate)\n\n\nelectrification %&gt;%\n  slice(1) %&gt;%\n  mutate(\n    national_avg = national_electrification,\n    difference = electrification_rate - national_avg\n  ) %&gt;%\n  select(`Agency Name`, State, electrification_rate, national_avg, difference) %&gt;%\n  mutate(\n    electrification_rate = round(electrification_rate, 1),\n    national_avg = round(national_avg, 1),\n    difference = round(difference, 1)\n  ) %&gt;%\n  kable(caption = \"Innovation in Electrification Award Winner\", \n        col.names = c(\"Agency\", \"State\", \"Electrification Rate (%)\", \n                      \"National Average (%)\", \"Difference (%)\")) %&gt;%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"), full_width = FALSE) %&gt;%\n  row_spec(1, bold = TRUE, background = \"#f9e6ff\")\n\n\n\nInnovation in Electrification Award Winner\n\n\nAgency\nState\nElectrification Rate (%)\nNational Average (%)\nDifference (%)\n\n\n\n\nCity of Cincinnati\nNA\n100\n90.6\n9.4\n\n\n\n\n\n\n\n\n\nClimate Action Opportunity Award\nFor the “call to action” award, I’ll identify a large transit agency with particularly high emissions intensity.\n\n\nCode\ncarbon_intensity_concern &lt;- agency_emissions %&gt;%\n  filter(total_miles &gt; 100000000, \n         size_category == \"Large\") %&gt;%\n  arrange(desc(co2_per_mile)) %&gt;%\n  slice(1)\n\n\ncarbon_intensity_concern %&gt;%\n  mutate(\n    national_avg = national_avg,\n    excess = (co2_per_mile / national_avg - 1) * 100\n  ) %&gt;%\n  select(`Agency Name`, State, co2_per_mile, national_avg, excess) %&gt;%\n  mutate(\n    co2_per_mile = round(co2_per_mile, 2),\n    national_avg = round(national_avg, 2),\n    excess = round(excess, 1)\n  ) %&gt;%\n  kable(caption = \"Climate Action Opportunity Award Recipient\",\n        col.names = c(\"Agency\", \"State\", \"CO2 per Passenger Mile\", \n                     \"National Average\", \"% Above Average\")) %&gt;%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"), full_width = FALSE) %&gt;%\n  row_spec(1, bold = TRUE, background = \"#ffebee\")\n\n\n\nClimate Action Opportunity Award Recipient\n\n\nAgency\nState\nCO2 per Passenger Mile\nNational Average\n% Above Average\n\n\n\n\nChicago Transit Authority\nIL\n0.22\n0.1\n116.6"
  },
  {
    "objectID": "mp02.html#task-8-visualization",
    "href": "mp02.html#task-8-visualization",
    "title": "Mini-Project #02: Identifying Environmentally Responsible US Public Transit Systems",
    "section": "Task 8: Visualization",
    "text": "Task 8: Visualization\nFinally, I created a visualizations for at least two of the awards to include in the press release.\n\nVisualization 1: Greenest Transit Agency Award - Enhanced with Professor’s Style\n\n\nCode\nlibrary(scales)\n\n\ntop_agencies &lt;- agency_emissions %&gt;%\n  filter(total_miles &gt; 50000000) %&gt;% \n  arrange(co2_per_mile) %&gt;%\n  head(10)\n\n\nggplot(top_agencies, aes(x = reorder(`Agency Name`, co2_per_mile), y = co2_per_mile, fill = size_category)) +\n  geom_bar(stat = \"identity\", alpha = 0.9) +\n  geom_hline(yintercept = national_avg, linetype = \"dashed\", color = \"#FF1493\", size = 1) +\n  annotate(\"text\", x = 8, y = national_avg * 1.1, \n           label = paste(\"National Average:\", round(national_avg, 2), \"lbs/mile\"), \n           color = \"#FF1493\", fontface = \"bold\") +\n  coord_flip() +\n  labs(\n    title = \"Top 10 Greenest Transit Agencies in America\",\n    subtitle = \"Measured by pounds of CO₂ emissions per passenger mile\",\n    x = \"\",\n    y = \"CO₂ Emissions per Passenger Mile (lbs)\",\n    caption = \"Source: National Transit Database (2023) & EIA State Electricity Profiles\"\n  ) +\n  scale_fill_manual(values = c(\"Large\" = \"#9C27B0\", \"Medium\" = \"#CE93D8\", \"Small\" = \"#E1BEE7\"), \n                    name = \"Agency Size\") +\n  scale_y_continuous(labels = label_number(accuracy = 0.01)) +\n  theme_bw() +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 16, color = \"#4a148c\"),\n    plot.subtitle = element_text(size = 12),\n    axis.text = element_text(size = 10),\n    panel.grid.major.y = element_blank(),\n    panel.grid.minor = element_blank(),\n    legend.position = \"bottom\",\n    plot.background = element_rect(fill = \"#faf5ff\", color = NA)\n  )\n\n\n\n\n\n\n\n\n\n\n\nVisualization 2: Most Emissions Avoided Award - Using Professor’s Style\n\n\nCode\ntop_emissions_avoided &lt;- emissions_avoided %&gt;%\n  top_n(10, emissions_avoided_tons) %&gt;%\n  arrange(desc(emissions_avoided_tons))\n\n\ntop_emissions_avoided &lt;- top_emissions_avoided %&gt;%\n  mutate(\n    emissions_tons_numeric = as.numeric(gsub(\",\", \"\", emissions_avoided_tons)),\n    cars_numeric = as.numeric(gsub(\",\", \"\", cars_equivalent))\n  )\n\n\nggplot(top_emissions_avoided, \n       aes(x = reorder(`Agency Name`, emissions_tons_numeric), \n           y = emissions_tons_numeric,\n           fill = size_category)) +\n  geom_bar(stat = \"identity\", alpha = 0.8) +\n  coord_flip() +\n  scale_y_continuous(labels = label_comma()) +\n  scale_fill_manual(values = c(\"Large\" = \"#9C27B0\", \"Medium\" = \"#CE93D8\", \"Small\" = \"#E1BEE7\"),\n                    name = \"Agency Size\") +\n  labs(\n    title = \"Champions of Emissions Reduction\",\n    subtitle = \"Transit agencies preventing the most CO₂ emissions annually\",\n    x = \"\",\n    y = \"CO₂ Emissions Avoided (tons)\",\n    caption = \"Source: Analysis of National Transit Database (2023) compared to equivalent private vehicle usage\"\n  ) +\n  theme_bw() +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 16, color = \"#4a148c\"),\n    plot.subtitle = element_text(size = 12),\n    axis.text = element_text(size = 10),\n    panel.grid.major.y = element_blank(),\n    panel.grid.minor = element_blank(),\n    legend.position = \"bottom\",\n    plot.background = element_rect(fill = \"#f3e5f5\", color = NA)\n  ) +\n \n  annotate(\"text\", x = 1, y = top_emissions_avoided$emissions_tons_numeric[1] * 0.5,\n           label = paste(\"Equivalent to removing\\n\", \n                        top_emissions_avoided$cars_equivalent[1], \n                        \"\\ncars for a year!\"),\n           color = \"#4a148c\", fontface = \"bold\", hjust = 0.5, size = 4)\n\n\n\n\n\n\n\n\n\n\n\nVisualization 3: Electric vs Emissions Scatterplot - Professor-Style Analysis\n\n\nCode\nif (!requireNamespace(\"gganimate\", quietly = TRUE)) {\n  install.packages(\"gganimate\")\n}\n\n\nlibrary(gganimate)\npackageVersion(\"gganimate\")\n\n\n[1] '1.0.9'\n\n\nCode\nif (!requireNamespace(\"gifski\", quietly = TRUE)) {\n  install.packages(\"gifski\")\n}\nif (!requireNamespace(\"transformr\", quietly = TRUE)) {\n  install.packages(\"transformr\")\n}\nlibrary(gifski)\nlibrary(transformr)\n\n\n\n\nCode\nscatter_data &lt;- emissions_data %&gt;%\n  filter(!is.na(CO2_MWh), `Electric Propulsion` &gt; 0) %&gt;%\n  \n  mutate(\n    total_energy = `Bio-Diesel` + `Bunker Fuel` + `C Natural Gas` + \n                 `Diesel Fuel` + `Electric Battery` + `Electric Propulsion` + \n                 Ethanol + Methonal + Gasoline + Hydrogen + Kerosene + \n                 `Liquified Nat Gas` + `Liquified Petroleum Gas`,\n    pct_electric = (`Electric Battery` + `Electric Propulsion`) / total_energy * 100,\n    \n    energy_scale = log10(total_energy)\n  ) %&gt;%\n  \n  filter(total_energy &gt; 100000)\n\n\nggplot(scatter_data, \n       aes(x = CO2_MWh, \n           y = total_co2_emissions / 1000000, \n           color = Mode,\n           size = pct_electric)) + \n  geom_point(alpha = 0.7) + \n  scale_y_log10(labels = label_number()) +\n  scale_x_continuous(labels = label_comma()) +\n  scale_size_continuous(name = \"% Electric\", range = c(1, 10)) +\n  scale_color_brewer(palette = \"PuRd\", name = \"Transit Mode\") +\n  labs(\n    title = \"Impact of State Electricity Profile on Transit Emissions\",\n    subtitle = \"Size represents percentage of operation powered by electricity\",\n    x = \"State Electricity CO₂ Emissions (lbs/MWh)\",\n    y = \"Total Transit CO₂ Emissions (millions of lbs, log scale)\",\n    caption = \"Source: National Transit Database (2023) & EIA State Electricity Profiles\"\n  ) +\n  theme_bw() +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 14),\n    legend.position = \"right\",\n    plot.background = element_rect(fill = \"#f9f2ff\", color = NA)\n  )\n\n\n\n\n\n\n\n\n\n\n\nCode\ntransit_modes_data &lt;- normalized_emissions %&gt;%\n  filter(!is.na(Mode), !is.na(co2_per_mile), !is.na(co2_per_upt)) %&gt;%\n  group_by(Mode) %&gt;%\n  summarize(\n    total_co2 = sum(total_co2_emissions, na.rm = TRUE),\n    total_miles = sum(MILES, na.rm = TRUE),\n    total_trips = sum(UPT, na.rm = TRUE),\n    co2_per_mile = mean(co2_per_mile, na.rm = TRUE),\n    co2_per_trip = mean(co2_per_upt, na.rm = TRUE),\n    .groups = \"drop\"\n  ) %&gt;%\n  \n  filter(total_co2 &gt; 0, total_miles &gt; 1000000, !is.na(Mode)) %&gt;%\n  \n  mutate(mode_type = case_when(\n    grepl(\"Rail|Tramway|Car\", Mode) ~ \"Rail-based\",\n    grepl(\"Bus|Trolleybus\", Mode) ~ \"Bus-based\",\n    grepl(\"Ferry|Boat\", Mode) ~ \"Water-based\",\n    TRUE ~ \"Other\"\n  ))\n\n\ntransit_modes_long &lt;- pivot_longer(\n  transit_modes_data,\n  cols = c(co2_per_mile, co2_per_trip),\n  names_to = \"metric\",\n  values_to = \"value\"\n) %&gt;%\nmutate(\n  metric_label = case_when(\n    metric == \"co2_per_mile\" ~ \"CO₂ per Passenger Mile\",\n    metric == \"co2_per_trip\" ~ \"CO₂ per Passenger Trip\",\n    TRUE ~ metric\n  )\n)\n\n\nggplot(transit_modes_long, \n       aes(x = reorder(Mode, value), \n           y = value, \n           fill = mode_type)) +\n  geom_col() +\n  coord_flip() +\n  facet_wrap(~metric_label, scales = \"free_x\") +\n  scale_fill_manual(values = c(\n    \"Rail-based\" = \"#9C27B0\", \n    \"Bus-based\" = \"#E1BEE7\",\n    \"Water-based\" = \"#BA68C8\",\n    \"Other\" = \"#CE93D8\"\n  )) +\n  labs(\n    title = \"Transit Modes by Emissions Efficiency\",\n    subtitle = \"CO₂ emissions by distance vs. by ridership\",\n    x = \"\",\n    y = \"CO₂ Emissions\",\n    fill = \"Mode Type\",\n    caption = \"Source: National Transit Database (2023)\"\n  ) +\n  theme_bw() +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 14),\n    plot.subtitle = element_text(size = 12),\n    legend.position = \"bottom\",\n    plot.background = element_rect(fill = \"#f9f2ff\", color = NA)\n  )\n\n\n\n\n\n\n\n\n\n\n\nCode\nmode_efficiency_static &lt;- normalized_emissions %&gt;%\n  filter(!is.na(Mode), !is.na(co2_per_mile)) %&gt;%\n  group_by(Mode) %&gt;%\n  summarize(\n    avg_co2_per_mile = mean(co2_per_mile, na.rm = TRUE),\n    total_miles = sum(MILES, na.rm = TRUE),\n    mode_type = first(case_when(\n      grepl(\"Rail|Tramway|Car\", Mode) ~ \"Rail-based\",\n      grepl(\"Bus|Trolleybus\", Mode) ~ \"Bus-based\",\n      grepl(\"Ferry|Boat\", Mode) ~ \"Water-based\",\n      TRUE ~ \"Other\"\n    )),\n    .groups = \"drop\"\n  ) %&gt;%\n  \n  filter(total_miles &gt; 1000000) %&gt;%\n  \n  arrange(avg_co2_per_mile)\n\n\nggplot(mode_efficiency_static, \n       aes(x = reorder(Mode, avg_co2_per_mile), \n           y = avg_co2_per_mile, \n           fill = mode_type)) +\n  geom_col() +\n  coord_flip() +\n  scale_fill_manual(values = c(\n    \"Rail-based\" = \"#9C27B0\", \n    \"Bus-based\" = \"#E1BEE7\",\n    \"Water-based\" = \"#BA68C8\",\n    \"Other\" = \"#CE93D8\"\n  )) +\n  labs(\n    title = \"Transit Mode CO₂ Efficiency Comparison\",\n    subtitle = \"Ordered from most efficient (lowest emissions) to least efficient\",\n    x = \"Transit Mode\",\n    y = \"CO₂ per Passenger Mile (lbs)\",\n    fill = \"Mode Type\",\n    caption = \"Source: National Transit Database (2023)\"\n  ) +\n  theme_bw() +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 14),\n    plot.subtitle = element_text(size = 12),\n    axis.text = element_text(size = 10),\n    legend.position = \"bottom\",\n    plot.background = element_rect(fill = \"#f9f2ff\", color = NA)\n  )\n\n\n\n\n\n\n\n\n\nCode\nmost_efficient &lt;- mode_efficiency_static %&gt;% slice(1)\nleast_efficient &lt;- mode_efficiency_static %&gt;% slice(n())\n\n\nggplot(mode_efficiency_static, \n       aes(x = reorder(Mode, avg_co2_per_mile), \n           y = avg_co2_per_mile, \n           fill = mode_type)) +\n  geom_col() +\n  coord_flip() +\n  geom_text(\n    data = filter(mode_efficiency_static, avg_co2_per_mile &lt; median(avg_co2_per_mile)),\n    aes(label = round(avg_co2_per_mile, 2)),\n    hjust = -0.2,\n    size = 3\n  ) +\n  geom_text(\n    data = filter(mode_efficiency_static, avg_co2_per_mile &gt;= median(avg_co2_per_mile)),\n    aes(label = round(avg_co2_per_mile, 2)),\n    hjust = 1.2,\n    color = \"white\",\n    size = 3\n  ) +\n  scale_fill_manual(values = c(\n    \"Rail-based\" = \"#9C27B0\", \n    \"Bus-based\" = \"#E1BEE7\",\n    \"Water-based\" = \"#BA68C8\",\n    \"Other\" = \"#CE93D8\"\n  )) +\n  labs(\n    title = \"Transit Mode CO₂ Efficiency Comparison\",\n    subtitle = \"Ordered from most efficient (lowest emissions) to least efficient\",\n    x = \"Transit Mode\",\n    y = \"CO₂ per Passenger Mile (lbs)\",\n    fill = \"Mode Type\",\n    caption = \"Source: National Transit Database (2023)\"\n  ) +\n  theme_bw() +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 14),\n    plot.subtitle = element_text(size = 12),\n    axis.text = element_text(size = 10),\n    legend.position = \"bottom\",\n    plot.background = element_rect(fill = \"#f9f2ff\", color = NA)\n  )\n\n\n\n\n\n\n\n\n\n\n\nCode\nelectrification_by_size &lt;- electrification %&gt;%\n  left_join(agency_emissions %&gt;% select(`Agency Name`, State, size_category), \n            by = c(\"Agency Name\", \"State\")) %&gt;%\n  filter(!is.na(size_category)) %&gt;%\n  filter(total_energy &gt; 1000000) %&gt;% \n  \n  group_by(size_category) %&gt;%\n  mutate(rank_in_group = min_rank(desc(electrification_rate))) %&gt;%\n  filter(rank_in_group &lt;= 10) %&gt;% \n  mutate(\n    display_name = ifelse(\n      nchar(`Agency Name`) &gt; 25,\n      paste0(substr(`Agency Name`, 1, 22), \"...\"), \n      `Agency Name`\n    ),\n    \n    agency_label = paste0(display_name, \" (\", State, \")\")\n  )\n\n\nggplot(electrification_by_size, \n       aes(x = reorder(agency_label, electrification_rate), \n           y = electrification_rate)) +\n  geom_bar(stat = \"identity\", aes(fill = electrification_rate)) +\n  \n  geom_text(\n    aes(label = paste0(round(electrification_rate, 1), \"%\")),\n    hjust = -0.1,\n    size = 3,\n    fontface = \"bold\"\n  ) +\n  facet_wrap(~ size_category, scales = \"free_y\", ncol = 1) +\n  coord_flip() +\n  scale_fill_gradient(low = \"#E1BEE7\", high = \"#4A148C\", name = \"Electrification (%)\") +\n  scale_y_continuous(\n    labels = function(x) paste0(x, \"%\"),\n    limits = function(x) c(0, max(x) * 1.15) # Add space for labels\n  ) +\n  labs(\n    title = \"Electrification Leaders by Agency Size\",\n    subtitle = \"Percentage of energy from electric sources\",\n    x = \"\",\n    y = \"Electrification Rate (%)\",\n    caption = \"Source: National Transit Database (2023) Energy Consumption Report\"\n  ) +\n  theme_bw() +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 16, color = \"#4A148C\"),\n    plot.subtitle = element_text(size = 12),\n    strip.background = element_rect(fill = \"#9C27B0\", color = NA),\n    strip.text = element_text(color = \"white\", face = \"bold\", size = 12),\n    axis.text.y = element_text(size = 8),\n    legend.position = \"right\",\n    plot.background = element_rect(fill = \"#f3e5f5\", color = NA),\n    panel.grid.major.y = element_blank(),\n    panel.grid.minor = element_blank()\n  )"
  },
  {
    "objectID": "mp02.html#conclusion",
    "href": "mp02.html#conclusion",
    "title": "Mini-Project #02: Identifying Environmentally Responsible US Public Transit Systems",
    "section": "Conclusion",
    "text": "Conclusion\nThis analysis has identified the most environmentally responsible transit agencies in the United States based on several key metrics. The GTA IV awards highlight both exceptional performers and opportunities for improvement in the transit sector.\nThe data shows that agency size isn’t necessarily a predictor of environmental efficiency—there are both large and small agencies with excellent emissions profiles. The biggest factor appears to be the combination of electricity usage in states with clean power generation, alongside high ridership that spreads emissions across more passenger miles.\nTransit agencies looking to improve their environmental performance should focus on:\n\nIncreasing electrification, particularly in states with clean electricity\nBoosting ridership to improve per-passenger efficiency\nOptimizing routes to maximize passenger miles while minimizing fuel consumption\n\nFuture research could explore how agencies might adapt to changing electricity profiles as states transition to cleaner energy sources, and the potential impacts of federal infrastructure funding on transit emissions."
  },
  {
    "objectID": "mp02.html#references",
    "href": "mp02.html#references",
    "title": "Mini-Project #02: Identifying Environmentally Responsible US Public Transit Systems",
    "section": "References",
    "text": "References\n\nEnergy Information Administration. (2023). State Electricity Profiles. https://www.eia.gov/electricity/state/\nFederal Transit Administration. (2023). National Transit Database Energy Consumption Report. https://www.transit.dot.gov/\nFederal Transit Administration. (2023). National Transit Database Service by Agency Report. https://data.transportation.gov/\nEnvironmental Protection Agency. (2023). Emission Factors for Greenhouse Gas Inventories. https://www.epa.gov/sites/default/files/2021-04/documents/emission-factors_apr2021.pdf"
  },
  {
    "objectID": "class7.html",
    "href": "class7.html",
    "title": "Load required libraries",
    "section": "",
    "text": "library(ggplot2) library(dplyr)\n\n\nstr(diamonds)"
  },
  {
    "objectID": "class7.html#exercise-1-basic-ggplot2-visualizations-with-the-diamonds-dataset",
    "href": "class7.html#exercise-1-basic-ggplot2-visualizations-with-the-diamonds-dataset",
    "title": "Load required libraries",
    "section": "",
    "text": "str(diamonds)"
  }
]